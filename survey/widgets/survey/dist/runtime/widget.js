define(["esri/geometry/SpatialReference","esri/tasks/support/Query","jimu-arcgis","jimu-core","jimu-ui"], function(__WEBPACK_EXTERNAL_MODULE_esri_geometry_SpatialReference__, __WEBPACK_EXTERNAL_MODULE_esri_tasks_support_Query__, __WEBPACK_EXTERNAL_MODULE_jimu_arcgis__, __WEBPACK_EXTERNAL_MODULE_jimu_core__, __WEBPACK_EXTERNAL_MODULE_jimu_ui__) { return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./your-extensions/widgets/survey/src/runtime/widget.tsx");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./your-extensions/widgets/survey/src/runtime/assets/icon.svg":
/*!********************************************************************!*\
  !*** ./your-extensions/widgets/survey/src/runtime/assets/icon.svg ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"<svg viewBox=\\\"0 0 15 16\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g fill-rule=\\\"nonzero\\\"><path d=\\\"M2 10.5v.5-2 .5h1v1H2v.5-2 1.5zm0-4V7 5v.5h1v1H2V7 5v1.5zM2 13h1v1a1 1 0 001 1h9a1 1 0 001-1V2a1 1 0 00-1-1H4a1 1 0 00-1 1v1H2V2a2 2 0 012-2h9a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2v-1zm0 0h1v1a1 1 0 001 1h9a1 1 0 001-1V2a1 1 0 00-1-1H4a1 1 0 00-1 1v1H2V2a2 2 0 012-2h9a2 2 0 012 2v12a2 2 0 01-2 2H4a2 2 0 01-2-2v-1zm10.071-6.464l-.707-.708-2.828 2.829L7.12 7.243l-.707.707 2.122 2.121 3.535-3.535zm.707.707l-3.535 3.535a1 1 0 01-1.415 0l-2.12-2.121a1 1 0 010-1.414l.706-.707a1 1 0 011.414 0l.708.707 2.12-2.122a1 1 0 011.415 0l.707.707a1 1 0 010 1.415z\\\"></path><path d=\\\"M1.5 3.5v1h2v-1h-2zm0-1h2a1 1 0 011 1v1a1 1 0 01-1 1h-2a1 1 0 01-1-1v-1a1 1 0 011-1zm0 5v1h2v-1h-2zm0-1h2a1 1 0 011 1v1a1 1 0 01-1 1h-2a1 1 0 01-1-1v-1a1 1 0 011-1zm0 5v1h2v-1h-2zm0-1h2a1 1 0 011 1v1a1 1 0 01-1 1h-2a1 1 0 01-1-1v-1a1 1 0 011-1z\\\"></path></g></svg>\"//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi95b3VyLWV4dGVuc2lvbnMvd2lkZ2V0cy9zdXJ2ZXkvc3JjL3J1bnRpbWUvYXNzZXRzL2ljb24uc3ZnLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4veW91ci1leHRlbnNpb25zL3dpZGdldHMvc3VydmV5L3NyYy9ydW50aW1lL2Fzc2V0cy9pY29uLnN2Zz8wYjM5Il0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gXCI8c3ZnIHZpZXdCb3g9XFxcIjAgMCAxNSAxNlxcXCIgeG1sbnM9XFxcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXFxcIj48ZyBmaWxsLXJ1bGU9XFxcIm5vbnplcm9cXFwiPjxwYXRoIGQ9XFxcIk0yIDEwLjV2LjUtMiAuNWgxdjFIMnYuNS0yIDEuNXptMC00VjcgNXYuNWgxdjFIMlY3IDV2MS41ek0yIDEzaDF2MWExIDEgMCAwMDEgMWg5YTEgMSAwIDAwMS0xVjJhMSAxIDAgMDAtMS0xSDRhMSAxIDAgMDAtMSAxdjFIMlYyYTIgMiAwIDAxMi0yaDlhMiAyIDAgMDEyIDJ2MTJhMiAyIDAgMDEtMiAySDRhMiAyIDAgMDEtMi0ydi0xem0wIDBoMXYxYTEgMSAwIDAwMSAxaDlhMSAxIDAgMDAxLTFWMmExIDEgMCAwMC0xLTFINGExIDEgMCAwMC0xIDF2MUgyVjJhMiAyIDAgMDEyLTJoOWEyIDIgMCAwMTIgMnYxMmEyIDIgMCAwMS0yIDJINGEyIDIgMCAwMS0yLTJ2LTF6bTEwLjA3MS02LjQ2NGwtLjcwNy0uNzA4LTIuODI4IDIuODI5TDcuMTIgNy4yNDNsLS43MDcuNzA3IDIuMTIyIDIuMTIxIDMuNTM1LTMuNTM1em0uNzA3LjcwN2wtMy41MzUgMy41MzVhMSAxIDAgMDEtMS40MTUgMGwtMi4xMi0yLjEyMWExIDEgMCAwMTAtMS40MTRsLjcwNi0uNzA3YTEgMSAwIDAxMS40MTQgMGwuNzA4LjcwNyAyLjEyLTIuMTIyYTEgMSAwIDAxMS40MTUgMGwuNzA3LjcwN2ExIDEgMCAwMTAgMS40MTV6XFxcIj48L3BhdGg+PHBhdGggZD1cXFwiTTEuNSAzLjV2MWgydi0xaC0yem0wLTFoMmExIDEgMCAwMTEgMXYxYTEgMSAwIDAxLTEgMWgtMmExIDEgMCAwMS0xLTF2LTFhMSAxIDAgMDExLTF6bTAgNXYxaDJ2LTFoLTJ6bTAtMWgyYTEgMSAwIDAxMSAxdjFhMSAxIDAgMDEtMSAxaC0yYTEgMSAwIDAxLTEtMXYtMWExIDEgMCAwMTEtMXptMCA1djFoMnYtMWgtMnptMC0xaDJhMSAxIDAgMDExIDF2MWExIDEgMCAwMS0xIDFoLTJhMSAxIDAgMDEtMS0xdi0xYTEgMSAwIDAxMS0xelxcXCI+PC9wYXRoPjwvZz48L3N2Zz5cIiJdLCJtYXBwaW5ncyI6IkFBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./your-extensions/widgets/survey/src/runtime/assets/icon.svg\n");

/***/ }),

/***/ "./your-extensions/widgets/survey/src/runtime/css/style.ts":
/*!*****************************************************************!*\
  !*** ./your-extensions/widgets/survey/src/runtime/css/style.ts ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n    return cooked;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar jimu_core_1 = __webpack_require__(/*! jimu-core */ \"jimu-core\");\nfunction getStyle(theme) {\n    return jimu_core_1.css(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\n    &.survey123{\\n        width: 100%;\\n        height: 100%;\\n        overflow: auto;\\n        \\n        .title{\\n            font-weight: bold;\\n        }\\n    \\n        .survey123__noSurvey{\\n            width:100%;\\n            height:100%;\\n            text-align:center;\\n        }\\n    \\n        .survey123__webform{\\n            width:100%; \\n            height:100%;\\n\\n            .embed-container {\\n                position: relative; \\n                height: 100%;\\n                // padding-bottom:80%; \\n                width: 100%;\\n            } \\n            \\n            .embed-container iframe, \\n            .embed-container object, \\n            .embed-container iframe{\\n                position: absolute; \\n                top: 0; \\n                left: 0; \\n                width: 100%; \\n                height: 100%;\\n                border: 0px; \\n            } \\n            small{\\n                position: absolute; \\n                z-index: 40; \\n                bottom: 0; \\n                margin-bottom: -15px;\\n            }\\n        }    \\n    }\\n  \"], [\"\\n    &.survey123{\\n        width: 100%;\\n        height: 100%;\\n        overflow: auto;\\n        \\n        .title{\\n            font-weight: bold;\\n        }\\n    \\n        .survey123__noSurvey{\\n            width:100%;\\n            height:100%;\\n            text-align:center;\\n        }\\n    \\n        .survey123__webform{\\n            width:100%; \\n            height:100%;\\n\\n            .embed-container {\\n                position: relative; \\n                height: 100%;\\n                // padding-bottom:80%; \\n                width: 100%;\\n            } \\n            \\n            .embed-container iframe, \\n            .embed-container object, \\n            .embed-container iframe{\\n                position: absolute; \\n                top: 0; \\n                left: 0; \\n                width: 100%; \\n                height: 100%;\\n                border: 0px; \\n            } \\n            small{\\n                position: absolute; \\n                z-index: 40; \\n                bottom: 0; \\n                margin-bottom: -15px;\\n            }\\n        }    \\n    }\\n  \"])));\n}\nexports.getStyle = getStyle;\nvar templateObject_1;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi95b3VyLWV4dGVuc2lvbnMvd2lkZ2V0cy9zdXJ2ZXkvc3JjL3J1bnRpbWUvY3NzL3N0eWxlLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4veW91ci1leHRlbnNpb25zL3dpZGdldHMvc3VydmV5L3NyYy9ydW50aW1lL2Nzcy9zdHlsZS50cz85ZWYwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRoZW1lVmFyaWFibGVzLCBjc3MsIFNlcmlhbGl6ZWRTdHlsZXMgfSBmcm9tICdqaW11LWNvcmUnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFN0eWxlKHRoZW1lOiBUaGVtZVZhcmlhYmxlcyk6IFNlcmlhbGl6ZWRTdHlsZXMge1xyXG4gIHJldHVybiBjc3NgXHJcbiAgICAmLnN1cnZleTEyM3tcclxuICAgICAgICB3aWR0aDogMTAwJTtcclxuICAgICAgICBoZWlnaHQ6IDEwMCU7XHJcbiAgICAgICAgb3ZlcmZsb3c6IGF1dG87XHJcbiAgICAgICAgXHJcbiAgICAgICAgLnRpdGxle1xyXG4gICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAuc3VydmV5MTIzX19ub1N1cnZleXtcclxuICAgICAgICAgICAgd2lkdGg6MTAwJTtcclxuICAgICAgICAgICAgaGVpZ2h0OjEwMCU7XHJcbiAgICAgICAgICAgIHRleHQtYWxpZ246Y2VudGVyO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIC5zdXJ2ZXkxMjNfX3dlYmZvcm17XHJcbiAgICAgICAgICAgIHdpZHRoOjEwMCU7IFxyXG4gICAgICAgICAgICBoZWlnaHQ6MTAwJTtcclxuXHJcbiAgICAgICAgICAgIC5lbWJlZC1jb250YWluZXIge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOyBcclxuICAgICAgICAgICAgICAgIGhlaWdodDogMTAwJTtcclxuICAgICAgICAgICAgICAgIC8vIHBhZGRpbmctYm90dG9tOjgwJTsgXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTtcclxuICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC5lbWJlZC1jb250YWluZXIgaWZyYW1lLCBcclxuICAgICAgICAgICAgLmVtYmVkLWNvbnRhaW5lciBvYmplY3QsIFxyXG4gICAgICAgICAgICAuZW1iZWQtY29udGFpbmVyIGlmcmFtZXtcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgXHJcbiAgICAgICAgICAgICAgICB0b3A6IDA7IFxyXG4gICAgICAgICAgICAgICAgbGVmdDogMDsgXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMTAwJTsgXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7XHJcbiAgICAgICAgICAgICAgICBib3JkZXI6IDBweDsgXHJcbiAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgIHNtYWxse1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOyBcclxuICAgICAgICAgICAgICAgIHotaW5kZXg6IDQwOyBcclxuICAgICAgICAgICAgICAgIGJvdHRvbTogMDsgXHJcbiAgICAgICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAtMTVweDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gICAgXHJcbiAgICB9XHJcbiAgYDtcclxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFFQTtBQUNBO0FBOENBO0FBL0NBOzsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./your-extensions/widgets/survey/src/runtime/css/style.ts\n");

/***/ }),

/***/ "./your-extensions/widgets/survey/src/runtime/translations/default.ts":
/*!****************************************************************************!*\
  !*** ./your-extensions/widgets/survey/src/runtime/translations/default.ts ***!
  \****************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = {\n    _widgetLabel: 'Survey'\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi95b3VyLWV4dGVuc2lvbnMvd2lkZ2V0cy9zdXJ2ZXkvc3JjL3J1bnRpbWUvdHJhbnNsYXRpb25zL2RlZmF1bHQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi95b3VyLWV4dGVuc2lvbnMvd2lkZ2V0cy9zdXJ2ZXkvc3JjL3J1bnRpbWUvdHJhbnNsYXRpb25zL2RlZmF1bHQudHM/ZDI1OCJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCB7XHJcbiAgX3dpZGdldExhYmVsOiAnU3VydmV5J1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./your-extensions/widgets/survey/src/runtime/translations/default.ts\n");

/***/ }),

/***/ "./your-extensions/widgets/survey/src/runtime/widget.tsx":
/*!***************************************************************!*\
  !*** ./your-extensions/widgets/survey/src/runtime/widget.tsx ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/** @jsx jsx */\nvar jimu_core_1 = __webpack_require__(/*! jimu-core */ \"jimu-core\");\nvar jimu_core_2 = __webpack_require__(/*! jimu-core */ \"jimu-core\");\nvar jimu_ui_1 = __webpack_require__(/*! jimu-ui */ \"jimu-ui\");\nvar jimu_arcgis_1 = __webpack_require__(/*! jimu-arcgis */ \"jimu-arcgis\");\nvar survey123_service_1 = __webpack_require__(/*! ../service/survey123.service */ \"./your-extensions/widgets/survey/src/service/survey123.service.ts\");\nvar style_1 = __webpack_require__(/*! ./css/style */ \"./your-extensions/widgets/survey/src/runtime/css/style.ts\");\nvar default_1 = __webpack_require__(/*! ./translations/default */ \"./your-extensions/widgets/survey/src/runtime/translations/default.ts\");\nvar Query = __webpack_require__(/*! esri/tasks/support/Query */ \"esri/tasks/support/Query\");\nvar SpatialReference = __webpack_require__(/*! esri/geometry/SpatialReference */ \"esri/geometry/SpatialReference\");\n/**\n * survey123 widget\n */\nvar Widget = /** @class */ (function (_super) {\n    __extends(Widget, _super);\n    // private _extentWatch: __esri.WatchHandle;\n    // private _cachedTimeStamp: number = this.props.config.timestamp;\n    function Widget(props) {\n        var _this = _super.call(this, props) || this;\n        _this.API = {\n            Survey123WebForm: null\n        };\n        _this.iconSurvey123 = __webpack_require__(/*! ./assets/icon.svg */ \"./your-extensions/widgets/survey/src/runtime/assets/icon.svg\");\n        // showDiffLog = true;\n        _this.state = {\n            featureLayerViewDS: null\n        };\n        _this._dsManager = jimu_core_1.DataSourceManager.getInstance();\n        _this._isMapViewAddedClickEvent = false;\n        // load survey api\n        _this.loadSurveyAPI = function () {\n            var apiUrl = survey123_service_1.survey123Service.getSurvey123HostAPIUrl();\n            if (!_this.API.Survey123WebForm) {\n                return jimu_core_2.moduleLoader.loadModule(apiUrl)\n                    .then(function (Survey123WebForm) {\n                    _this.API = Survey123WebForm;\n                    // this.API.Survey123WebForm = Survey123WebForm;\n                    return Survey123WebForm;\n                });\n            }\n            else {\n                return Promise.resolve(_this.API.Survey123WebForm);\n            }\n        };\n        _this.updateDomId = function () {\n            _this.domId = 'survey_container_' + new Date().getTime(); // todo: maybe should add widget id?\n            return _this.domId;\n        };\n        // listen the map click \n        _this.onActiveViewChange = function (jimuMapView) {\n            if (jimuMapView && jimuMapView.view) {\n                _this._mapView = jimuMapView.view;\n                _this._mapView.when(function () {\n                    _this._mapView.on('click', _this.onMapClick);\n                });\n            }\n        };\n        // event listener of the click event of map view\n        _this.onMapClick = function (screenPoint) {\n            _this._mapView.hitTest(screenPoint).then(function (response) {\n                if (response.results.length) {\n                    response.results.forEach(function (result) {\n                        var graphic = result.graphic;\n                        var layerId = graphic.layer.id;\n                        if (_this.props.useDataSources[0].rootDataSourceId + '-' + layerId !== _this.props.useDataSources[0].dataSourceId) {\n                            return;\n                        }\n                        var layer = graphic.layer;\n                        var objectIdField = layer.objectIdField || 'objectid';\n                        var query = new Query({\n                            where: objectIdField + \" = \" + graphic.attributes[objectIdField],\n                            outFields: ['*'],\n                            returnGeometry: true,\n                            outSpatialReference: new SpatialReference({ wkid: 4326 })\n                        });\n                        layer.queryFeatures(query).then(function (results) {\n                            if (results.features && results.features[0]) {\n                                _this.featureLayerViewHandler(results.features[0]);\n                            }\n                        });\n                    });\n                }\n            });\n        };\n        /**\n         * isDsConfigured\n         */\n        _this.isDsConfigured = function () {\n            if (_this.props.useDataSources &&\n                _this.props.useDataSources.length === 1 && _this.props.config.activeLinkData) {\n                return true;\n            }\n            return false;\n        };\n        /**\n         * do feature layer query to get layer's features in the map extent\n         */\n        _this.doQuery = function (extent) {\n            var q = {\n                geometry: extent,\n                spatialRelationship: 'intersects',\n                returnGeometry: true\n            };\n            if (_this.getUsedDataSource().getStatus() !== jimu_core_1.DataSourceStatus.Loading) {\n                _this.getUsedDataSource().load(q);\n            }\n        };\n        /**\n         * data source renderer\n         */\n        _this.dataRender = function (ds) {\n            /**\n             * if mapView datasource\n             */\n            if (ds.type === jimu_arcgis_1.DataSourceTypes.WebMap) {\n                _this.mapViewHandler(ds);\n            }\n            /**\n             * if featurelayerView datasource\n             */\n            if (ds.type === jimu_arcgis_1.DataSourceTypes.FeatureLayer) {\n                _this.featureLayerViewHandler(null, ds);\n            }\n            return jimu_core_2.jsx(\"div\", null);\n        };\n        /**\n         * check the webform option change\n         */\n        _this.checkWebformOptionChanged = function (newOption) {\n            var cachedOption = _this._formOption;\n            if (Object.is(cachedOption, newOption)) {\n                return false;\n            }\n            if (!cachedOption && newOption) {\n                return true;\n            }\n            if (cachedOption.surveyItemId !== newOption.surveyItemId\n                || cachedOption.portalUrl !== newOption.portalUrl\n                || cachedOption.token !== newOption.token\n                || cachedOption.surveyStatusCode !== newOption.surveyStatusCode\n                || (cachedOption.hideElements ? cachedOption.hideElements.asMutable() : []).sort().join(',') !== (newOption.hideElements ? newOption.hideElements.asMutable() : []).sort().join(',')) {\n                return true;\n            }\n            return false;\n        };\n        _this.getClientId();\n        /**\n         * listen survey123 webform event\n         */\n        _this.listenSurvey123WebformEvent();\n        return _this;\n    }\n    Widget.prototype.componentDidMount = function () {\n        this.loadSurveyAPI();\n    };\n    /**\n     * get used data source\n     */\n    Widget.prototype.getUsedDataSource = function () {\n        var dataSources = this.props.useDataSources;\n        var ds = null;\n        if (dataSources && dataSources.length > 0) {\n            var dataSourceId = dataSources[0].dataSourceId;\n            ds = this._dsManager.getDataSource(dataSourceId);\n        }\n        return ds;\n    };\n    /**\n     * map view handler\n     */\n    Widget.prototype.mapViewHandler = function (ds) {\n        var _this = this;\n        if (ds && ds.view && this._isMapViewAddedClickEvent === false) {\n            /**\n             * add click event on the map view\n             */\n            var mapView_1 = ds.view;\n            mapView_1.on('click', function (e) {\n                var mapPoint = mapView_1.toMap({ x: e.x, y: e.y });\n                if (mapPoint) {\n                    var lat = mapPoint.latitude;\n                    var lng = mapPoint.longitude;\n                    _this.postMessageToSurvey123Webform({\n                        event: 'survey123:onDrawEnd',\n                        data: {\n                            x: lng,\n                            y: lat\n                        }\n                    });\n                }\n            });\n            this._isMapViewAddedClickEvent = true;\n        }\n    };\n    /**\n     * feature layer view handler\n     */\n    Widget.prototype.featureLayerViewHandler = function (graphic, ds) {\n        var feature = null;\n        if (graphic) {\n            feature = graphic;\n        }\n        else if (ds && ds.getSelectedRecords()) {\n            var selectedRecords = ds.getSelectedRecords();\n            feature = selectedRecords > 0 ? selectedRecords[0] : null;\n        }\n        // let feature = (selectedRecords[0] as FeatureDataRecord).feature;\n        if (this.props.config.activeLinkData && this.props.config.fieldQuestionMapping) {\n            var attr_1 = feature.attributes || {}; // the attribute of the selected record\n            var dataParams_1 = {};\n            var geoParams_1 = {};\n            var hasGemetryLink_1 = false;\n            this.props.config.fieldQuestionMapping.forEach(function (item) {\n                var field = item.field;\n                var questionName = item.question;\n                if (field === 'geometry') {\n                    hasGemetryLink_1 = true;\n                    var geometry = feature.geometry;\n                    if (geometry && (geometry.y || geometry.y === 0) && (geometry.x || geometry.x === 0)) {\n                        // dataParams.push(`center=${geometry.y},${geometry.x}`);\n                        geoParams_1 = {\n                            x: geometry.x,\n                            y: geometry.y\n                        };\n                    }\n                }\n                else {\n                    var val = attr_1[field];\n                    dataParams_1[questionName] = val || '';\n                    // dataParams.push(`field:${questionName}=${val || ''}`);\n                }\n            });\n            if (dataParams_1) {\n                // call survey jsapi to change value on-fly\n                this.webform.setQuestionValue(dataParams_1);\n            }\n            if (hasGemetryLink_1) {\n                this.webform.setGeopoint(geoParams_1);\n            }\n        }\n    };\n    /**\n     * listen survey123 webform event by iframe message\n     */\n    Widget.prototype.listenSurvey123WebformEvent = function () {\n        var _this = this;\n        var eventHandler = function (evt) {\n            if (evt && evt.data) {\n                var payload = void 0;\n                try {\n                    if (typeof evt.data === 'string') {\n                        payload = JSON.parse(evt.data);\n                    }\n                    else if (evt.data && evt.data.payload) {\n                        if (typeof evt.data.payload === 'string') {\n                            payload = JSON.parse(evt.data.payload);\n                        }\n                        else {\n                            payload = evt.data.payload;\n                        }\n                    }\n                    else {\n                        payload = evt.data;\n                    }\n                }\n                catch (err) {\n                    console.error(err);\n                }\n                // console.log(payload)\n                var event = payload.event;\n                var data = payload.data;\n                if (event === 'survey123:onDrawPoint') {\n                    _this.onDrawPoint(data);\n                }\n                if (event === 'survey123:onFormLoaded') {\n                    if (event === 'survey123:onFormLoaded' && payload.contentHeight) {\n                        /**\n                         * set iframe height\n                         */\n                        // this.iframeContainer.style.height = `${payload.contentHeight - 50}px`;\n                        // this.iframeContainer.style['padding-bottom'] = 'auto';\n                    }\n                }\n                if (event === 'survey123:onSubmitted') {\n                    console.log('survey123:onSubmitted!', data);\n                }\n            }\n        };\n        if (window.addEventListener) {\n            window.addEventListener('message', eventHandler, false);\n        }\n        else {\n            window['attachEvent']('onmessage', eventHandler);\n        }\n    };\n    /**\n     * get client id (for webform js api)\n     */\n    Widget.prototype.getClientId = function () {\n        var session = jimu_core_1.SessionManager.getInstance().getMainSession();\n        this._clientId = 'survey123hub';\n        //this._clientId = '3V9Mq5y21C1ifT3F';\n        if (session && session.clientId && session.clientId !== 'experienceBuilder') {\n            this._clientId = session.clientId;\n        }\n    };\n    /**\n     * on draw point\n     */\n    Widget.prototype.onDrawPoint = function (data) {\n        console.log('start draw point');\n        if (this._mapViewDSFromFeatureLayerView) {\n            this.mapViewHandler(this._mapViewDSFromFeatureLayerView);\n        }\n    };\n    /**\n     * post message to survey123 webform\n     */\n    Widget.prototype.postMessageToSurvey123Webform = function (payload) {\n        if (this.survey123webform && this.survey123webform.contentWindow) {\n            this.survey123webform.contentWindow.postMessage(JSON.stringify(payload), '*');\n        }\n        else {\n            console.log('cannot find survey123webform iframe contentWindow!');\n        }\n    };\n    /**\n     * build config for survey jsapi\n     */\n    Widget.prototype.buildWebFormConfig = function () {\n        var config = this.props.config;\n        var option = {\n            clientId: this._clientId || 'survey123hub',\n            container: this.domId || this.updateDomId(),\n            itemId: config.surveyItemId,\n            // portalUrl: 'https://devext.arcgis.com',\n            // token: '',\n            // hideElements: ['navbar'],\n            autoRefresh: 3,\n            isDebugMode: 'production' !== 'production'\n            // defaultValue: {\n            //   'field_1': 'werewrwewer'\n            // },\n        };\n        // portal url\n        var portalUrl = config.portalUrl || this.props.portalUrl || 'https://www.arcgis.com';\n        if (portalUrl === 'https://www.arcgis.com') {\n            option.portalUrl = portalUrl;\n        }\n        // token\n        var token = this.props.token;\n        //const token = 'fgU0ldlWfU0WkKJZtLfMeKLIdg9vfT1YJpw8KEOfY3-LWW9xvf5_98OFAzH2OKmo5xCmFwyJW7wpXxBVL98V9CwRcIjAsYy6AdFlzStEAk_vCsJWaDyQ1UzXQecNaVkexF9tvHmifJq2UQ3yqKy6KJ6CaxToAJcxBb3POIBmVuaoinNGse5nIfthZ6TI0pUqMpQIwCK7sLUbqTSo5CJOcQ..';\n        if (token) {\n            option.portalUrl = portalUrl;\n            option.token = token;\n        }\n        /**\n         * hide url params\n         */\n        var hides = config.hides || jimu_core_1.Immutable(['navbar', 'header', 'description', 'footer', 'theme']);\n        if (hides.length > 0) {\n            option.hideElements = hides;\n        }\n        /**\n         * default value\n         */\n        var defaultValue = config.defaultValue;\n        if (defaultValue && typeof defaultValue === 'object' && defaultValue !== null && defaultValue !== undefined) {\n            option.defaultValue = defaultValue;\n        }\n        // surveyStatusCode will change after survey republished\n        var code = this.props.stateProps ? this.props.stateProps.surveyStatusCode : 0;\n        if (code) {\n            option.surveyStatusCode = code;\n        }\n        return option;\n    };\n    /**\n     * get webform url\n     */\n    Widget.prototype.getWebformUrl = function () {\n        var config = this.props.config;\n        /**\n         * params\n         */\n        var surveyItemId = config.surveyItemId;\n        var portalUrl = config.portalUrl || this.props.portalUrl || 'https://www.arcgis.com';\n        var webformUrl = null;\n        if (surveyItemId) {\n            /**\n           * url params\n           */\n            var urlParams_1 = [];\n            /**\n             * portalUrl\n             */\n            if (portalUrl !== 'https://www.arcgis.com') {\n                urlParams_1.push(\"portalUrl=\" + portalUrl);\n            }\n            if (survey123_service_1.survey123Service.getSurvey123HostUrl() === 'https://survey123dev.arcgis.com' && portalUrl === 'https://www.arcgis.com') {\n                urlParams_1.push(\"portalUrl=\" + portalUrl);\n            }\n            /**\n             * embed url params\n             */\n            var embeds = config.embeds || []; // || ['fullScreen', 'onSubmitted', 'associatedMap'];\n            if (embeds.indexOf('jsapi') === -1) {\n                embeds = embeds.concat(['jsapi']); // from 3.7, we must to add embed=jsapi to let postMessage: setParams work\n            }\n            //if (embeds.indexOf('onSubmitted') === -1) {\n            //embeds = embeds.concat(['onSubmitted']);\n            //}\n            if (embeds.length > 0) {\n                urlParams_1.push(\"embed=\" + embeds.join(','));\n            }\n            /**\n             * hide url params\n             */\n            var hides = config.hides || ['navbar', 'header', 'description', 'footer', 'theme'];\n            if (hides.length > 0) {\n                urlParams_1.push(\"hide=\" + hides.join(','));\n            }\n            /**\n             * default value\n             */\n            var defaultValue_1 = config.defaultValue;\n            if (defaultValue_1 && typeof defaultValue_1 === 'object' && defaultValue_1 !== null && defaultValue_1 !== undefined) {\n                Object.keys(defaultValue_1).forEach(function (key) {\n                    urlParams_1.push(\"field:\" + key + \"=\" + defaultValue_1[key]);\n                });\n            }\n            /**\n             * open mode\n             */\n            var open = config.open || 'web';\n            var openWhiteLists = ['web', 'menu', 'native'];\n            if (open && open !== 'web' && openWhiteLists.indexOf(open) !== -1) {\n                urlParams_1.push(\"open=\" + open);\n            }\n            /**\n             * token\n             * we can add token in url params to avoid login in survey123 webform\n             * TODO:\n             * need to ask Junshan how to get user token in the widget\n             */\n            //const token = 'fgU0ldlWfU0WkKJZtLfMeKLIdg9vfT1YJpw8KEOfY3-LWW9xvf5_98OFAzH2OKmo5xCmFwyJW7wpXxBVL98V9CwRcIjAsYy6AdFlzStEAk_vCsJWaDyQ1UzXQecNaVkexF9tvHmifJq2UQ3yqKy6KJ6CaxToAJcxBb3POIBmVuaoinNGse5nIfthZ6TI0pUqMpQIwCK7sLUbqTSo5CJOcQ..';\n            var token = this.props.token;\n            if (token) {\n                urlParams_1.push(\"token=\" + token);\n            }\n            /**\n             * need to set version >=3.2 to use hide and embed params\n             */\n            urlParams_1.push('version=latest');\n            /**\n             * add autoRefresh=3\n             * to auto refresh in 3s after submit\n             */\n            urlParams_1.push('autoRefresh=3');\n            /**\n             * add timestamp randon params to ensure the iframe can refresh correctly\n             * only when timestamp is different\n             */\n            // let configTimestamp = config.timestamp;\n            // if (configTimestamp && this._cachedTimeStamp !== configTimestamp) {\n            //   this._cachedTimeStamp = configTimestamp;\n            // }\n            // urlParams.push(`timestamp=${this._cachedTimeStamp}`);\n            /**\n             * webform url\n             */\n            webformUrl = survey123_service_1.survey123Service.getSurvey123WebformUrl(surveyItemId, {\n                queryParams: urlParams_1\n            });\n        }\n        return webformUrl;\n    };\n    /**\n     * render ds\n     */\n    Widget.prototype.renderDS = function () {\n        var _this = this;\n        /**\n         * because we're now calling the survey jsapi to create/updat the survey webform\n         * we need to detect webform option change\n         * if the the surveyId/hideElements/token/portalUrl is changed, we should recreate the webform\n         * if the default value changed, or the entire option is not changed at all, do not recreate the webform\n         */\n        var dsId = null;\n        var rootDsId = null;\n        var options = this.buildWebFormConfig();\n        if (this.isDsConfigured()) {\n            /**\n             * get used data source\n             */\n            dsId = this.props.useDataSources[0].dataSourceId;\n            rootDsId = this.props.useDataSources[0].rootDataSourceId;\n        }\n        var needRecreateWebform = this.checkWebformOptionChanged(options);\n        this._formOption = options;\n        var webformUrl = this.getWebformUrl();\n        if (webformUrl && (!this.webform || needRecreateWebform)) {\n            var formNode = document.querySelector('#' + this.domId);\n            if (formNode) {\n                document.querySelector('#' + this.domId).innerHTML = ''; // clear the webform and reload\n                this.webform = null;\n            }\n            this.loadSurveyAPI()\n                .then(function () {\n                _this.webform = new _this.API.Survey123WebForm(options);\n                return true;\n            });\n        }\n        if (dsId && rootDsId && this.isDsConfigured()) {\n            // return <DataSourceComponent useDataSource={this.props.useDataSources[0]}>\n            //   {\n            //     this.dataRender\n            //   }\n            // </DataSourceComponent>\n            return jimu_core_2.jsx(jimu_arcgis_1.JimuMapViewComponent, { useMapWidgetIds: this.props.useMapWidgetIds, onActiveViewChange: this.onActiveViewChange });\n        }\n        return jimu_core_2.jsx(\"div\", null);\n    };\n    /**\n     * render\n     */\n    Widget.prototype.render = function () {\n        var webformUrl = this.getWebformUrl();\n        // let options = this.buildWebFormConfig();\n        var result;\n        /**\n         * if no webformUrl\n         */\n        if (!webformUrl) {\n            result = jimu_core_2.jsx(\"div\", { className: \"survey123__noSurvey\" },\n                jimu_core_2.jsx(jimu_ui_1.WidgetPlaceholder, { icon: this.iconSurvey123, message: this.props.intl.formatMessage({ id: '_widgetLabel', defaultMessage: default_1.default._widgetLabel }), widgetId: \"\" }));\n        }\n        else {\n            if (!this.domId) {\n                this.updateDomId();\n            }\n            result = jimu_core_2.jsx(\"div\", { className: \"survey123__webform\" },\n                jimu_core_2.jsx(\"div\", { className: \"embed-container\", id: this.domId }));\n        }\n        /**\n         * html\n         */\n        return jimu_core_2.jsx(\"div\", { css: style_1.getStyle(this.props.theme), className: \"survey123\" },\n            result,\n            /*\n             * render ds\n             */\n            this.renderDS());\n    };\n    return Widget;\n}(jimu_core_1.BaseWidget));\nexports.default = Widget;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi95b3VyLWV4dGVuc2lvbnMvd2lkZ2V0cy9zdXJ2ZXkvc3JjL3J1bnRpbWUvd2lkZ2V0LnRzeC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3lvdXItZXh0ZW5zaW9ucy93aWRnZXRzL3N1cnZleS9zcmMvcnVudGltZS93aWRnZXQudHN4PzU0NWIiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBqc3gganN4ICovXHJcbmltcG9ydCB7IEJhc2VXaWRnZXQsIERhdGFTb3VyY2VNYW5hZ2VyLCBTZXNzaW9uTWFuYWdlciwgRGF0YVNvdXJjZSwgRGF0YVNvdXJjZVN0YXR1cywgSW1tdXRhYmxlIH0gZnJvbSAnamltdS1jb3JlJztcclxuaW1wb3J0IHsgQWxsV2lkZ2V0UHJvcHMsIGpzeCwgbW9kdWxlTG9hZGVyIH0gZnJvbSAnamltdS1jb3JlJztcclxuXHJcbmltcG9ydCB7IFdpZGdldFBsYWNlaG9sZGVyIH0gZnJvbSAnamltdS11aSc7XHJcbmltcG9ydCB7IElNQ29uZmlnIH0gZnJvbSAnLi4vY29uZmlnJztcclxuaW1wb3J0IHsgRGF0YVNvdXJjZVR5cGVzLCBKaW11TWFwVmlld0NvbXBvbmVudCwgSmltdU1hcFZpZXcgfSBmcm9tICdqaW11LWFyY2dpcyc7XHJcbmltcG9ydCB7IHN1cnZleTEyM1NlcnZpY2UsIFN1cnZleTEyM01lc3NhZ2UgfSBmcm9tICcuLi9zZXJ2aWNlL3N1cnZleTEyMy5zZXJ2aWNlJztcclxuaW1wb3J0IHsgZ2V0U3R5bGUgfSBmcm9tICcuL2Nzcy9zdHlsZSc7XHJcbmltcG9ydCBkZWZhdWx0TWVzc2FnZXMgZnJvbSAnLi90cmFuc2xhdGlvbnMvZGVmYXVsdCc7XHJcblxyXG5pbXBvcnQgRXh0ZW50ID0gcmVxdWlyZSgnZXNyaS9nZW9tZXRyeS9FeHRlbnQnKTtcclxuaW1wb3J0IFF1ZXJ5ID0gcmVxdWlyZSgnZXNyaS90YXNrcy9zdXBwb3J0L1F1ZXJ5Jyk7XHJcbmltcG9ydCBTcGF0aWFsUmVmZXJlbmNlID0gcmVxdWlyZSgnZXNyaS9nZW9tZXRyeS9TcGF0aWFsUmVmZXJlbmNlJyk7XHJcblxyXG4vKipcclxuICogc3VydmV5MTIzIHdpZGdldFxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgV2lkZ2V0IGV4dGVuZHMgQmFzZVdpZGdldDxBbGxXaWRnZXRQcm9wczxJTUNvbmZpZz4sIGFueT57XHJcbiAgLyoqXHJcbiAgICogc3VydmV5MTIzd2ViZm9ybSBpZnJhbWVcclxuICAgKi9cclxuICBwdWJsaWMgc3VydmV5MTIzd2ViZm9ybTogYW55OyAgIFxyXG4gIHB1YmxpYyB3ZWJmb3JtOiBhbnk7IC8vIHRoZSBpbnN0YW5jZSBvZiBzdXJ2ZXkxMjMgd2ViZm9ybSBmcm9tIGpzYXBpXHJcbiAgcHVibGljIGlmcmFtZUNvbnRhaW5lcjogYW55O1xyXG4gIHB1YmxpYyBBUEk6IGFueSA9IHtcclxuICAgIFN1cnZleTEyM1dlYkZvcm06IG51bGxcclxuICB9O1xyXG4gIHB1YmxpYyBkb21JZDogc3RyaW5nO1xyXG4gIHB1YmxpYyBpY29uU3VydmV5MTIzID0gcmVxdWlyZSgnLi9hc3NldHMvaWNvbi5zdmcnKTtcclxuICAvLyBzaG93RGlmZkxvZyA9IHRydWU7XHJcblxyXG4gIHB1YmxpYyBzdGF0ZSA9IHtcclxuICAgIGZlYXR1cmVMYXllclZpZXdEUzogbnVsbFxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgX2RzTWFuYWdlciA9IERhdGFTb3VyY2VNYW5hZ2VyLmdldEluc3RhbmNlKCk7XHJcbiAgcHJpdmF0ZSBfaXNNYXBWaWV3QWRkZWRDbGlja0V2ZW50OiBib29sZWFuID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSBfbWFwVmlld0RTRnJvbUZlYXR1cmVMYXllclZpZXc6IGFueTsgLy90b2RvOiBzaG91bGQgcmVtb3ZlIHRoaXMgdmFyaWFibGVcclxuICBwcml2YXRlIF9tYXBWaWV3OiBfX2VzcmkuTWFwVmlldztcclxuICBwcml2YXRlIF9mb3JtT3B0aW9uOiBhbnk7XHJcbiAgcHJpdmF0ZSBfY2xpZW50SWQ6IGFueTtcclxuICAvLyBwcml2YXRlIF9leHRlbnRXYXRjaDogX19lc3JpLldhdGNoSGFuZGxlO1xyXG4gIC8vIHByaXZhdGUgX2NhY2hlZFRpbWVTdGFtcDogbnVtYmVyID0gdGhpcy5wcm9wcy5jb25maWcudGltZXN0YW1wO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xyXG4gICAgc3VwZXIocHJvcHMpO1xyXG4gICAgdGhpcy5nZXRDbGllbnRJZCgpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogbGlzdGVuIHN1cnZleTEyMyB3ZWJmb3JtIGV2ZW50XHJcbiAgICAgKi9cclxuICAgIHRoaXMubGlzdGVuU3VydmV5MTIzV2ViZm9ybUV2ZW50KCk7XHJcbiAgfVxyXG5cclxuICBjb21wb25lbnREaWRNb3VudCgpe1xyXG4gICAgdGhpcy5sb2FkU3VydmV5QVBJKCk7XHJcbiAgfVxyXG5cclxuICAvLyBsb2FkIHN1cnZleSBhcGlcclxuICBsb2FkU3VydmV5QVBJID0gKCkgPT4ge1xyXG4gICAgY29uc3QgYXBpVXJsID0gc3VydmV5MTIzU2VydmljZS5nZXRTdXJ2ZXkxMjNIb3N0QVBJVXJsKCk7XHJcbiAgICBpZiAoIXRoaXMuQVBJLlN1cnZleTEyM1dlYkZvcm0pIHtcclxuICAgICAgcmV0dXJuIG1vZHVsZUxvYWRlci5sb2FkTW9kdWxlKGFwaVVybClcclxuICAgICAgICAudGhlbigoU3VydmV5MTIzV2ViRm9ybSkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5BUEkgPSBTdXJ2ZXkxMjNXZWJGb3JtO1xyXG4gICAgICAgICAgLy8gdGhpcy5BUEkuU3VydmV5MTIzV2ViRm9ybSA9IFN1cnZleTEyM1dlYkZvcm07XHJcbiAgICAgICAgICByZXR1cm4gU3VydmV5MTIzV2ViRm9ybTtcclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5BUEkuU3VydmV5MTIzV2ViRm9ybSApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdXBkYXRlRG9tSWQgPSAoKSA9PiB7XHJcbiAgICB0aGlzLmRvbUlkID0gJ3N1cnZleV9jb250YWluZXJfJyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpOyAgIC8vIHRvZG86IG1heWJlIHNob3VsZCBhZGQgd2lkZ2V0IGlkP1xyXG4gICAgcmV0dXJuIHRoaXMuZG9tSWQ7IFxyXG4gIH1cclxuXHJcbiAgLy8gbGlzdGVuIHRoZSBtYXAgY2xpY2sgXHJcbiAgb25BY3RpdmVWaWV3Q2hhbmdlID0gKGppbXVNYXBWaWV3OiBKaW11TWFwVmlldykgPT4ge1xyXG4gICAgaWYoamltdU1hcFZpZXcgJiYgamltdU1hcFZpZXcudmlldykge1xyXG4gICAgICB0aGlzLl9tYXBWaWV3ID0gamltdU1hcFZpZXcudmlldyBhcyBfX2VzcmkuTWFwVmlldztcclxuICAgICAgdGhpcy5fbWFwVmlldy53aGVuKCgpID0+IHtcclxuICAgICAgICB0aGlzLl9tYXBWaWV3Lm9uKCdjbGljaycsIHRoaXMub25NYXBDbGljayk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgfVxyXG5cclxuICAvLyBldmVudCBsaXN0ZW5lciBvZiB0aGUgY2xpY2sgZXZlbnQgb2YgbWFwIHZpZXdcclxuICBvbk1hcENsaWNrID0gKHNjcmVlblBvaW50KSA9PiB7XHJcbiAgICB0aGlzLl9tYXBWaWV3LmhpdFRlc3Qoc2NyZWVuUG9pbnQpLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICBpZiAocmVzcG9uc2UucmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICByZXNwb25zZS5yZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcclxuICAgICAgICAgIGNvbnN0IGdyYXBoaWMgPSByZXN1bHQuZ3JhcGhpYztcclxuICAgICAgICAgIGNvbnN0IGxheWVySWQgPSBncmFwaGljLmxheWVyLmlkO1xyXG4gICAgICAgICAgaWYgKHRoaXMucHJvcHMudXNlRGF0YVNvdXJjZXNbMF0ucm9vdERhdGFTb3VyY2VJZCArICctJyArIGxheWVySWQgIT09IHRoaXMucHJvcHMudXNlRGF0YVNvdXJjZXNbMF0uZGF0YVNvdXJjZUlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNvbnN0IGxheWVyID0gZ3JhcGhpYy5sYXllciBhcyBfX2VzcmkuRmVhdHVyZUxheWVyO1xyXG4gICAgICAgICAgY29uc3Qgb2JqZWN0SWRGaWVsZCA9IGxheWVyLm9iamVjdElkRmllbGQgfHwgJ29iamVjdGlkJztcclxuICAgICAgICAgIGNvbnN0IHF1ZXJ5ID0gbmV3IFF1ZXJ5KHtcclxuICAgICAgICAgICAgd2hlcmU6IGAke29iamVjdElkRmllbGR9ID0gJHtncmFwaGljLmF0dHJpYnV0ZXNbb2JqZWN0SWRGaWVsZF19YCwgIFxyXG4gICAgICAgICAgICBvdXRGaWVsZHM6IFsnKiddLFxyXG4gICAgICAgICAgICByZXR1cm5HZW9tZXRyeTogdHJ1ZSxcclxuICAgICAgICAgICAgb3V0U3BhdGlhbFJlZmVyZW5jZTogbmV3IFNwYXRpYWxSZWZlcmVuY2Uoe3draWQ6IDQzMjZ9KVxyXG4gICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICBsYXllci5xdWVyeUZlYXR1cmVzKHF1ZXJ5KS50aGVuKChyZXN1bHRzKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHRzLmZlYXR1cmVzICYmIHJlc3VsdHMuZmVhdHVyZXNbMF0pIHtcclxuICAgICAgICAgICAgICB0aGlzLmZlYXR1cmVMYXllclZpZXdIYW5kbGVyKHJlc3VsdHMuZmVhdHVyZXNbMF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBnZXQgdXNlZCBkYXRhIHNvdXJjZVxyXG4gICAqL1xyXG4gIGdldFVzZWREYXRhU291cmNlKCkge1xyXG4gICAgY29uc3QgZGF0YVNvdXJjZXMgPSB0aGlzLnByb3BzLnVzZURhdGFTb3VyY2VzO1xyXG4gICAgbGV0IGRzID0gbnVsbDtcclxuXHJcbiAgICBpZiAoZGF0YVNvdXJjZXMgJiYgZGF0YVNvdXJjZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zdCBkYXRhU291cmNlSWQgPSBkYXRhU291cmNlc1swXS5kYXRhU291cmNlSWQ7XHJcbiAgICAgIGRzID0gdGhpcy5fZHNNYW5hZ2VyLmdldERhdGFTb3VyY2UoZGF0YVNvdXJjZUlkKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGlzRHNDb25maWd1cmVkXHJcbiAgICovXHJcbiAgaXNEc0NvbmZpZ3VyZWQgPSAoKSA9PiB7XHJcbiAgICBpZiAodGhpcy5wcm9wcy51c2VEYXRhU291cmNlcyAmJlxyXG4gICAgICB0aGlzLnByb3BzLnVzZURhdGFTb3VyY2VzLmxlbmd0aCA9PT0gMSAmJiB0aGlzLnByb3BzLmNvbmZpZy5hY3RpdmVMaW5rRGF0YSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGRvIGZlYXR1cmUgbGF5ZXIgcXVlcnkgdG8gZ2V0IGxheWVyJ3MgZmVhdHVyZXMgaW4gdGhlIG1hcCBleHRlbnRcclxuICAgKi9cclxuICBkb1F1ZXJ5ID0gKGV4dGVudDogRXh0ZW50KSA9PiB7XHJcbiAgICBjb25zdCBxID0ge1xyXG4gICAgICBnZW9tZXRyeTogZXh0ZW50LFxyXG4gICAgICBzcGF0aWFsUmVsYXRpb25zaGlwOiAnaW50ZXJzZWN0cycsXHJcbiAgICAgIHJldHVybkdlb21ldHJ5OiB0cnVlXHJcbiAgICB9O1xyXG4gICAgaWYgKHRoaXMuZ2V0VXNlZERhdGFTb3VyY2UoKS5nZXRTdGF0dXMoKSAhPT0gRGF0YVNvdXJjZVN0YXR1cy5Mb2FkaW5nKSB7XHJcbiAgICAgIHRoaXMuZ2V0VXNlZERhdGFTb3VyY2UoKS5sb2FkKHEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogbWFwIHZpZXcgaGFuZGxlclxyXG4gICAqL1xyXG4gIG1hcFZpZXdIYW5kbGVyKGRzOiBhbnkpIHtcclxuICAgIGlmIChkcyAmJiBkcy52aWV3ICYmIHRoaXMuX2lzTWFwVmlld0FkZGVkQ2xpY2tFdmVudCA9PT0gZmFsc2UpIHtcclxuICAgICAgLyoqXHJcbiAgICAgICAqIGFkZCBjbGljayBldmVudCBvbiB0aGUgbWFwIHZpZXdcclxuICAgICAgICovXHJcbiAgICAgIGNvbnN0IG1hcFZpZXcgPSBkcy52aWV3O1xyXG4gICAgICBtYXBWaWV3Lm9uKCdjbGljaycsIChlOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zdCBtYXBQb2ludCA9IG1hcFZpZXcudG9NYXAoeyB4OiBlLngsIHk6IGUueSB9KTtcclxuICAgICAgICBpZiAobWFwUG9pbnQpIHtcclxuICAgICAgICAgIGNvbnN0IGxhdCA9IG1hcFBvaW50LmxhdGl0dWRlO1xyXG4gICAgICAgICAgY29uc3QgbG5nID0gbWFwUG9pbnQubG9uZ2l0dWRlO1xyXG5cclxuICAgICAgICAgIHRoaXMucG9zdE1lc3NhZ2VUb1N1cnZleTEyM1dlYmZvcm0oe1xyXG4gICAgICAgICAgICBldmVudDogJ3N1cnZleTEyMzpvbkRyYXdFbmQnLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgeDogbG5nLFxyXG4gICAgICAgICAgICAgIHk6IGxhdFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLl9pc01hcFZpZXdBZGRlZENsaWNrRXZlbnQgPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZmVhdHVyZSBsYXllciB2aWV3IGhhbmRsZXJcclxuICAgKi9cclxuICBmZWF0dXJlTGF5ZXJWaWV3SGFuZGxlcihncmFwaGljOiBhbnksIGRzPzogYW55KSB7XHJcbiAgICBsZXQgZmVhdHVyZSA9IG51bGw7XHJcbiAgICBpZiAoZ3JhcGhpYykge1xyXG4gICAgICBmZWF0dXJlID0gZ3JhcGhpYztcclxuICAgIH0gZWxzZSBpZiAoZHMgJiYgZHMuZ2V0U2VsZWN0ZWRSZWNvcmRzKCkpIHtcclxuICAgICAgY29uc3Qgc2VsZWN0ZWRSZWNvcmRzID0gZHMuZ2V0U2VsZWN0ZWRSZWNvcmRzKClcclxuICAgICAgZmVhdHVyZSA9IHNlbGVjdGVkUmVjb3JkcyA+IDAgPyBzZWxlY3RlZFJlY29yZHNbMF0gOiBudWxsO1xyXG4gICAgfVxyXG4gICAgLy8gbGV0IGZlYXR1cmUgPSAoc2VsZWN0ZWRSZWNvcmRzWzBdIGFzIEZlYXR1cmVEYXRhUmVjb3JkKS5mZWF0dXJlO1xyXG4gICAgaWYgKHRoaXMucHJvcHMuY29uZmlnLmFjdGl2ZUxpbmtEYXRhICYmIHRoaXMucHJvcHMuY29uZmlnLmZpZWxkUXVlc3Rpb25NYXBwaW5nKSB7XHJcbiAgICAgIGNvbnN0IGF0dHIgPSBmZWF0dXJlLmF0dHJpYnV0ZXMgfHwge307ICAvLyB0aGUgYXR0cmlidXRlIG9mIHRoZSBzZWxlY3RlZCByZWNvcmRcclxuICAgICAgY29uc3QgZGF0YVBhcmFtcyA9IHt9O1xyXG4gICAgICBsZXQgZ2VvUGFyYW1zID0ge307XHJcbiAgICAgIGxldCBoYXNHZW1ldHJ5TGluayA9IGZhbHNlO1xyXG4gICAgICB0aGlzLnByb3BzLmNvbmZpZy5maWVsZFF1ZXN0aW9uTWFwcGluZy5mb3JFYWNoKChpdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZmllbGQgPSBpdGVtLmZpZWxkO1xyXG4gICAgICAgIGNvbnN0IHF1ZXN0aW9uTmFtZSA9IGl0ZW0ucXVlc3Rpb247XHJcbiAgICAgICAgaWYgKGZpZWxkID09PSAnZ2VvbWV0cnknKSB7XHJcbiAgICAgICAgICBoYXNHZW1ldHJ5TGluayA9IHRydWU7XHJcbiAgICAgICAgICBjb25zdCBnZW9tZXRyeTogYW55ID0gZmVhdHVyZS5nZW9tZXRyeTtcclxuICAgICAgICAgIGlmIChnZW9tZXRyeSAmJiAoZ2VvbWV0cnkueSB8fCBnZW9tZXRyeS55ID09PSAwKSAmJiAoZ2VvbWV0cnkueCB8fCBnZW9tZXRyeS54ID09PSAwKSkge1xyXG4gICAgICAgICAgICAvLyBkYXRhUGFyYW1zLnB1c2goYGNlbnRlcj0ke2dlb21ldHJ5Lnl9LCR7Z2VvbWV0cnkueH1gKTtcclxuICAgICAgICAgICAgZ2VvUGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgIHg6IGdlb21ldHJ5LngsXHJcbiAgICAgICAgICAgICAgeTogZ2VvbWV0cnkueVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjb25zdCB2YWwgPSBhdHRyW2ZpZWxkXTtcclxuICAgICAgICAgIGRhdGFQYXJhbXNbcXVlc3Rpb25OYW1lXSA9IHZhbCB8fCAnJztcclxuICAgICAgICAgIC8vIGRhdGFQYXJhbXMucHVzaChgZmllbGQ6JHtxdWVzdGlvbk5hbWV9PSR7dmFsIHx8ICcnfWApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuXHJcbiAgICAgIGlmIChkYXRhUGFyYW1zKSB7XHJcbiAgICAgICAgLy8gY2FsbCBzdXJ2ZXkganNhcGkgdG8gY2hhbmdlIHZhbHVlIG9uLWZseVxyXG4gICAgICAgIHRoaXMud2ViZm9ybS5zZXRRdWVzdGlvblZhbHVlKGRhdGFQYXJhbXMpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChoYXNHZW1ldHJ5TGluaykge1xyXG4gICAgICAgIHRoaXMud2ViZm9ybS5zZXRHZW9wb2ludChnZW9QYXJhbXMpO1xyXG4gICAgICB9XHJcblxyXG5cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGxpc3RlbiBzdXJ2ZXkxMjMgd2ViZm9ybSBldmVudCBieSBpZnJhbWUgbWVzc2FnZVxyXG4gICAqL1xyXG4gIGxpc3RlblN1cnZleTEyM1dlYmZvcm1FdmVudCgpIHtcclxuICAgIGNvbnN0IGV2ZW50SGFuZGxlciA9IChldnQ6IGFueSkgPT4ge1xyXG4gICAgICBpZiAoZXZ0ICYmIGV2dC5kYXRhKSB7XHJcbiAgICAgICAgbGV0IHBheWxvYWQ7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGlmICh0eXBlb2YgZXZ0LmRhdGEgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHBheWxvYWQgPSBKU09OLnBhcnNlKGV2dC5kYXRhKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAoZXZ0LmRhdGEgJiYgZXZ0LmRhdGEucGF5bG9hZCl7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZXZ0LmRhdGEucGF5bG9hZCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICBwYXlsb2FkID0gSlNPTi5wYXJzZShldnQuZGF0YS5wYXlsb2FkKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBwYXlsb2FkID0gZXZ0LmRhdGEucGF5bG9hZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGF5bG9hZCA9IGV2dC5kYXRhO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHBheWxvYWQpXHJcbiAgICAgICAgY29uc3QgZXZlbnQgPSBwYXlsb2FkLmV2ZW50O1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBwYXlsb2FkLmRhdGE7XHJcblxyXG4gICAgICAgIGlmIChldmVudCA9PT0gJ3N1cnZleTEyMzpvbkRyYXdQb2ludCcpIHtcclxuICAgICAgICAgIHRoaXMub25EcmF3UG9pbnQoZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnQgPT09ICdzdXJ2ZXkxMjM6b25Gb3JtTG9hZGVkJykge1xyXG4gICAgICAgICAgaWYgKGV2ZW50ID09PSAnc3VydmV5MTIzOm9uRm9ybUxvYWRlZCcgJiYgcGF5bG9hZC5jb250ZW50SGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBzZXQgaWZyYW1lIGhlaWdodFxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgLy8gdGhpcy5pZnJhbWVDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gYCR7cGF5bG9hZC5jb250ZW50SGVpZ2h0IC0gNTB9cHhgO1xyXG4gICAgICAgICAgICAvLyB0aGlzLmlmcmFtZUNvbnRhaW5lci5zdHlsZVsncGFkZGluZy1ib3R0b20nXSA9ICdhdXRvJztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChldmVudCA9PT0gJ3N1cnZleTEyMzpvblN1Ym1pdHRlZCcpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdzdXJ2ZXkxMjM6b25TdWJtaXR0ZWQhJywgZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xyXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGV2ZW50SGFuZGxlciwgZmFsc2UpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgd2luZG93WydhdHRhY2hFdmVudCddKCdvbm1lc3NhZ2UnLCBldmVudEhhbmRsZXIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogZ2V0IGNsaWVudCBpZCAoZm9yIHdlYmZvcm0ganMgYXBpKVxyXG4gICAqL1xyXG4gIGdldENsaWVudElkKCkge1xyXG4gICAgXHJcbiAgICBjb25zdCBzZXNzaW9uID0gU2Vzc2lvbk1hbmFnZXIuZ2V0SW5zdGFuY2UoKS5nZXRNYWluU2Vzc2lvbigpO1xyXG4gICAgdGhpcy5fY2xpZW50SWQgPSAnc3VydmV5MTIzaHViJztcclxuICAgIC8vdGhpcy5fY2xpZW50SWQgPSAnM1Y5TXE1eTIxQzFpZlQzRic7XHJcbiAgICBpZiAoc2Vzc2lvbiAmJiBzZXNzaW9uLmNsaWVudElkICYmIHNlc3Npb24uY2xpZW50SWQgIT09ICdleHBlcmllbmNlQnVpbGRlcicpIHtcclxuICAgICAgdGhpcy5fY2xpZW50SWQgPSBzZXNzaW9uLmNsaWVudElkO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogb24gZHJhdyBwb2ludFxyXG4gICAqL1xyXG4gIG9uRHJhd1BvaW50KGRhdGE/OiBhbnkpIHtcclxuICAgIGNvbnNvbGUubG9nKCdzdGFydCBkcmF3IHBvaW50Jyk7XHJcblxyXG4gICAgaWYgKHRoaXMuX21hcFZpZXdEU0Zyb21GZWF0dXJlTGF5ZXJWaWV3KSB7XHJcbiAgICAgIHRoaXMubWFwVmlld0hhbmRsZXIodGhpcy5fbWFwVmlld0RTRnJvbUZlYXR1cmVMYXllclZpZXcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogcG9zdCBtZXNzYWdlIHRvIHN1cnZleTEyMyB3ZWJmb3JtXHJcbiAgICovXHJcbiAgcG9zdE1lc3NhZ2VUb1N1cnZleTEyM1dlYmZvcm0ocGF5bG9hZDogU3VydmV5MTIzTWVzc2FnZSkge1xyXG4gICAgaWYgKHRoaXMuc3VydmV5MTIzd2ViZm9ybSAmJiB0aGlzLnN1cnZleTEyM3dlYmZvcm0uY29udGVudFdpbmRvdykge1xyXG4gICAgICB0aGlzLnN1cnZleTEyM3dlYmZvcm0uY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShwYXlsb2FkKSwgJyonKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc29sZS5sb2coJ2Nhbm5vdCBmaW5kIHN1cnZleTEyM3dlYmZvcm0gaWZyYW1lIGNvbnRlbnRXaW5kb3chJyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBidWlsZCBjb25maWcgZm9yIHN1cnZleSBqc2FwaVxyXG4gICAqL1xyXG4gIGJ1aWxkV2ViRm9ybUNvbmZpZygpIHtcclxuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMucHJvcHMuY29uZmlnO1xyXG5cclxuICAgIGNvbnN0IG9wdGlvbjogYW55ID0ge1xyXG4gICAgICBjbGllbnRJZDogdGhpcy5fY2xpZW50SWQgfHwgJ3N1cnZleTEyM2h1YicsXHJcbiAgICAgIGNvbnRhaW5lcjogdGhpcy5kb21JZCB8fCB0aGlzLnVwZGF0ZURvbUlkKCksXHJcbiAgICAgIGl0ZW1JZDogY29uZmlnLnN1cnZleUl0ZW1JZCxcclxuICAgICAgLy8gcG9ydGFsVXJsOiAnaHR0cHM6Ly9kZXZleHQuYXJjZ2lzLmNvbScsXHJcbiAgICAgIC8vIHRva2VuOiAnJyxcclxuICAgICAgLy8gaGlkZUVsZW1lbnRzOiBbJ25hdmJhciddLFxyXG4gICAgICBhdXRvUmVmcmVzaDogMyxcclxuICAgICAgaXNEZWJ1Z01vZGU6ICdwcm9kdWN0aW9uJyAhPT0gJ3Byb2R1Y3Rpb24nXHJcbiAgICAgIC8vIGRlZmF1bHRWYWx1ZToge1xyXG4gICAgICAvLyAgICdmaWVsZF8xJzogJ3dlcmV3cndld2VyJ1xyXG4gICAgICAvLyB9LFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBwb3J0YWwgdXJsXHJcbiAgICBjb25zdCBwb3J0YWxVcmwgPSBjb25maWcucG9ydGFsVXJsIHx8IHRoaXMucHJvcHMucG9ydGFsVXJsIHx8ICdodHRwczovL3d3dy5hcmNnaXMuY29tJztcclxuICAgIGlmIChwb3J0YWxVcmwgPT09ICdodHRwczovL3d3dy5hcmNnaXMuY29tJyApIHtcclxuICAgICAgb3B0aW9uLnBvcnRhbFVybCA9IHBvcnRhbFVybDtcclxuICAgIH1cclxuXHJcbiAgICAvLyB0b2tlblxyXG4gICAgY29uc3QgdG9rZW4gPSB0aGlzLnByb3BzLnRva2VuO1xyXG4gICAgLy9jb25zdCB0b2tlbiA9ICdmZ1UwbGRsV2ZVMFdrS0padExmTWVLTElkZzl2ZlQxWUpwdzhLRU9mWTMtTFdXOXh2ZjVfOThPRkF6SDJPS21vNXhDbUZ3eUpXN3dwWHhCVkw5OFY5Q3dSY0lqQXNZeTZBZEZselN0RUFrX3ZDc0pXYUR5UTFVelhRZWNOYVZrZXhGOXR2SG1pZkpxMlVRM3lxS3k2S0o2Q2F4VG9BSmN4QmIzUE9JQm1WdWFvaW5OR3NlNW5JZnRoWjZUSTBwVXFNcFFJd0NLN3NMVWJxVFNvNUNKT2NRLi4nO1xyXG4gICAgaWYgKHRva2VuKSB7XHJcbiAgICAgIG9wdGlvbi5wb3J0YWxVcmwgPSBwb3J0YWxVcmw7XHJcbiAgICAgIG9wdGlvbi50b2tlbiA9IHRva2VuO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogaGlkZSB1cmwgcGFyYW1zXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IGhpZGVzID0gY29uZmlnLmhpZGVzIHx8IEltbXV0YWJsZShbJ25hdmJhcicsICdoZWFkZXInLCAnZGVzY3JpcHRpb24nLCAnZm9vdGVyJywgJ3RoZW1lJ10pO1xyXG4gICAgaWYgKGhpZGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgb3B0aW9uLmhpZGVFbGVtZW50cyA9IGhpZGVzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogZGVmYXVsdCB2YWx1ZVxyXG4gICAgICovXHJcbiAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBjb25maWcuZGVmYXVsdFZhbHVlO1xyXG4gICAgaWYgKGRlZmF1bHRWYWx1ZSAmJiB0eXBlb2YgZGVmYXVsdFZhbHVlID09PSAnb2JqZWN0JyAmJiBkZWZhdWx0VmFsdWUgIT09IG51bGwgJiYgZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgb3B0aW9uLmRlZmF1bHRWYWx1ZSA9IGRlZmF1bHRWYWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzdXJ2ZXlTdGF0dXNDb2RlIHdpbGwgY2hhbmdlIGFmdGVyIHN1cnZleSByZXB1Ymxpc2hlZFxyXG4gICAgY29uc3QgY29kZSA9IHRoaXMucHJvcHMuc3RhdGVQcm9wcyA/IHRoaXMucHJvcHMuc3RhdGVQcm9wcy5zdXJ2ZXlTdGF0dXNDb2RlIDogMDtcclxuICAgIGlmIChjb2RlKSB7XHJcbiAgICAgIG9wdGlvbi5zdXJ2ZXlTdGF0dXNDb2RlID0gY29kZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIG9wdGlvbjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldCB3ZWJmb3JtIHVybFxyXG4gICAqL1xyXG4gIGdldFdlYmZvcm1VcmwoKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMucHJvcHMuY29uZmlnO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogcGFyYW1zXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IHN1cnZleUl0ZW1JZCA9IGNvbmZpZy5zdXJ2ZXlJdGVtSWQ7XHJcbiAgICBjb25zdCBwb3J0YWxVcmwgPSBjb25maWcucG9ydGFsVXJsIHx8IHRoaXMucHJvcHMucG9ydGFsVXJsIHx8ICdodHRwczovL3d3dy5hcmNnaXMuY29tJztcclxuICAgIGxldCB3ZWJmb3JtVXJsOiBzdHJpbmcgPSBudWxsO1xyXG5cclxuICAgIGlmIChzdXJ2ZXlJdGVtSWQpIHtcclxuICAgICAgLyoqXHJcbiAgICAgKiB1cmwgcGFyYW1zXHJcbiAgICAgKi9cclxuICAgICAgY29uc3QgdXJsUGFyYW1zOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIHBvcnRhbFVybFxyXG4gICAgICAgKi9cclxuICAgICAgaWYgKHBvcnRhbFVybCAhPT0gJ2h0dHBzOi8vd3d3LmFyY2dpcy5jb20nKSB7XHJcbiAgICAgICAgdXJsUGFyYW1zLnB1c2goYHBvcnRhbFVybD0ke3BvcnRhbFVybH1gKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoc3VydmV5MTIzU2VydmljZS5nZXRTdXJ2ZXkxMjNIb3N0VXJsKCkgPT09ICdodHRwczovL3N1cnZleTEyM2Rldi5hcmNnaXMuY29tJyAmJiBwb3J0YWxVcmwgPT09ICdodHRwczovL3d3dy5hcmNnaXMuY29tJykge1xyXG4gICAgICAgIHVybFBhcmFtcy5wdXNoKGBwb3J0YWxVcmw9JHtwb3J0YWxVcmx9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBlbWJlZCB1cmwgcGFyYW1zXHJcbiAgICAgICAqL1xyXG4gICAgICBsZXQgZW1iZWRzID0gY29uZmlnLmVtYmVkcyB8fCBbXTsgLy8gfHwgWydmdWxsU2NyZWVuJywgJ29uU3VibWl0dGVkJywgJ2Fzc29jaWF0ZWRNYXAnXTtcclxuICAgICAgaWYgKGVtYmVkcy5pbmRleE9mKCdqc2FwaScpID09PSAtMSkge1xyXG4gICAgICAgIGVtYmVkcyA9IGVtYmVkcy5jb25jYXQoWydqc2FwaSddKTsgLy8gZnJvbSAzLjcsIHdlIG11c3QgdG8gYWRkIGVtYmVkPWpzYXBpIHRvIGxldCBwb3N0TWVzc2FnZTogc2V0UGFyYW1zIHdvcmtcclxuICAgICAgfVxyXG4gICAgICAvL2lmIChlbWJlZHMuaW5kZXhPZignb25TdWJtaXR0ZWQnKSA9PT0gLTEpIHtcclxuICAgICAgICAvL2VtYmVkcyA9IGVtYmVkcy5jb25jYXQoWydvblN1Ym1pdHRlZCddKTtcclxuICAgICAgLy99XHJcbiAgICAgIGlmIChlbWJlZHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHVybFBhcmFtcy5wdXNoKGBlbWJlZD0ke2VtYmVkcy5qb2luKCcsJyl9YCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBoaWRlIHVybCBwYXJhbXNcclxuICAgICAgICovXHJcbiAgICAgIGNvbnN0IGhpZGVzID0gY29uZmlnLmhpZGVzIHx8IFsnbmF2YmFyJywgJ2hlYWRlcicsICdkZXNjcmlwdGlvbicsICdmb290ZXInLCAndGhlbWUnXTtcclxuICAgICAgaWYgKGhpZGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICB1cmxQYXJhbXMucHVzaChgaGlkZT0ke2hpZGVzLmpvaW4oJywnKX1gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICovXHJcbiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IGNvbmZpZy5kZWZhdWx0VmFsdWU7XHJcbiAgICAgIGlmIChkZWZhdWx0VmFsdWUgJiYgdHlwZW9mIGRlZmF1bHRWYWx1ZSA9PT0gJ29iamVjdCcgJiYgZGVmYXVsdFZhbHVlICE9PSBudWxsICYmIGRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMoZGVmYXVsdFZhbHVlKS5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgIHVybFBhcmFtcy5wdXNoKGBmaWVsZDoke2tleX09JHtkZWZhdWx0VmFsdWVba2V5XX1gKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIG9wZW4gbW9kZVxyXG4gICAgICAgKi9cclxuICAgICAgY29uc3Qgb3BlbiA9IGNvbmZpZy5vcGVuIHx8ICd3ZWInO1xyXG4gICAgICBjb25zdCBvcGVuV2hpdGVMaXN0cyA9IFsnd2ViJywgJ21lbnUnLCAnbmF0aXZlJ107XHJcbiAgICAgIGlmIChvcGVuICYmIG9wZW4gIT09ICd3ZWInICYmIG9wZW5XaGl0ZUxpc3RzLmluZGV4T2Yob3BlbikgIT09IC0xKSB7XHJcbiAgICAgICAgdXJsUGFyYW1zLnB1c2goYG9wZW49JHtvcGVufWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvKipcclxuICAgICAgICogdG9rZW5cclxuICAgICAgICogd2UgY2FuIGFkZCB0b2tlbiBpbiB1cmwgcGFyYW1zIHRvIGF2b2lkIGxvZ2luIGluIHN1cnZleTEyMyB3ZWJmb3JtXHJcbiAgICAgICAqIFRPRE86XHJcbiAgICAgICAqIG5lZWQgdG8gYXNrIEp1bnNoYW4gaG93IHRvIGdldCB1c2VyIHRva2VuIGluIHRoZSB3aWRnZXRcclxuICAgICAgICovXHJcbiAgICAgIFxyXG4gICAgICAvL2NvbnN0IHRva2VuID0gJ2ZnVTBsZGxXZlUwV2tLSlp0TGZNZUtMSWRnOXZmVDFZSnB3OEtFT2ZZMy1MV1c5eHZmNV85OE9GQXpIMk9LbW81eENtRnd5Slc3d3BYeEJWTDk4VjlDd1JjSWpBc1l5NkFkRmx6U3RFQWtfdkNzSldhRHlRMVV6WFFlY05hVmtleEY5dHZIbWlmSnEyVVEzeXFLeTZLSjZDYXhUb0FKY3hCYjNQT0lCbVZ1YW9pbk5Hc2U1bklmdGhaNlRJMHBVcU1wUUl3Q0s3c0xVYnFUU281Q0pPY1EuLic7XHJcbiAgICAgICBjb25zdCB0b2tlbiA9IHRoaXMucHJvcHMudG9rZW47XHJcbiAgICAgIGlmICh0b2tlbikge1xyXG4gICAgICAgIHVybFBhcmFtcy5wdXNoKGB0b2tlbj0ke3Rva2VufWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvKipcclxuICAgICAgICogbmVlZCB0byBzZXQgdmVyc2lvbiA+PTMuMiB0byB1c2UgaGlkZSBhbmQgZW1iZWQgcGFyYW1zXHJcbiAgICAgICAqL1xyXG4gICAgICB1cmxQYXJhbXMucHVzaCgndmVyc2lvbj1sYXRlc3QnKTtcclxuXHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBhZGQgYXV0b1JlZnJlc2g9M1xyXG4gICAgICAgKiB0byBhdXRvIHJlZnJlc2ggaW4gM3MgYWZ0ZXIgc3VibWl0XHJcbiAgICAgICAqL1xyXG4gICAgICB1cmxQYXJhbXMucHVzaCgnYXV0b1JlZnJlc2g9MycpO1xyXG5cclxuICAgICAgLyoqXHJcbiAgICAgICAqIGFkZCB0aW1lc3RhbXAgcmFuZG9uIHBhcmFtcyB0byBlbnN1cmUgdGhlIGlmcmFtZSBjYW4gcmVmcmVzaCBjb3JyZWN0bHlcclxuICAgICAgICogb25seSB3aGVuIHRpbWVzdGFtcCBpcyBkaWZmZXJlbnRcclxuICAgICAgICovXHJcbiAgICAgIC8vIGxldCBjb25maWdUaW1lc3RhbXAgPSBjb25maWcudGltZXN0YW1wO1xyXG4gICAgICAvLyBpZiAoY29uZmlnVGltZXN0YW1wICYmIHRoaXMuX2NhY2hlZFRpbWVTdGFtcCAhPT0gY29uZmlnVGltZXN0YW1wKSB7XHJcbiAgICAgIC8vICAgdGhpcy5fY2FjaGVkVGltZVN0YW1wID0gY29uZmlnVGltZXN0YW1wO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIC8vIHVybFBhcmFtcy5wdXNoKGB0aW1lc3RhbXA9JHt0aGlzLl9jYWNoZWRUaW1lU3RhbXB9YCk7XHJcbiAgICAgIFxyXG4gICAgICAvKipcclxuICAgICAgICogd2ViZm9ybSB1cmxcclxuICAgICAgICovXHJcbiAgICAgIHdlYmZvcm1VcmwgPSBzdXJ2ZXkxMjNTZXJ2aWNlLmdldFN1cnZleTEyM1dlYmZvcm1Vcmwoc3VydmV5SXRlbUlkLCB7XHJcbiAgICAgICAgcXVlcnlQYXJhbXM6IHVybFBhcmFtc1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gd2ViZm9ybVVybDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGRhdGEgc291cmNlIHJlbmRlcmVyXHJcbiAgICovXHJcbiAgZGF0YVJlbmRlciA9IChkczogRGF0YVNvdXJjZSkgPT4ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBpZiBtYXBWaWV3IGRhdGFzb3VyY2VcclxuICAgICAqL1xyXG4gICAgaWYgKGRzLnR5cGUgPT09IERhdGFTb3VyY2VUeXBlcy5XZWJNYXApIHtcclxuICAgICAgdGhpcy5tYXBWaWV3SGFuZGxlcihkcyk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpZiBmZWF0dXJlbGF5ZXJWaWV3IGRhdGFzb3VyY2VcclxuICAgICAqL1xyXG4gICAgaWYgKGRzLnR5cGUgPT09IERhdGFTb3VyY2VUeXBlcy5GZWF0dXJlTGF5ZXIpIHtcclxuICAgICAgdGhpcy5mZWF0dXJlTGF5ZXJWaWV3SGFuZGxlcihudWxsLCBkcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIDxkaXY+PC9kaXY+XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBjaGVjayB0aGUgd2ViZm9ybSBvcHRpb24gY2hhbmdlXHJcbiAgICovXHJcbiAgY2hlY2tXZWJmb3JtT3B0aW9uQ2hhbmdlZCA9IChuZXdPcHRpb24pID0+IHtcclxuICAgIGNvbnN0IGNhY2hlZE9wdGlvbiA9IHRoaXMuX2Zvcm1PcHRpb247XHJcbiAgICBpZiAoT2JqZWN0LmlzKGNhY2hlZE9wdGlvbiwgbmV3T3B0aW9uKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoIWNhY2hlZE9wdGlvbiAmJiBuZXdPcHRpb24pIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBpZiAoY2FjaGVkT3B0aW9uLnN1cnZleUl0ZW1JZCAhPT0gbmV3T3B0aW9uLnN1cnZleUl0ZW1JZCBcclxuICAgICAgfHwgY2FjaGVkT3B0aW9uLnBvcnRhbFVybCAhPT0gbmV3T3B0aW9uLnBvcnRhbFVybFxyXG4gICAgICB8fCBjYWNoZWRPcHRpb24udG9rZW4gIT09IG5ld09wdGlvbi50b2tlbiBcclxuICAgICAgfHwgY2FjaGVkT3B0aW9uLnN1cnZleVN0YXR1c0NvZGUgIT09IG5ld09wdGlvbi5zdXJ2ZXlTdGF0dXNDb2RlXHJcbiAgICAgIHx8IChjYWNoZWRPcHRpb24uaGlkZUVsZW1lbnRzID8gY2FjaGVkT3B0aW9uLmhpZGVFbGVtZW50cy5hc011dGFibGUoKSA6IFtdKS5zb3J0KCkuam9pbignLCcpICE9PSAobmV3T3B0aW9uLmhpZGVFbGVtZW50cyA/IG5ld09wdGlvbi5oaWRlRWxlbWVudHMuYXNNdXRhYmxlKCkgOiBbXSkuc29ydCgpLmpvaW4oJywnKSkge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHJlbmRlciBkc1xyXG4gICAqL1xyXG4gIHJlbmRlckRTKCkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBiZWNhdXNlIHdlJ3JlIG5vdyBjYWxsaW5nIHRoZSBzdXJ2ZXkganNhcGkgdG8gY3JlYXRlL3VwZGF0IHRoZSBzdXJ2ZXkgd2ViZm9ybVxyXG4gICAgICogd2UgbmVlZCB0byBkZXRlY3Qgd2ViZm9ybSBvcHRpb24gY2hhbmdlXHJcbiAgICAgKiBpZiB0aGUgdGhlIHN1cnZleUlkL2hpZGVFbGVtZW50cy90b2tlbi9wb3J0YWxVcmwgaXMgY2hhbmdlZCwgd2Ugc2hvdWxkIHJlY3JlYXRlIHRoZSB3ZWJmb3JtXHJcbiAgICAgKiBpZiB0aGUgZGVmYXVsdCB2YWx1ZSBjaGFuZ2VkLCBvciB0aGUgZW50aXJlIG9wdGlvbiBpcyBub3QgY2hhbmdlZCBhdCBhbGwsIGRvIG5vdCByZWNyZWF0ZSB0aGUgd2ViZm9ybVxyXG4gICAgICovXHJcbiAgICBsZXQgZHNJZCA9IG51bGw7XHJcbiAgICBsZXQgcm9vdERzSWQgPSBudWxsO1xyXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuYnVpbGRXZWJGb3JtQ29uZmlnKCk7XHJcbiAgICBpZiAodGhpcy5pc0RzQ29uZmlndXJlZCgpKSB7XHJcbiAgICAgIC8qKlxyXG4gICAgICAgKiBnZXQgdXNlZCBkYXRhIHNvdXJjZVxyXG4gICAgICAgKi9cclxuICAgICAgZHNJZCA9IHRoaXMucHJvcHMudXNlRGF0YVNvdXJjZXNbMF0uZGF0YVNvdXJjZUlkO1xyXG4gICAgICByb290RHNJZCA9IHRoaXMucHJvcHMudXNlRGF0YVNvdXJjZXNbMF0ucm9vdERhdGFTb3VyY2VJZDtcclxuICAgIH1cclxuICAgIGNvbnN0IG5lZWRSZWNyZWF0ZVdlYmZvcm0gPSB0aGlzLmNoZWNrV2ViZm9ybU9wdGlvbkNoYW5nZWQob3B0aW9ucyk7XHJcbiAgICB0aGlzLl9mb3JtT3B0aW9uID0gb3B0aW9ucztcclxuICAgIGNvbnN0IHdlYmZvcm1VcmwgPSB0aGlzLmdldFdlYmZvcm1VcmwoKTtcclxuICAgIGlmICh3ZWJmb3JtVXJsICYmICghdGhpcy53ZWJmb3JtIHx8IG5lZWRSZWNyZWF0ZVdlYmZvcm0pKSB7XHJcbiAgICAgIGNvbnN0IGZvcm1Ob2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycgKyB0aGlzLmRvbUlkKTtcclxuICAgICAgaWYgKGZvcm1Ob2RlKSB7XHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignIycgKyB0aGlzLmRvbUlkKS5pbm5lckhUTUwgPSAnJzsgLy8gY2xlYXIgdGhlIHdlYmZvcm0gYW5kIHJlbG9hZFxyXG4gICAgICAgIHRoaXMud2ViZm9ybSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5sb2FkU3VydmV5QVBJKClcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLndlYmZvcm0gPSBuZXcgdGhpcy5BUEkuU3VydmV5MTIzV2ViRm9ybShvcHRpb25zKTtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChkc0lkICYmIHJvb3REc0lkICYmIHRoaXMuaXNEc0NvbmZpZ3VyZWQoKSkge1xyXG4gICAgICAvLyByZXR1cm4gPERhdGFTb3VyY2VDb21wb25lbnQgdXNlRGF0YVNvdXJjZT17dGhpcy5wcm9wcy51c2VEYXRhU291cmNlc1swXX0+XHJcbiAgICAgIC8vICAge1xyXG4gICAgICAvLyAgICAgdGhpcy5kYXRhUmVuZGVyXHJcbiAgICAgIC8vICAgfVxyXG4gICAgICAvLyA8L0RhdGFTb3VyY2VDb21wb25lbnQ+XHJcbiAgICAgIHJldHVybiA8SmltdU1hcFZpZXdDb21wb25lbnQgdXNlTWFwV2lkZ2V0SWRzPXt0aGlzLnByb3BzLnVzZU1hcFdpZGdldElkc30gb25BY3RpdmVWaWV3Q2hhbmdlPXt0aGlzLm9uQWN0aXZlVmlld0NoYW5nZX0gPjwvSmltdU1hcFZpZXdDb21wb25lbnQ+XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIDxkaXY+PC9kaXY+O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogcmVuZGVyXHJcbiAgICovXHJcbiAgcmVuZGVyKCkge1xyXG4gICAgY29uc3Qgd2ViZm9ybVVybCA9IHRoaXMuZ2V0V2ViZm9ybVVybCgpO1xyXG4gICAgLy8gbGV0IG9wdGlvbnMgPSB0aGlzLmJ1aWxkV2ViRm9ybUNvbmZpZygpO1xyXG4gICAgbGV0IHJlc3VsdDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIGlmIG5vIHdlYmZvcm1VcmxcclxuICAgICAqL1xyXG4gICAgaWYgKCF3ZWJmb3JtVXJsKSB7XHJcbiAgICAgIHJlc3VsdCA9IDxkaXYgY2xhc3NOYW1lPVwic3VydmV5MTIzX19ub1N1cnZleVwiPlxyXG4gICAgICAgIDxXaWRnZXRQbGFjZWhvbGRlciBpY29uPXt0aGlzLmljb25TdXJ2ZXkxMjN9IG1lc3NhZ2U9e3RoaXMucHJvcHMuaW50bC5mb3JtYXRNZXNzYWdlKHsgaWQ6ICdfd2lkZ2V0TGFiZWwnLCBkZWZhdWx0TWVzc2FnZTogZGVmYXVsdE1lc3NhZ2VzLl93aWRnZXRMYWJlbCB9KX0gd2lkZ2V0SWQ9XCJcIiAvPlxyXG4gICAgICA8L2Rpdj5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmICghdGhpcy5kb21JZCkge1xyXG4gICAgICAgIHRoaXMudXBkYXRlRG9tSWQoKTtcclxuICAgICAgfVxyXG4gICAgICByZXN1bHQgPSA8ZGl2IGNsYXNzTmFtZT1cInN1cnZleTEyM19fd2ViZm9ybVwiPlxyXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZW1iZWQtY29udGFpbmVyXCIgaWQ9e3RoaXMuZG9tSWR9PjwvZGl2PlxyXG4gICAgICAgIHsvKiA8ZGl2IGNsYXNzTmFtZT1cImVtYmVkLWNvbnRhaW5lclwiIHJlZj17KGYpID0+IHRoaXMuaWZyYW1lQ29udGFpbmVyID0gZn0+XHJcbiAgICAgICAgICA8aWZyYW1lIG5hbWU9XCJzdXJ2ZXkxMjN3ZWJmb3JtXCIgd2lkdGg9XCI1MDBcIiBoZWlnaHQ9XCI0MDBcIiBzcmM9e3dlYmZvcm1Vcmx9IHJlZj17KGYpID0+IHRoaXMuc3VydmV5MTIzd2ViZm9ybSA9IGZ9PjwvaWZyYW1lPlxyXG4gICAgICAgIDwvZGl2PiAqL31cclxuICAgICAgICB7XHJcbiAgICAgICAgICAvLzxpZnJhbWUgc3JjPXt3ZWJmb3JtVXJsfSBuYW1lPVwic3VydmV5MTIzd2ViZm9ybVwiIHJlZj17KGYpID0+IHRoaXMuc3VydmV5MTIzd2ViZm9ybSA9IGZ9PjwvaWZyYW1lPlxyXG4gICAgICAgIH1cclxuICAgICAgPC9kaXY+XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBodG1sXHJcbiAgICAgKi9cclxuICAgIHJldHVybiA8ZGl2IGNzcz17Z2V0U3R5bGUodGhpcy5wcm9wcy50aGVtZSl9IGNsYXNzTmFtZT1cInN1cnZleTEyM1wiPlxyXG4gICAgICB7XHJcbiAgICAgICAgcmVzdWx0XHJcbiAgICAgIH1cclxuICAgICAge1xyXG4gICAgICAgIC8qXHJcbiAgICAgICAgICogcmVuZGVyIGRzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5yZW5kZXJEUygpXHJcbiAgICAgIH1cclxuICAgIDwvZGl2PlxyXG5cclxuICB9XHJcbn0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUFBO0FBd0JBO0FBQ0E7QUFFQTtBQUFBO0FBcEJBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZ0JBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBc1ZBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTNlQTtBQUVBOztBQUVBO0FBQ0E7O0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUE4REE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEyQkE7O0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7O0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUVBOzs7QUFHQTtBQUNBO0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBNENBOztBQUVBO0FBQ0E7QUFBQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFRQTtBQUVBOztBQUVBO0FBQ0E7QUFFQTtBQUdBOztBQUVBO0FBQ0E7QUFJQTtBQUNBO0FBQUE7OyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./your-extensions/widgets/survey/src/runtime/widget.tsx\n");

/***/ }),

/***/ "./your-extensions/widgets/survey/src/service/survey123.service.ts":
/*!*************************************************************************!*\
  !*** ./your-extensions/widgets/survey/src/service/survey123.service.ts ***!
  \*************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * survey123 service\n */\nvar Survey123Service = /** @class */ (function () {\n    function Survey123Service() {\n    }\n    /**\n     * get survey123 host url\n     */\n    Survey123Service.prototype.getSurvey123HostUrl = function () {\n        /**\n         * Beijing-R-D-Center/ExperienceBuilder/issues/88\n         * we need to check url host to see which survey123 host url we will use\n         * wabbuild.esri.com > survey123dec.arcgis.com\n         * experiencedev.arcgis.com > survey123dev.arcgis.com\n         * experienceqa.arcgis.com > survey123qa.arcgis.com\n         * experience.arcgis.com > survey123.arcgis.com\n         * default > survey123.arcgis.com\n         *\n         */\n        var url = 'https://survey123.arcgis.com';\n        // dev\n        if (window.hostEnv === 'dev') {\n            url = 'https://survey123dev.arcgis.com';\n        }\n        // qa\n        if (window.hostEnv === 'qa') {\n            url = 'https://survey123qa.arcgis.com';\n        }\n        return url;\n    };\n    /**\n    * get the api url\n    */\n    Survey123Service.prototype.getSurvey123HostAPIUrl = function () {\n        var url = this.getSurvey123HostUrl() + '/api/jsapi'; //  '/share/survey123webform-jsapi.js';\n        // only for debugger locally\n        // const isDebug: boolean = false;\n        // if (isDebug) {\n        //   url = `https://nanzhang.arcgis.com:8443/webclient/survey123webform-jsapi.js`;\n        // }\n        return url;\n    };\n    /**\n     * create survey by survey123 rest api\n     * @param title\n     * @param tags\n     * @param options\n     */\n    Survey123Service.prototype.createSurvey = function (title, tags, commonParams, options) {\n        var _this = this;\n        // options\n        options = Object.assign({\n            snippet: ''\n        }, options || {});\n        return Promise.resolve(true)\n            .then(function () {\n            if (!title || !tags || !commonParams || !commonParams.token || !commonParams.username) {\n                throw new Error('missing title, tags, username or token');\n            }\n        })\n            .then(function () {\n            var url = _this.getSurvey123HostUrl() + \"/api/survey/create\";\n            var params = {\n                title: title,\n                tags: tags.join(','),\n                snippet: options.snippet,\n                thumbnailUrl: options.thumbnailUrl,\n                token: commonParams.token,\n                username: commonParams.username,\n                portalUrl: commonParams.portalUrl || 'https://www.arcgis.com'\n            };\n            return fetch(url, {\n                mode: 'cors',\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json; charset=utf-8'\n                },\n                body: JSON.stringify(params)\n            })\n                .then(function (res) {\n                if (res.ok) {\n                    return res.json();\n                }\n                throw res;\n            });\n        });\n    };\n    /**\n     * query survey\n     * @param commonParams\n     * @param options\n     */\n    Survey123Service.prototype.querySurvey = function (commonParams, options) {\n        var _this = this;\n        // options\n        options = Object.assign({\n            isShared: false,\n            isPublished: true\n        }, options || {});\n        return Promise.resolve(true)\n            .then(function () {\n            if (!commonParams || !commonParams.token || !commonParams.username) {\n                throw new Error('missing token or username');\n            }\n        })\n            .then(function () {\n            var url = _this.getSurvey123HostUrl() + \"/api/survey/query\";\n            var params = {\n                isShared: options.isShared,\n                isPublished: options.isPublished,\n                token: commonParams.token,\n                username: commonParams.username,\n                portalUrl: commonParams.portalUrl || 'https://www.arcgis.com'\n            };\n            url = url + \"?\" + Object.keys(params).map(function (k) { return k + '=' + params[k]; }).join('&');\n            return fetch(url, {\n                mode: 'cors',\n                method: 'GET'\n            })\n                .then(function (res) {\n                if (res.ok) {\n                    return res.json();\n                }\n                throw res;\n            });\n        });\n    };\n    /**\n     * get survey123 designer url\n     */\n    Survey123Service.prototype.getSurvey123DesignerUrl = function (surveyItemId, options) {\n        // options\n        options = Object.assign({}, options || {});\n        var url = this.getSurvey123HostUrl() + \"/surveys/\" + surveyItemId + \"/design?embed=exb\";\n        if (options.portalUrl && options.portalUrl !== 'https://www.arcgis.com') {\n            url += \"&portalUrl=\" + options.portalUrl;\n        }\n        if (this.getSurvey123HostUrl() === 'https://survey123dev.arcgis.com' && !options.portalUrl || (options.portalUrl === 'https://www.arcgis.com')) {\n            url += \"&portalUrl=\" + options.portalUrl;\n        }\n        return url;\n    };\n    /**\n     *\n     * @param surveyItemId\n     * @param options\n     */\n    Survey123Service.prototype.getSurvey123WebformUrl = function (surveyItemId, options) {\n        // options\n        options = Object.assign({\n            queryParams: []\n        }, options || {});\n        var isDebug = false;\n        var url = this.getSurvey123HostUrl() + \"/share/\" + surveyItemId;\n        /**\n         * debugg only\n         */\n        if (isDebug) {\n            url = \"https://nanzhang.arcgis.com:8443/webclient/?appid=\" + surveyItemId;\n        }\n        if (options.queryParams.length > 0) {\n            url += \"\" + ((isDebug) ? '&' : '?') + options.queryParams.join('&');\n        }\n        return url;\n    };\n    /**\n     * get survey question fields\n     * @param surveyItemId\n     * @param commonParams\n     */\n    Survey123Service.prototype.getSurveyQuestionFields = function (surveyItemId, commonParams) {\n        var _this = this;\n        return Promise.resolve(true)\n            .then(function () {\n            if (!surveyItemId || !commonParams || !commonParams.token) {\n                throw new Error('missing surveyItemId or token');\n            }\n        })\n            .then(function () {\n            var url = _this.getSurvey123HostUrl() + \"/api/survey/\" + surveyItemId + \"/form\";\n            var params = {\n                token: commonParams.token\n            };\n            url = url + \"?\" + Object.keys(params).map(function (k) { return k + '=' + params[k]; }).join('&');\n            return fetch(url, {\n                mode: 'cors',\n                method: 'GET'\n            })\n                .then(function (res) {\n                if (res.ok) {\n                    return res.json();\n                }\n                throw res;\n            });\n        })\n            .then(function (res) {\n            var results = [];\n            if (res && res.questions && res.questions.length > 0) {\n                res.questions.forEach(function (q) {\n                    var shortType = (q.type + '').replace('esriQuestionType', '');\n                    if (q.fieldName || ['geopoint', 'polyline', 'polygon'].indexOf(shortType.toLowerCase()) >= 0) {\n                        results.push({\n                            name: q.fieldName || q.name,\n                            label: q.label\n                        });\n                    }\n                });\n            }\n            return results;\n        });\n    };\n    return Survey123Service;\n}());\nexports.Survey123Service = Survey123Service;\nexports.survey123Service = new Survey123Service();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi95b3VyLWV4dGVuc2lvbnMvd2lkZ2V0cy9zdXJ2ZXkvc3JjL3NlcnZpY2Uvc3VydmV5MTIzLnNlcnZpY2UudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi95b3VyLWV4dGVuc2lvbnMvd2lkZ2V0cy9zdXJ2ZXkvc3JjL3NlcnZpY2Uvc3VydmV5MTIzLnNlcnZpY2UudHM/ZjJjZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogc3VydmV5MTIzIGNvbW1vbiBwYXJhbXNcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgU3VydmV5MTIzQ29tbW9uUGFyYW1zIHtcclxuICB1c2VybmFtZT86IHN0cmluZztcclxuICB0b2tlbj86IHN0cmluZztcclxuICBmPzogc3RyaW5nO1xyXG4gIHBvcnRhbFVybD86IHN0cmluZztcclxufVxyXG5cclxuLyoqXHJcbiAqIHN1cnZleTEyMyBpZnJhbWUgbWVzc2FnZVxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBTdXJ2ZXkxMjNNZXNzYWdlIHtcclxuICBldmVudDogc3RyaW5nO1xyXG4gIGRhdGE6IGFueTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHN1cnZleTEyMyBzZXJ2aWNlXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU3VydmV5MTIzU2VydmljZSB7XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldCBzdXJ2ZXkxMjMgaG9zdCB1cmxcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0U3VydmV5MTIzSG9zdFVybCgpOiBzdHJpbmcge1xyXG4gICAgLyoqXHJcbiAgICAgKiBCZWlqaW5nLVItRC1DZW50ZXIvRXhwZXJpZW5jZUJ1aWxkZXIvaXNzdWVzLzg4XHJcbiAgICAgKiB3ZSBuZWVkIHRvIGNoZWNrIHVybCBob3N0IHRvIHNlZSB3aGljaCBzdXJ2ZXkxMjMgaG9zdCB1cmwgd2Ugd2lsbCB1c2VcclxuICAgICAqIHdhYmJ1aWxkLmVzcmkuY29tID4gc3VydmV5MTIzZGVjLmFyY2dpcy5jb21cclxuICAgICAqIGV4cGVyaWVuY2VkZXYuYXJjZ2lzLmNvbSA+IHN1cnZleTEyM2Rldi5hcmNnaXMuY29tXHJcbiAgICAgKiBleHBlcmllbmNlcWEuYXJjZ2lzLmNvbSA+IHN1cnZleTEyM3FhLmFyY2dpcy5jb21cclxuICAgICAqIGV4cGVyaWVuY2UuYXJjZ2lzLmNvbSA+IHN1cnZleTEyMy5hcmNnaXMuY29tXHJcbiAgICAgKiBkZWZhdWx0ID4gc3VydmV5MTIzLmFyY2dpcy5jb21cclxuICAgICAqIFxyXG4gICAgICovXHJcbiAgICBsZXQgdXJsID0gJ2h0dHBzOi8vc3VydmV5MTIzLmFyY2dpcy5jb20nO1xyXG5cclxuICAgIC8vIGRldlxyXG4gICAgaWYgKHdpbmRvdy5ob3N0RW52ID09PSAnZGV2Jykge1xyXG4gICAgICB1cmwgPSAnaHR0cHM6Ly9zdXJ2ZXkxMjNkZXYuYXJjZ2lzLmNvbSc7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcWFcclxuICAgIGlmICh3aW5kb3cuaG9zdEVudiA9PT0gJ3FhJykge1xyXG4gICAgICB1cmwgPSAnaHR0cHM6Ly9zdXJ2ZXkxMjNxYS5hcmNnaXMuY29tJztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdXJsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBnZXQgdGhlIGFwaSB1cmxcclxuICAqL1xyXG4gIHB1YmxpYyBnZXRTdXJ2ZXkxMjNIb3N0QVBJVXJsKCkge1xyXG4gICAgY29uc3QgdXJsID0gdGhpcy5nZXRTdXJ2ZXkxMjNIb3N0VXJsKCkgKyAnL2FwaS9qc2FwaSc7IC8vICAnL3NoYXJlL3N1cnZleTEyM3dlYmZvcm0tanNhcGkuanMnO1xyXG5cclxuICAgIC8vIG9ubHkgZm9yIGRlYnVnZ2VyIGxvY2FsbHlcclxuICAgIC8vIGNvbnN0IGlzRGVidWc6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIC8vIGlmIChpc0RlYnVnKSB7XHJcbiAgICAvLyAgIHVybCA9IGBodHRwczovL25hbnpoYW5nLmFyY2dpcy5jb206ODQ0My93ZWJjbGllbnQvc3VydmV5MTIzd2ViZm9ybS1qc2FwaS5qc2A7XHJcbiAgICAvLyB9XHJcbiAgICBcclxuICAgIHJldHVybiB1cmw7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogY3JlYXRlIHN1cnZleSBieSBzdXJ2ZXkxMjMgcmVzdCBhcGlcclxuICAgKiBAcGFyYW0gdGl0bGUgXHJcbiAgICogQHBhcmFtIHRhZ3MgXHJcbiAgICogQHBhcmFtIG9wdGlvbnMgXHJcbiAgICovXHJcbiAgcHVibGljIGNyZWF0ZVN1cnZleSh0aXRsZTogc3RyaW5nLCB0YWdzOiBzdHJpbmdbXSwgY29tbW9uUGFyYW1zOiBTdXJ2ZXkxMjNDb21tb25QYXJhbXMsIG9wdGlvbnM/OiB7XHJcbiAgICBzbmlwcGV0Pzogc3RyaW5nO1xyXG4gICAgdGh1bWJuYWlsVXJsPzogc3RyaW5nO1xyXG4gIH0pOiBQcm9taXNlPGFueT4ge1xyXG4gICAgLy8gb3B0aW9uc1xyXG4gICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xyXG4gICAgICBzbmlwcGV0OiAnJ1xyXG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XHJcblxyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgaWYgKCF0aXRsZSB8fCAhdGFncyB8fCAhY29tbW9uUGFyYW1zIHx8ICFjb21tb25QYXJhbXMudG9rZW4gfHwgIWNvbW1vblBhcmFtcy51c2VybmFtZSkge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdtaXNzaW5nIHRpdGxlLCB0YWdzLCB1c2VybmFtZSBvciB0b2tlbicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuZ2V0U3VydmV5MTIzSG9zdFVybCgpfS9hcGkvc3VydmV5L2NyZWF0ZWA7XHJcbiAgICAgICAgY29uc3QgcGFyYW1zOiBhbnkgPSB7XHJcbiAgICAgICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgICAgICB0YWdzOiB0YWdzLmpvaW4oJywnKSxcclxuICAgICAgICAgIHNuaXBwZXQ6IG9wdGlvbnMuc25pcHBldCxcclxuICAgICAgICAgIHRodW1ibmFpbFVybDogb3B0aW9ucy50aHVtYm5haWxVcmwsXHJcbiAgICAgICAgICB0b2tlbjogY29tbW9uUGFyYW1zLnRva2VuLFxyXG4gICAgICAgICAgdXNlcm5hbWU6IGNvbW1vblBhcmFtcy51c2VybmFtZSxcclxuICAgICAgICAgIHBvcnRhbFVybDogY29tbW9uUGFyYW1zLnBvcnRhbFVybCB8fCAnaHR0cHM6Ly93d3cuYXJjZ2lzLmNvbSdcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gZmV0Y2godXJsLCB7XHJcbiAgICAgICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04J1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBhcmFtcylcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgLnRoZW4oKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aHJvdyByZXM7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBxdWVyeSBzdXJ2ZXlcclxuICAgKiBAcGFyYW0gY29tbW9uUGFyYW1zIFxyXG4gICAqIEBwYXJhbSBvcHRpb25zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBxdWVyeVN1cnZleShjb21tb25QYXJhbXM6IFN1cnZleTEyM0NvbW1vblBhcmFtcywgb3B0aW9ucz86IHtcclxuICAgIGlzU2hhcmVkPzogYm9vbGVhbjtcclxuICAgIGlzUHVibGlzaGVkPzogYm9vbGVhbjtcclxuICB9KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIC8vIG9wdGlvbnNcclxuICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcclxuICAgICAgaXNTaGFyZWQ6IGZhbHNlLFxyXG4gICAgICBpc1B1Ymxpc2hlZDogdHJ1ZVxyXG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XHJcblxyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgaWYgKCFjb21tb25QYXJhbXMgfHwgIWNvbW1vblBhcmFtcy50b2tlbiB8fCAhY29tbW9uUGFyYW1zLnVzZXJuYW1lKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21pc3NpbmcgdG9rZW4gb3IgdXNlcm5hbWUnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICBsZXQgdXJsID0gYCR7dGhpcy5nZXRTdXJ2ZXkxMjNIb3N0VXJsKCl9L2FwaS9zdXJ2ZXkvcXVlcnlgO1xyXG4gICAgICAgIGNvbnN0IHBhcmFtczogYW55ID0ge1xyXG4gICAgICAgICAgaXNTaGFyZWQ6IG9wdGlvbnMuaXNTaGFyZWQsXHJcbiAgICAgICAgICBpc1B1Ymxpc2hlZDogb3B0aW9ucy5pc1B1Ymxpc2hlZCxcclxuICAgICAgICAgIHRva2VuOiBjb21tb25QYXJhbXMudG9rZW4sXHJcbiAgICAgICAgICB1c2VybmFtZTogY29tbW9uUGFyYW1zLnVzZXJuYW1lLFxyXG4gICAgICAgICAgcG9ydGFsVXJsOiBjb21tb25QYXJhbXMucG9ydGFsVXJsIHx8ICdodHRwczovL3d3dy5hcmNnaXMuY29tJ1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHVybCA9IGAke3VybH0/JHtPYmplY3Qua2V5cyhwYXJhbXMpLm1hcCgoaykgPT4gayArICc9JyArIHBhcmFtc1trXSkuam9pbignJicpfWA7XHJcblxyXG4gICAgICAgIHJldHVybiBmZXRjaCh1cmwsIHtcclxuICAgICAgICAgIG1vZGU6ICdjb3JzJyxcclxuICAgICAgICAgIG1ldGhvZDogJ0dFVCdcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgLnRoZW4oKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aHJvdyByZXM7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBnZXQgc3VydmV5MTIzIGRlc2lnbmVyIHVybFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRTdXJ2ZXkxMjNEZXNpZ25lclVybChzdXJ2ZXlJdGVtSWQ6IHN0cmluZywgb3B0aW9ucz86IHtcclxuICAgIHBvcnRhbFVybD86IHN0cmluZ1xyXG4gIH0pOiBzdHJpbmcge1xyXG4gICAgLy8gb3B0aW9uc1xyXG4gICAgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xyXG5cclxuICAgIH0sIG9wdGlvbnMgfHwge30pO1xyXG5cclxuICAgIGxldCB1cmwgPSBgJHt0aGlzLmdldFN1cnZleTEyM0hvc3RVcmwoKX0vc3VydmV5cy8ke3N1cnZleUl0ZW1JZH0vZGVzaWduP2VtYmVkPWV4YmA7XHJcbiAgICBpZiAob3B0aW9ucy5wb3J0YWxVcmwgJiYgb3B0aW9ucy5wb3J0YWxVcmwgIT09ICdodHRwczovL3d3dy5hcmNnaXMuY29tJykge1xyXG4gICAgICB1cmwgKz0gYCZwb3J0YWxVcmw9JHtvcHRpb25zLnBvcnRhbFVybH1gXHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5nZXRTdXJ2ZXkxMjNIb3N0VXJsKCkgPT09ICdodHRwczovL3N1cnZleTEyM2Rldi5hcmNnaXMuY29tJyAmJiAhb3B0aW9ucy5wb3J0YWxVcmwgfHwgKG9wdGlvbnMucG9ydGFsVXJsID09PSAnaHR0cHM6Ly93d3cuYXJjZ2lzLmNvbScpKSB7XHJcbiAgICAgIHVybCArPSBgJnBvcnRhbFVybD0ke29wdGlvbnMucG9ydGFsVXJsfWBcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdXJsO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHN1cnZleUl0ZW1JZCBcclxuICAgKiBAcGFyYW0gb3B0aW9ucyBcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0U3VydmV5MTIzV2ViZm9ybVVybChzdXJ2ZXlJdGVtSWQ6IHN0cmluZywgb3B0aW9ucz86IHtcclxuICAgIHF1ZXJ5UGFyYW1zPzogc3RyaW5nW107XHJcbiAgfSk6IHN0cmluZyB7XHJcbiAgICAvLyBvcHRpb25zXHJcbiAgICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7XHJcbiAgICAgIHF1ZXJ5UGFyYW1zOiBbXVxyXG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XHJcblxyXG4gICAgY29uc3QgaXNEZWJ1ZzogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIGxldCB1cmwgPSBgJHt0aGlzLmdldFN1cnZleTEyM0hvc3RVcmwoKX0vc2hhcmUvJHtzdXJ2ZXlJdGVtSWR9YDtcclxuXHJcbiAgICAvKipcclxuICAgICAqIGRlYnVnZyBvbmx5XHJcbiAgICAgKi9cclxuICAgIGlmIChpc0RlYnVnKSB7XHJcbiAgICAgIHVybCA9IGBodHRwczovL25hbnpoYW5nLmFyY2dpcy5jb206ODQ0My93ZWJjbGllbnQvP2FwcGlkPSR7c3VydmV5SXRlbUlkfWA7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGlmIChvcHRpb25zLnF1ZXJ5UGFyYW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgdXJsICs9IGAkeyhpc0RlYnVnKSA/ICcmJyA6ICc/J30ke29wdGlvbnMucXVlcnlQYXJhbXMuam9pbignJicpfWA7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHVybDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIGdldCBzdXJ2ZXkgcXVlc3Rpb24gZmllbGRzXHJcbiAgICogQHBhcmFtIHN1cnZleUl0ZW1JZCBcclxuICAgKiBAcGFyYW0gY29tbW9uUGFyYW1zIFxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRTdXJ2ZXlRdWVzdGlvbkZpZWxkcyhzdXJ2ZXlJdGVtSWQ6IHN0cmluZywgY29tbW9uUGFyYW1zOiBTdXJ2ZXkxMjNDb21tb25QYXJhbXMpOiBQcm9taXNlPEFycmF5PHtcclxuICAgIG5hbWU/OiBzdHJpbmc7XHJcbiAgICBsYWJlbD86IHN0cmluZztcclxuICB9Pj4ge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgaWYgKCFzdXJ2ZXlJdGVtSWQgfHwgIWNvbW1vblBhcmFtcyB8fCAhY29tbW9uUGFyYW1zLnRva2VuKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ21pc3Npbmcgc3VydmV5SXRlbUlkIG9yIHRva2VuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgbGV0IHVybCA9IGAke3RoaXMuZ2V0U3VydmV5MTIzSG9zdFVybCgpfS9hcGkvc3VydmV5LyR7c3VydmV5SXRlbUlkfS9mb3JtYDtcclxuICAgICAgICBjb25zdCBwYXJhbXM6IGFueSA9IHtcclxuICAgICAgICAgIHRva2VuOiBjb21tb25QYXJhbXMudG9rZW5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB1cmwgPSBgJHt1cmx9PyR7T2JqZWN0LmtleXMocGFyYW1zKS5tYXAoKGspID0+IGsgKyAnPScgKyBwYXJhbXNba10pLmpvaW4oJyYnKX1gO1xyXG5cclxuICAgICAgICByZXR1cm4gZmV0Y2godXJsLCB7XHJcbiAgICAgICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgIC50aGVuKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhyb3cgcmVzO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIH0pXHJcbiAgICAgIC50aGVuKChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcclxuXHJcbiAgICAgICAgaWYgKHJlcyAmJiByZXMucXVlc3Rpb25zICYmIHJlcy5xdWVzdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgcmVzLnF1ZXN0aW9ucy5mb3JFYWNoKChxOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc2hvcnRUeXBlID0gKHEudHlwZSArICcnKS5yZXBsYWNlKCdlc3JpUXVlc3Rpb25UeXBlJywgJycpO1xyXG4gICAgICAgICAgICBpZiAocS5maWVsZE5hbWUgfHwgWydnZW9wb2ludCcsICdwb2x5bGluZScsICdwb2x5Z29uJ10uaW5kZXhPZihzaG9ydFR5cGUudG9Mb3dlckNhc2UoKSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBxLmZpZWxkTmFtZSB8fCBxLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBsYWJlbDogcS5sYWJlbFxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgc3VydmV5MTIzU2VydmljZSA9IG5ldyBTdXJ2ZXkxMjNTZXJ2aWNlKCk7Il0sIm1hcHBpbmdzIjoiOztBQWtCQTs7QUFFQTtBQUNBO0FBQUE7QUEwUEE7QUF4UEE7O0FBRUE7QUFDQTtBQUNBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBOzs7OztBQUtBO0FBQ0E7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7QUFJQTtBQUNBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBOzs7O0FBSUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBOzs7O0FBSUE7QUFDQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQTFQQTtBQTRQQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./your-extensions/widgets/survey/src/service/survey123.service.ts\n");

/***/ }),

/***/ "esri/geometry/SpatialReference":
/*!*************************************************!*\
  !*** external "esri/geometry/SpatialReference" ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = __WEBPACK_EXTERNAL_MODULE_esri_geometry_SpatialReference__;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXNyaS9nZW9tZXRyeS9TcGF0aWFsUmVmZXJlbmNlLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZXNyaS9nZW9tZXRyeS9TcGF0aWFsUmVmZXJlbmNlXCI/ZGQ4MSJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfZXNyaV9nZW9tZXRyeV9TcGF0aWFsUmVmZXJlbmNlX187Il0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///esri/geometry/SpatialReference\n");

/***/ }),

/***/ "esri/tasks/support/Query":
/*!*******************************************!*\
  !*** external "esri/tasks/support/Query" ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = __WEBPACK_EXTERNAL_MODULE_esri_tasks_support_Query__;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXNyaS90YXNrcy9zdXBwb3J0L1F1ZXJ5LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZXNyaS90YXNrcy9zdXBwb3J0L1F1ZXJ5XCI/ZWIyMSJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfZXNyaV90YXNrc19zdXBwb3J0X1F1ZXJ5X187Il0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///esri/tasks/support/Query\n");

/***/ }),

/***/ "jimu-arcgis":
/*!******************************!*\
  !*** external "jimu-arcgis" ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = __WEBPACK_EXTERNAL_MODULE_jimu_arcgis__;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamltdS1hcmNnaXMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJqaW11LWFyY2dpc1wiPzlmMWMiXSwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlLmV4cG9ydHMgPSBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX2ppbXVfYXJjZ2lzX187Il0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///jimu-arcgis\n");

/***/ }),

/***/ "jimu-core":
/*!****************************!*\
  !*** external "jimu-core" ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = __WEBPACK_EXTERNAL_MODULE_jimu_core__;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamltdS1jb3JlLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiamltdS1jb3JlXCI/YzY5NSJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfamltdV9jb3JlX187Il0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///jimu-core\n");

/***/ }),

/***/ "jimu-ui":
/*!**************************!*\
  !*** external "jimu-ui" ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = __WEBPACK_EXTERNAL_MODULE_jimu_ui__;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiamltdS11aS5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy9leHRlcm5hbCBcImppbXUtdWlcIj8zNTQzIl0sInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9qaW11X3VpX187Il0sIm1hcHBpbmdzIjoiQUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///jimu-ui\n");

/***/ })

/******/ })});;