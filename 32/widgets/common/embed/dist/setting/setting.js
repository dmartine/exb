define(["jimu-core","jimu-ui","jimu-for-builder","jimu-ui/setting-components","jimu-ui/data-source-selector","jimu-ui/expression-builder"],(function(e,t,r,o,n,s){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=381)}({100:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Url="url",e.Code="code"}(t.EmbedType||(t.EmbedType={}))},11:function(e,t){e.exports=n},3:function(t,r){t.exports=e},381:function(e,t,r){"use strict";var o,n=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(3),a=r(6),i=r(7),u=r(4),p=r(382),c=r(100),l=r(383),d=r(11),f=r(72),g=function(e){function t(t){var r=e.call(this,t)||this;return r.supportedDsTypes=s.Immutable([d.AllDataSourceTypes.FeatureLayer,d.AllDataSourceTypes.FeatureQuery]),r.embedTypeChange=function(e){var t=r.props.config;r.props.config.embedType!==e&&r.props.onSettingChange({id:r.props.id,config:t.set("embedType",e)})},r.checkURL=function(e){if(!e||""===e)return!1;if(!new RegExp("^(([h][t]{2}[p][s])?://)").test(e))return r.setState({urlError:r.formatMessage("httpsUrlMessage")}),!1;var t=e.indexOf(".");return!(t<0||t===e.length-1)||(r.setState({urlError:r.formatMessage("invalidUrlMessage")}),!1)},r.embedCodeChangeRightAway=function(e){var t=r.props,o=t.config,n=t.id;r.props.onSettingChange({config:o.set("embedCode",e),id:n})},r.formatMessage=function(e){return r.props.intl.formatMessage({id:e,defaultMessage:p.default[e]})},r.onDataSourceSelected=function(e,t){if(e){var o=e.map((function(e){return{dataSourceId:e.dataSourceJson&&e.dataSourceJson.id,rootDataSourceId:e.rootDataSourceId}}));r.props.onSettingChange({id:r.props.id,useDataSources:o})}},r.onDataSourceRemoved=function(){r.props.onSettingChange({id:r.props.id,useDataSources:[]})},r.onToggleUseDataEnabled=function(e){r.props.onSettingChange({id:r.props.id,useDataSourcesEnabled:e})},r.openExpPopup=function(){return r.setState({isExpPopupOpen:!0})},r.closeExpPopup=function(){return r.setState({isExpPopupOpen:!1})},r.webAddressExpressionChange=function(e){var t=r.props,o=t.config;(0,t.onSettingChange)({id:t.id,config:o.set("expression",e)}),r.closeExpPopup()},r.staticUrlChange=function(e){var t;t=e&&e.target&&e.target.value?e.target.value.trim():"",r.checkURL(t)?r.setState({showUrlError:!1}):r.setState({showUrlError:!0})},r.staticUrlSubmit=function(e){if(e)if(r.checkURL(e)){var t=r.props,o=t.config;(0,t.onSettingChange)({id:t.id,config:o.set("staticUrl",e)})}else r.setState({showUrlError:!0})},r.isUsedDataSource=function(){var e=r.props,t=e.useDataSources;return e.useDataSourcesEnabled&&t&&t.length>0},r.state={showUrlError:!1,urlError:"",isExpPopupOpen:!1},r}return n(t,e),t.prototype.render=function(){var e,t=this,o=this.props,n=o.theme,a=o.config,p=o.useDataSourcesEnabled,g=a.embedType,m=this.props.useDataSources||[],h=m[0]?s.Immutable([m[0].dataSourceId]):s.Immutable([]);return s.jsx("div",{css:l.getStyle(this.props.theme)},s.jsx("div",{className:"widget-iframe jimu-widget"},s.jsx("div",null,s.jsx(i.SettingSection,null,s.jsx(i.SettingRow,{label:this.formatMessage("embedBy")}),s.jsx(i.SettingRow,null,s.jsx(u.Radio,{onChange:function(){return t.embedTypeChange(c.EmbedType.Url)},checked:g===c.EmbedType.Url}),s.jsx(u.Label,{className:"ml-2 ",onClick:function(e){return t.embedTypeChange(c.EmbedType.Url)}},this.formatMessage("websiteAddress"))),s.jsx(i.SettingRow,null,s.jsx(u.Radio,{onChange:function(){return t.embedTypeChange(c.EmbedType.Code)},checked:g===c.EmbedType.Code}),s.jsx(u.Label,{className:"ml-2 ",onClick:function(e){return t.embedTypeChange(c.EmbedType.Code)}},this.formatMessage("code"))),s.jsx(i.SettingRow,null,g===c.EmbedType.Url?s.jsx("div",{className:"d-flex flex-column w-100",style:{zIndex:3}},this.isUsedDataSource()?s.jsx(f.ExpressionInput,{dataSourceIds:h,attributeTypes:[s.JimuFieldType.String],onChange:this.webAddressExpressionChange,expression:a.expression&&a.expression.asMutable({deep:!0}),placeHolders:(e={},e[f.ExpressionInputFrom.Attribute]=this.formatMessage("attributeHint"),e[f.ExpressionInputFrom.Expression]=this.formatMessage("expressionHint"),e),closeExpPopup:this.closeExpPopup,openExpPopup:this.openExpPopup,isExpPopupOpen:this.state.isExpPopupOpen,from:[f.ExpressionInputFrom.Attribute,f.ExpressionInputFrom.Expression]}):s.jsx(u.TextInput,{type:"text",className:"w-100",placeholder:this.formatMessage("websitePlaceholder"),value:a.staticUrl,onChange:this.staticUrlChange,onAcceptValue:this.staticUrlSubmit,spellCheck:!1}),this.state.showUrlError&&s.jsx("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"}},s.jsx(u.Icon,{size:16,icon:r(384),color:n.colors.danger}),s.jsx("div",{style:{width:"calc(100% - 20px)",marginLeft:"4px",overflow:"hidden",textOverflow:"ellipsis",color:n.colors.danger}},this.state.urlError))):s.jsx(u.TextInput,{type:"textarea",style:{height:"300px"},className:"w-100",spellCheck:!1,placeholder:this.formatMessage("codePlaceholder"),value:a.embedCode||"",onAcceptValue:this.embedCodeChangeRightAway})),g===c.EmbedType.Url&&s.jsx(i.SettingRow,null,s.jsx("div",{className:"choose-ds w-100"},s.jsx(d.DataSourceSelector,{types:this.supportedDsTypes,selectedDataSourceIds:h,useDataSourcesEnabled:p,onToggleUseDataEnabled:this.onToggleUseDataEnabled,onSelect:this.onDataSourceSelected,onRemove:this.onDataSourceRemoved})))))))},t.mapExtraStateProps=function(e,t){return{appConfig:e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig,appTheme:e&&e.appStateInBuilder&&e.appStateInBuilder.theme}},t}(a.BaseWidgetSetting);t.default=g},382:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={_widgetLabel:"Embed",websiteAddress:"Website address",code:"Code",invalidUrlMessage:"Invalid URL. Please check and try again.",httpsUrlMessage:"Only HTTPS is supported.",codePlaceholder:"Paste the HTML code from the site you want to embed.",websitePlaceholder:"Enter URL (HTTPS only)",embedBy:"Embed by",attributeHint:"URL from an attribute",expressionHint:"URL by an expression"}},383:function(e,t,r){"use strict";var o=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var n,s=r(3);t.getStyle=function(e){return s.css(n||(n=o(["\n    label {\n      cursor: pointer;\n    }\n  "],["\n    label {\n      cursor: pointer;\n    }\n  "])))}},384:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 32"><path d="M16.492 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zm0 21.333a2 2 0 11.001 3.999 2 2 0 01-.001-3.999zm0-2.666a2 2 0 01-2-2v-8a2 2 0 114 0v8a2 2 0 01-2 2z"></path></svg>'},4:function(e,r){e.exports=t},6:function(e,t){e.exports=r},7:function(e,t){e.exports=o},72:function(e,t){e.exports=s}})}));