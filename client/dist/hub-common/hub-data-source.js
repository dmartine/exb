define(["jimu-core"],function(t){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=12)}([function(t,e,r){"use strict";r.d(e,"b",function(){return o}),r.d(e,"a",function(){return a});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function o(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var a=function(){return(a=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)}},,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.HubAnnotations="HUB_ANNOTATIONS",t.HubEvents="HUB_EVENTS"}(e.DataSourceTypes||(e.DataSourceTypes={}))},function(t,e,r){"use strict";r.d(e,"a",function(){return u}),r.d(e,"b",function(){return s});var n=r(0),o=r(8),a=r(9),i=r(17);function u(t){var e=Object(o.a)(t.url)+"/"+t.id,r=n.a({httpMethod:"GET"},t);return Object(a.a)(e,r).then(function(t){return r.rawResponse?t:t.feature})}function s(t){var e=Object(i.a)(t,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:n.a({where:"1=1",outFields:"*"},t.params)});return Object(a.a)(Object(o.a)(t.url)+"/query",e)}},function(e,r){e.exports=t},function(t,e,r){"use strict";r.r(e);var n=r(4),o=r(0),a=r(8),i=r(17),u=r(9);function s(t){var e=Object(a.a)(t.url)+"/addFeatures",r=Object(i.a)(t,["features","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:o.a({},t.params)});return Object(u.a)(e,r)}function c(t){var e=Object(a.a)(t.url)+"/updateFeatures",r=Object(i.a)(t,["features","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:o.a({},t.params)});return Object(u.a)(e,r)}function f(t){var e=Object(a.a)(t.url)+"/deleteFeatures",r=Object(i.a)(t,["where","objectIds","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:o.a({},t.params)});return Object(u.a)(e,r)}function d(t){var e=o.a({httpMethod:"GET"},t);return Object(u.a)(Object(a.a)(e.url)+"/"+e.featureId+"/attachments",e)}function p(t){var e=o.a({params:{}},t);return e.params.attachment=t.attachment,Object(u.a)(Object(a.a)(e.url)+"/"+e.featureId+"/addAttachment",e)}function h(t){var e=o.a({params:{}},t);return e.params.attachment=t.attachment,e.params.attachmentId=t.attachmentId,Object(u.a)(Object(a.a)(e.url)+"/"+e.featureId+"/updateAttachment",e)}function l(t){var e=o.a({params:{}},t);return e.params.attachmentIds=t.attachmentIds,Object(u.a)(Object(a.a)(e.url)+"/"+e.featureId+"/deleteAttachments",e)}function m(t){var e=Object(i.a)(t,["objectIds","relationshipId","definitionExpression","outFields"],{httpMethod:"GET",params:o.a({definitionExpression:"1=1",outFields:"*",relationshipId:0},t.params)});return Object(u.a)(Object(a.a)(t.url)+"/queryRelatedRecords",e)}function y(t){return Object(u.a)(Object(a.a)(t.url),t)}function b(t){return new Promise(function(e){if(!t.fields)return y({url:t.url}).then(function(r){e(t.fields=r.fields)});e(t.fields)}).then(function(e){var r=function(t){return t.reduce(function(t,e){var r=e.domain;return r&&"codedValue"===r.type&&(t[e.name]=r),t},{})}(e);if(Object.keys(r).length<1)return t.queryResponse;var n=t.queryResponse.features.map(function(t){var e={};for(var n in t.attributes)if(t.attributes.hasOwnProperty(n)){var a=t.attributes[n],i=r[n];e[n]=null!==a&&i?v(a,i):a}return o.a({},t,{attributes:e})});return o.a({},t.queryResponse,{features:n})})}function v(t,e){var r=e.codedValues.find(function(e){return t===e.code});return r?r.name:t}r.d(e,"getFeature",function(){return n.a}),r.d(e,"queryFeatures",function(){return n.b}),r.d(e,"addFeatures",function(){return s}),r.d(e,"updateFeatures",function(){return c}),r.d(e,"deleteFeatures",function(){return f}),r.d(e,"getAttachments",function(){return d}),r.d(e,"addAttachment",function(){return p}),r.d(e,"updateAttachment",function(){return h}),r.d(e,"deleteAttachments",function(){return l}),r.d(e,"queryRelated",function(){return m}),r.d(e,"getLayer",function(){return y}),r.d(e,"decodeValues",function(){return b})},function(t,e,r){"use strict";function n(t){console&&console.warn&&console.warn.apply(console,[t])}r.d(e,"a",function(){return n})},function(t,e,r){"use strict";function n(t){return"/"===(t=t.trim())[t.length-1]&&(t=t.slice(0,-1)),t}r.d(e,"a",function(){return n})},function(t,e,r){"use strict";var n=r(0);function o(t){return Object.keys(t).some(function(e){var r=t[e];if(!r)return!1;switch(r&&r.toParam&&(r=r.toParam()),r.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function a(t){var e={};return Object.keys(t).forEach(function(r){var n=t[r];if(n&&n.toParam&&(n=n.toParam()),n||0===n||"boolean"==typeof n||"string"==typeof n){var o;switch(n.constructor.name){case"Array":o=n[0]&&n[0].constructor&&"Object"===n[0].constructor.name?JSON.stringify(n):n.join(",");break;case"Object":o=JSON.stringify(n);break;case"Date":o=n.valueOf();break;case"Function":o=null;break;case"Boolean":o=n+"";break;default:o=n}(o||0===o||"string"==typeof o)&&(e[r]=o)}}),e}function i(t){var e=a(t);return Object.keys(e).map(function(t){return function(t,e){return encodeURIComponent(t)+"="+encodeURIComponent(e)}(t,e[t])}).join("&")}var u=function(){return function(t,e,r,n,o){t=t||"UNKNOWN_ERROR",e=e||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===e?t:e+": "+t,this.originalMessage=t,this.code=e,this.response=r,this.url=n,this.options=o}}();u.prototype=Object.create(Error.prototype),u.prototype.constructor=u;r(7);r.d(e,"a",function(){return d});var s="@esri/arcgis-rest-js",c={httpMethod:"POST",params:{f:"json"}};var f=function(t){function e(e,r,n,o,a){void 0===e&&(e="AUTHENTICATION_ERROR"),void 0===r&&(r="AUTHENTICATION_ERROR_CODE");var i=t.call(this,e,r,n,o,a)||this;return i.name="ArcGISAuthError",i.message="AUTHENTICATION_ERROR_CODE"===r?e:r+": "+e,i}return n.b(e,t),e.prototype.retry=function(t,e){var r=this;void 0===e&&(e=3);var o=0,a=function(i,u){t(r.url,r.options).then(function(t){var e=n.a({},r.options,{authentication:t});return o+=1,d(r.url,e)}).then(function(t){i(t)}).catch(function(t){"ArcGISAuthError"===t.name&&o<e?a(i,u):"ArcGISAuthError"===t.name&&o>=e?u(r):u(t)})};return new Promise(function(t,e){a(t,e)})},e}(u);function d(t,e){void 0===e&&(e={params:{f:"json"}});var r=n.a({httpMethod:"POST"},c,e,{params:n.a({},c.params,e.params),headers:n.a({},c.headers,e.headers)}),d=[],p=[];if(r.fetch||"undefined"==typeof fetch?(d.push("`fetch`"),p.push("`node-fetch`")):r.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(d.push("`Promise`"),p.push("`es6-promise`")),"undefined"==typeof FormData&&(d.push("`FormData`"),p.push("`isomorphic-form-data`")),!r.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+d.join(", ")+". We recommend installing the "+p.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var h=r.httpMethod,l=r.authentication,m=r.rawResponse,y=n.a({f:"json"},r.params),b=null,v={method:h,credentials:"same-origin"};return(l?l.getToken(t,{fetch:r.fetch}).catch(function(e){return e.url=t,e.options=r,b=e,Promise.resolve("")}):Promise.resolve("")).then(function(e){if(e.length&&(y.token=e),"GET"===v.method){var u=""===i(y)?t:t+"?"+i(y);r.maxUrlLength&&u.length>r.maxUrlLength?v.method="POST":t=u}var c=new RegExp("/items/.+/updateResources").test(t);return"POST"===v.method&&(v.body=function(t,e){var r=o(t)||e,n=a(t);if(r){var u=new FormData;return Object.keys(n).forEach(function(t){if("undefined"!=typeof Blob&&n[t]instanceof Blob){var e=n.fileName||n[t].name||t;u.append(t,n[t],e)}else u.append(t,n[t])}),u}return i(t)}(y,c)),v.headers=n.a({},r.headers),"undefined"!=typeof window||v.headers.referer||(v.headers.referer=s),o(y)||c||(v.headers["Content-Type"]="application/x-www-form-urlencoded"),r.fetch(t,v)}).then(function(e){if(!e.ok){var n=e.status,o=e.statusText;throw new u(o,"HTTP "+n,e,t,r)}if(m)return e;switch(y.f){case"json":case"geojson":return e.json();case"html":case"text":return e.text();default:return e.blob()}}).then(function(e){if("json"!==y.f&&"geojson"!==y.f||m)return e;var n=function(t,e,r,n,o){if(t.code>=400){var a=t.message,i=t.code;throw new u(a,i,t,e,n)}if(t.error){var s=t.error,c=(a=s.message,i=s.code,s.messageCode),d=c||i||"UNKNOWN_ERROR_CODE";if(498===i||499===i||"GWM_0003"===c||400===i&&"Unable to generate token."===a)throw o||new f(a,d,t,e,n);throw new u(a,d,t,e,n)}if("failed"===t.status||"failure"===t.status){a=void 0,i="UNKNOWN_ERROR_CODE";try{a=JSON.parse(t.statusMessage).message,i=JSON.parse(t.statusMessage).code}catch(e){a=t.statusMessage||t.message}throw new u(a,i,t,e,n)}return t}(e,t,0,r,b);if(b){var o=t.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];r.authentication.trustedServers[o]={token:[],expires:new Date(Date.now()+864e5)},b=null}return n})}},,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(13);e.default=n.HubDataSourceFactory},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(14),o=r(15),a=r(3),i=function(){function t(){}return t.prototype.createDataSource=function(t){var e=t.dataSourceJson;return e.type===a.DataSourceTypes.HubAnnotations?new n.HubAnnotationsDataSource(t):e.type===a.DataSourceTypes.HubEvents?new o.HubEventsDataSource(t):void console.error("Unimplemented data source type.",e.type)},t}();e.HubDataSourceFactory=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=r(6),i=r(5),u=function(t){function e(e,r,n,o){void 0===o&&(o=!0);var a=t.call(this)||this;return a.feature=o?a.convertOriginDataToData(e):e,a.user=r,a.dataSource=n,a}return n(e,t),e.prototype.getOriginData=function(){return null},e.prototype.convertOriginDataToData=function(t){return t},e.prototype.toJson=function(){var t=this.feature;return Object.assign(t,t.attributes)},e.prototype.getData=function(){return this.user?o({user:this.user},this.feature.attributes):this.feature.attributes},e.prototype.getId=function(){return this.feature.attributes.objectId+this.user.username},e.prototype.setId=function(){},e.prototype.getGeometry=function(){return null},e}(i.AbstractDataRecord);e.HubAnnotationDataRecord=u;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.doQuery=function(t){var e=this,r=i.SessionManager.getInstance(),n=o({authentication:r.getSession(),url:this.url},t);return a.queryFeatures(n).then(function(t){var r=t.features.map(function(t){return new u(t,void 0,e)});return e.records=r,r})},e.prototype.doQueryById=function(t){return new Promise(function(t,e){e("not implemented")})},e.prototype.mergeQuery=function(t,e){return null},e.prototype.addRecord=function(t){var e=this,r=i.SessionManager.getInstance(),n=t.getData(),o={attributes:n},s={authentication:r.getSession(),url:this.url,features:[o]};return a.addFeatures(s).then(function(t){var r=t.addResults[0].objectId;return n.OBJECTID=r,new u({attributes:n},null,e)})},e.prototype.addAnnotation=function(t,e,r){var n=i.SessionManager.getInstance().getSession().username,o=window&&window.location.toString(),a=new u({attributes:{author:n,source:o,target:e,feature_id:r,description:t,created_at:(new Date).getTime(),status:"pending"}},null,this);return this.addRecord(a)},e}(i.AbstractQueriableDataSource);e.HubAnnotationsDataSource=s},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var a=r(16),i=r(5),u=function(t){function e(e,r,n){var a=t.call(this)||this;if(a.feature={attributes:e.attributes,geometry:o({spatialReference:{wkid:4326,latestWkid:4326}},e.geometry)},a.feature.attributes.imageUrl=e.imageUrl,r.attributes.url){var i=+e.attributes.schemaVersion>1?"events":"pages";a.feature.attributes.slug=r.attributes.url+"/"+i+"/"+a.feature.attributes.url}return a.dataSource=n,a}return n(e,t),e.prototype.getOriginData=function(){return null},e.prototype.convertOriginDataToData=function(t){return t},e.prototype.toJson=function(){var t=this.feature;return Object.assign(t,t.attributes)},e.prototype.getData=function(){return this.feature.attributes},e.prototype.getId=function(){return this.feature.attributes.OBJECTID},e.prototype.setId=function(t){},e.prototype.getGeometry=function(){return null},e}(i.AbstractDataRecord);e.HubEventDataRecord=u;var s=function(t){function e(e){var r=t.call(this,e)||this;return r.orgId=e.dataSourceJson.orgId,r}return n(e,t),e.prototype.doQuery=function(t){var e=this,r=i.SessionManager.getInstance().getSession();return a.getEventServiceUrl(this.orgId,{authentication:r}).then(function(n){var i=a.getEventQueryFromType(t.type,o({},t.options,{authentication:r,url:n}));return a.searchEvents(i).then(function(t){var r=t.included;return t.data.map(function(t){return new u(t,r.find(function(e){return e.id===t.attributes.siteId}),e)})})})},e.prototype.doQueryById=function(t){return new Promise(function(t,e){e("not implemented")})},e.prototype.mergeQuery=function(t,e){return null},e}(i.AbstractQueriableDataSource);e.HubEventsDataSource=s},function(t,e,r){"use strict";r.r(e);var n=r(0),o=r(17),a=r(9),i=r(7),u=function(){function t(t){void 0===t&&(t=""),this.termStack=[],this.rangeStack=[],this.openGroups=0,this.q=t}return t.prototype.match=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.termStack=this.termStack.concat(t),this},t.prototype.in=function(t){var e="`in("+(t?'"'+t+'"':"")+")`";return this.hasRange||this.hasTerms?(t&&"*"!==t&&(this.q+=t+":"),this.commit()):(Object(i.a)(e+" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified."),this)},t.prototype.startGroup=function(){return this.commit(),this.openGroups>0&&(this.q+=" "),this.openGroups++,this.q+="(",this},t.prototype.endGroup=function(){return this.openGroups<=0?(Object(i.a)("`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified."),this):(this.commit(),this.openGroups--,this.q+=")",this)},t.prototype.and=function(){return this.addModifier("and")},t.prototype.or=function(){return this.addModifier("or")},t.prototype.not=function(){return this.addModifier("not")},t.prototype.from=function(t){return this.hasTerms?(Object(i.a)("`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Your query was not modified."),this):(this.rangeStack[0]=t,this)},t.prototype.to=function(t){return this.hasTerms?(Object(i.a)("`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Your query was not modified."),this):(this.rangeStack[1]=t,this)},t.prototype.boost=function(t){return this.commit(),this.q+="^"+t,this},t.prototype.toParam=function(){return this.commit(),this.cleanup(),this.q},t.prototype.clone=function(){return this.commit(),this.cleanup(),new t(this.q+"")},t.prototype.addModifier=function(t){return this.currentModifer?(Object(i.a)("You have called `"+this.currentModifer+"()` after `"+t+"()`. Your current query was not modified."),this):(this.commit(),""===this.q&&"not"!==t?(Object(i.a)("You have called `"+t+"()` without calling another method to modify your query first. Try calling `match()` first."),this):(this.currentModifer=t,this.q+=""===this.q?"":" ",this.q+=t.toUpperCase()+" ",this))},t.prototype.hasWhiteSpace=function(t){return/\s/g.test(t)},t.prototype.formatTerm=function(t){return t instanceof Date?t.getTime():"string"==typeof t&&this.hasWhiteSpace(t)?'"'+t+'"':t},t.prototype.commit=function(){var t=this;return this.currentModifer=void 0,this.hasRange&&(this.q+="["+this.formatTerm(this.rangeStack[0])+" TO "+this.formatTerm(this.rangeStack[1])+"]",this.rangeStack=[void 0,void 0]),this.hasTerms&&(this.q+=this.termStack.map(function(e){return t.formatTerm(e)}).join(" "),this.termStack=[]),this},Object.defineProperty(t.prototype,"hasTerms",{get:function(){return this.termStack.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRange",{get:function(){return this.rangeStack.length&&this.rangeStack[0]&&this.rangeStack[1]},enumerable:!0,configurable:!0}),t.prototype.cleanup=function(){if(this.openGroups>0)for(Object(i.a)("Automatically closing "+this.openGroups+" group(s). You can use `endGroup(...)` to remove this warning.");this.openGroups>0;)this.q+=")",this.openGroups--;var t=this.q;this.q=t.replace(/( AND ?| NOT ?| OR ?)*$/,""),t!==this.q&&Object(i.a)("`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified."),this.q=this.q.replace(/(\(\))*/,"")},t}(),s=r(8);function c(t){return void 0===t&&(t={}),t.portal?Object(s.a)(t.portal):t.authentication?t.authentication.portal:"https://www.arcgis.com/sharing/rest"}function f(t){return function t(e,r){var n,i;return n=c(i="string"==typeof e||e instanceof u?{httpMethod:"GET",params:{q:e}}:Object(o.a)(e,["q","num","start","sortField","sortOrder"],{httpMethod:"GET"}))+("item"===r?"/search":"/community/groups"),Object(a.a)(n,i).then(function(n){return n.nextStart&&-1!==n.nextStart&&(n.nextPage=function(){var o;return"string"==typeof e||e instanceof u?o={q:e,start:n.nextStart}:(o=e).start=n.nextStart,t(o,r)}),n})}(t,"item")}function d(t,e){return l(t,e).then(function(r){var n=function(t){var e=c(t);return e.match(/(qaext|\.mapsqa)\.arcgis.com/)?"https://hubqa.arcgis.com":e.match(/(devext|\.mapsdevext)\.arcgis.com/)?"https://hubdev.arcgis.com":e.match(/(www|\.maps)\.arcgis.com/)?"https://hub.arcgis.com":void 0}(e),o=r.url.match(/services\/(.*?)\/FeatureServer/);if(o[1])return n+"/api/v3/events/"+t+"/"+o[1]+"/FeatureServer/0"})}function p(t,e){return l(t,e).then(function(t){var e=t.url+"/0";return e=e.replace(/^http:/gi,"https:")})}function h(t,e){var r,n=Object.assign({},e);if("cancelled"===t)e.orderByFields||(n.orderByFields="EditDate DESC"),r="isCancelled=1 AND status<>'draft'";else if("draft"===t){e.orderByFields||(n.orderByFields="EditDate DESC");var o=e.authentication;r="Creator = '"+(o?o.username:null)+"' AND status = 'draft'"}else{e.orderByFields||(n.orderByFields="upcoming"===t?"startDate ASC":"startDate DESC"),r="endDate"+("upcoming"===t?">":"<=")+"CURRENT_TIMESTAMP AND (isCancelled<>1 OR isCancelled IS NULL) AND status<>'draft'"}return e.where?n.where=e.where+" AND "+r:n.where=r,n}function l(t,e){return f(n.a({q:"typekeywords:hubEventsLayer AND orgid:"+t},e)).then(function(t){var e=t;if(e.results&&e.results.length>0){var r=void 0;if(1===e.results.length)r=e.results[0];else if(e.results.length>1){var n=e.results.reduce(function(t,e){return e.typeKeywords.includes("View Service")?"public"===e.access?t.public=e:t.org=e:t.admin=e,t},{});r=n.admin||n.org||n.public}return r}throw Error("No events service found. Events are likely not enabled.")})}var m=r(4);function y(t){var e=n.a({returnGeometry:!0},t);return Object(m.b)(e).then(function(r){return r.features.length<=0?{data:[],included:[]}:e.authentication?e.authentication.getToken(e.url).then(function(n){return b(r.features,e.url,t,n)}):b(r.features,e.url,t)})}function b(t,e,r,n){var o=[],a=[],i=[],u=(new Date).getTime(),s="";if(t.forEach(function(t){var r=t.attributes,i=t.geometry,c=null;if(r.imageAttributes){var f=JSON.parse(r.imageAttributes);f.crop&&(c=e+"/"+r.OBJECTID+"/attachments/"+f.crop+"?v="+u,n&&(c+="&token="+n))}a.push({id:r.OBJECTID,type:"events",imageUrl:c,attributes:r,geometry:i});var d=r.siteId;null!=d&&-1===o.indexOf(d)&&(o.push(d),s+=s.length>0?" OR id:":"id:",s+=d)}),0===o.length)return{included:i,data:a};var c=r;return c.q=s,f(c).then(function(t){return t.results.forEach(function(t){i.push({id:t.id,type:"sites",attributes:{id:t.id,url:t.url}})}),{included:i,data:a}})}function v(t){return function(t){var e=c(t)+"/community/groups/"+t.id+"/join";return Object(a.a)(e,t)}({id:t.groupId,authentication:t.authentication})}function g(t){return function(t){var e=c(t)+"/community/groups/"+t.id+"/leave";return Object(a.a)(e,t)}({id:t.groupId,authentication:t.authentication})}r.d(e,"getEventServiceUrl",function(){return d}),r.d(e,"getEventFeatureServiceUrl",function(){return p}),r.d(e,"getEventQueryFromType",function(){return h}),r.d(e,"getEventServiceItem",function(){return l}),r.d(e,"searchEvents",function(){return y}),r.d(e,"registerForEvent",function(){return v}),r.d(e,"unregisterForEvent",function(){return g})},function(t,e,r){"use strict";r.d(e,"a",function(){return o});var n=r(0);function o(t,e,r){var o=n.a({params:{}},r,t);return o.params=e.reduce(function(e,r){return(t[r]||"boolean"==typeof t[r])&&(e[r]=t[r]),e},o.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce(function(t,e){return o[e]&&(t[e]=o[e]),t},{})}}])});
//# sourceMappingURL=hub-data-source.js.map