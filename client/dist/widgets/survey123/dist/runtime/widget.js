define(["jimu-core","jimu-ui","jimu-arcgis/arcgis-data-source"],function(e,t,r){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=745)}({2:function(t,r){t.exports=e},32:function(e,t){e.exports=r},4:function(e,r){e.exports=t},400:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.getSurvey123HostUrl=function(){var e="https://survey123.arcgis.com";return"dev"===window.hostEnv&&(e="https://survey123dev.arcgis.com"),"qa"===window.hostEnv&&(e="https://survey123qa.arcgis.com"),e},e.prototype.createSurvey=function(e,t,r,n){var o=this;return n=Object.assign({snippet:""},n||{}),Promise.resolve(!0).then(function(){if(!(e&&t&&r&&r.token&&r.username))throw new Error("missing title, tags, username or token")}).then(function(){var i=o.getSurvey123HostUrl()+"/api/survey/create",s={title:e,tags:t.join(","),snippet:n.snippet,thumbnailUrl:n.thumbnailUrl,token:r.token,username:r.username,portalUrl:r.portalUrl||"https://www.arcgis.com"};return fetch(i,{mode:"cors",method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(s)}).then(function(e){if(e.ok)return e.json();throw e})})},e.prototype.querySurvey=function(e,t){var r=this;return t=Object.assign({isShared:!1,isPublished:!0},t||{}),Promise.resolve(!0).then(function(){if(!e||!e.token||!e.username)throw new Error("missing token or username")}).then(function(){var n=r.getSurvey123HostUrl()+"/api/survey/query",o={isShared:t.isShared,isPublished:t.isPublished,token:e.token,username:e.username,portalUrl:e.portalUrl||"https://www.arcgis.com"};return n=n+"?"+Object.keys(o).map(function(e){return e+"="+o[e]}).join("&"),fetch(n,{mode:"cors",method:"GET"}).then(function(e){if(e.ok)return e.json();throw e})})},e.prototype.getSurvey123DesignerUrl=function(e,t){t=Object.assign({},t||{});var r=this.getSurvey123HostUrl()+"/surveys/"+e+"/design?embed=exb";return t.portalUrl&&"https://www.arcgis.com"!==t.portalUrl&&(r+="&portalUrl="+t.portalUrl),r},e.prototype.getSurvey123WebformUrl=function(e,t){t=Object.assign({queryParams:[]},t||{});var r=this.getSurvey123HostUrl()+"/share/"+e;return t.queryParams.length>0&&(r+="?"+t.queryParams.join("&")),r},e.prototype.getSurveyQuestionFields=function(e,t){var r=this;return Promise.resolve(!0).then(function(){if(!e||!t||!t.token)throw new Error("missing surveyItemId or token")}).then(function(){var n=r.getSurvey123HostUrl()+"/api/survey/"+e+"/form",o={token:t.token};return n=n+"?"+Object.keys(o).map(function(e){return e+"="+o[e]}).join("&"),fetch(n,{mode:"cors",method:"GET"}).then(function(e){if(e.ok)return e.json();throw e})}).then(function(e){var t=[];return e&&e.questions&&e.questions.length>0&&e.questions.forEach(function(e){e.fieldName&&t.push({name:e.fieldName,label:e.label})}),t})},e}();t.Survey123Service=n,t.survey123Service=new n},745:function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),i=r(2),s=r(4),a=r(32),u=r(400),M=r(746),c=function(e){function t(t){var n=e.call(this,t)||this;return n.iconSurvey123=r(747),n.state={featureLayerViewDS:null},n._dsManager=o.DataSourceManager.getInstance(),n._isMapViewAddedClickEvent=!1,n._cachedTimeStamp=n.props.config.timestamp,n.isDsConfigured=function(){return!(!n.props.useDataSources||1!==n.props.useDataSources.length)},n.doQuery=function(e){var t={geometry:e,spatialRelationship:"intersects",returnGeometry:!0};n.getUsedDataSource().getStatus()!==o.DataSourceStatus.Loading&&n.getUsedDataSource().load(t)},n.dataRender=function(e){return e.type===a.DataSourceTypes.MapView&&n.mapViewHandler(e),e.type===a.DataSourceTypes.FeatureLayerView&&n.featureLayerViewHandler(e),i.jsx("div",null)},n.listenSurvey123WebformEvent(),n}return n(t,e),t.prototype.componentDidUpdate=function(){var e=this,t=this.getUsedDataSource();if(t&&t.type===a.DataSourceTypes.FeatureLayerView){var r=t.getMapOrSceneViewDataSource();this._mapViewDSFromFeatureLayerView=r,this._extentWatch||(this._extentWatch=r.view.watch("extent",function(t){e.doQuery(t)}),this.doQuery(r.view.extent))}},t.prototype.getUsedDataSource=function(){var e=this.props.useDataSources,t=null;if(e&&e.length>0){var r=e[0].dataSourceId;t=this._dsManager.getDataSource(r)}return t},t.prototype.mapViewHandler=function(e){var t=this;if(e&&e.view&&!1===this._isMapViewAddedClickEvent){var r=e.view;r.on("click",function(e){var n=r.toMap({x:e.x,y:e.y});if(n){var o=n.latitude,i=n.longitude;t.postMessageToSurvey123Webform({event:"survey123:onDrawEnd",data:{x:i,y:o}})}}),this._isMapViewAddedClickEvent=!0}},t.prototype.featureLayerViewHandler=function(e){var t=e.getSelectedRecords();if(t.length>0){var r=t[0].feature,n=this.props.useDataSources[0].fields,o=(this.props.config.selectedSurveyQuestionFields||[])[0];if(!n[0]||!o)return console.error("cannot find selected featureLayerView field or selected survey question field"),console.error("featureLayerView field = ",n[0]),void console.error("selectedSurveyQuestionField = ",o);if(r&&n&&n.length>0&&o){var i=n[0],s=r.attributes[i];this.postMessageToSurvey123Webform({event:"survey123:setParams",data:["field:"+o+"="+s]});var a=r.geometry;a&&a.latitude&&a.longitude&&this.postMessageToSurvey123Webform({event:"survey123:setGeopoint",data:{x:a.longitude,y:a.latitude}})}}},t.prototype.listenSurvey123WebformEvent=function(){var e=this,t=function(t){if(t&&t.data){var r=void 0;try{r="string"==typeof t.data?JSON.parse(t.data):t.data&&t.data.payload?"string"==typeof t.data.payload?JSON.parse(t.data.payload):t.data.payload:t.data}catch(e){console.error(e)}var n=r.event,o=r.data;"survey123:onDrawPoint"===n&&e.onDrawPoint(o),"survey123:onFormLoaded"===n&&"survey123:onFormLoaded"===n&&r.contentHeight,"survey123:onSubmitted"===n&&console.log("survey123:onSubmitted!",o)}};window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent("onmessage",t)},t.prototype.onDrawPoint=function(e){console.log("start draw point"),this._mapViewDSFromFeatureLayerView&&this.mapViewHandler(this._mapViewDSFromFeatureLayerView)},t.prototype.postMessageToSurvey123Webform=function(e){this.survey123webform&&this.survey123webform.contentWindow?this.survey123webform.contentWindow.postMessage(JSON.stringify(e),"*"):console.log("cannot find survey123webform iframe contentWindow!")},t.prototype.getWebformUrl=function(){var e=this.props.config,t=e.surveyItemId,r=e.portalUrl||this.props.portalUrl||"https://www.arcgis.com",n=null;if(t){var o=[];"https://www.arcgis.com"!==r&&o.push("portalUrl="+r);var i=e.embeds||[];-1===i.indexOf("onSubmitted")&&(i=i.concat(["onSubmitted"])),i.length>0&&o.push("embed="+i.join(","));var s=e.hides||["navbar","header","description","footer","theme"];s.length>0&&o.push("hide="+s.join(","));var a=e.defaultValue;a&&"object"==typeof a&&null!==a&&void 0!==a&&Object.keys(a).forEach(function(e){o.push("field:"+e+"="+a[e])});var M=e.open||"web";M&&"web"!==M&&-1!==["web","menu","native"].indexOf(M)&&o.push("open="+M);var c=this.props.token;c&&o.push("token="+c),o.push("version=latest"),o.push("autoRefresh=3");var D=e.timestamp;D&&this._cachedTimeStamp!==D&&(this._cachedTimeStamp=D),o.push("timestamp="+this._cachedTimeStamp),n=u.survey123Service.getSurvey123WebformUrl(t,{queryParams:o})}return n},t.prototype.renderDS=function(){var e=null,t=null;return this.isDsConfigured()&&(e=this.props.useDataSources[0].dataSourceId,t=this.props.useDataSources[0].rootDataSourceId),e&&t?i.jsx(o.DataSourceComponent,{useDataSource:this.props.useDataSources[0]},this.dataRender):i.jsx("div",null)},t.prototype.render=function(){var e,t=this,r=this.getWebformUrl();return e=r?i.jsx("div",{className:"survey123__webform"},i.jsx("div",{className:"embed-container",ref:function(e){return t.iframeContainer=e}},i.jsx("iframe",{name:"survey123webform",width:"500",height:"400",src:r,ref:function(e){return t.survey123webform=e}}))):i.jsx("div",{className:"survey123__noSurvey"},i.jsx(s.WidgetPlaceholder,{icon:this.iconSurvey123,message:"Survey"})),i.jsx("div",{css:M.getStyle(this.props.theme),className:"survey123"},e,this.renderDS())},t}(o.BaseWidget);t.default=c},746:function(e,t,r){"use strict";var n=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,i=r(2);t.getStyle=function(e){return i.css(o||(o=n(["\n    &.survey123{\n        width: 100%;\n        height: 100%;\n        overflow: auto;\n        \n        .title{\n            font-weight: bold;\n        }\n    \n        .survey123__noSurvey{\n            width:100%;\n            height:100%;\n            text-align:center;\n        }\n    \n        .survey123__webform{\n            width:100%; \n            height:100%;\n\n            .embed-container {\n                position: relative; \n                height: 100%;\n                // padding-bottom:80%; \n                width: 100%;\n            } \n            \n            .embed-container iframe, \n            .embed-container object, \n            .embed-container iframe{\n                position: absolute; \n                top: 0; \n                left: 0; \n                width: 100%; \n                height: 100%;\n                border: 0px; \n            } \n            small{\n                position: absolute; \n                z-index: 40; \n                bottom: 0; \n                margin-bottom: -15px;\n            }\n        }    \n    }\n  "],["\n    &.survey123{\n        width: 100%;\n        height: 100%;\n        overflow: auto;\n        \n        .title{\n            font-weight: bold;\n        }\n    \n        .survey123__noSurvey{\n            width:100%;\n            height:100%;\n            text-align:center;\n        }\n    \n        .survey123__webform{\n            width:100%; \n            height:100%;\n\n            .embed-container {\n                position: relative; \n                height: 100%;\n                // padding-bottom:80%; \n                width: 100%;\n            } \n            \n            .embed-container iframe, \n            .embed-container object, \n            .embed-container iframe{\n                position: absolute; \n                top: 0; \n                left: 0; \n                width: 100%; \n                height: 100%;\n                border: 0px; \n            } \n            small{\n                position: absolute; \n                z-index: 40; \n                bottom: 0; \n                margin-bottom: -15px;\n            }\n        }    \n    }\n  "])))}},747:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjE1cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDE1IDE2IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPg0KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTIuMyAoNjcyOTcpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPg0KICAgIDx0aXRsZT5XaWRnZXRfU3VydmV5MTIzPC90aXRsZT4NCiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4NCiAgICA8ZyBpZD0iU3R5bGUiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPg0KICAgICAgICA8ZyBpZD0iVUktaWNvbnMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMDY0LjAwMDAwMCwgLTg0Ny4wMDAwMDApIiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iPg0KICAgICAgICAgICAgPGcgaWQ9IldpZGdldF9TdXJ2ZXkxMjMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwNjQuMDAwMDAwLCA4NDcuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPHBhdGggZD0iTTIsMTAuNSBMMiwxMSBMMiw5IEwyLDkuNSBMMyw5LjUgTDMsMTAuNSBMMiwxMC41IEwyLDExIEwyLDkgTDIsOS41IEwyLDEwLjUgWiBNMiw2LjUgTDIsNyBMMiw1IEwyLDUuNSBMMyw1LjUgTDMsNi41IEwyLDYuNSBMMiw3IEwyLDUgTDIsNS41IEwyLDYuNSBaIE0yLDEzIEwzLDEzIEwzLDE0IEMzLDE0LjU1MjI4NDcgMy40NDc3MTUyNSwxNSA0LDE1IEwxMywxNSBDMTMuNTUyMjg0NywxNSAxNCwxNC41NTIyODQ3IDE0LDE0IEwxNCwyIEMxNCwxLjQ0NzcxNTI1IDEzLjU1MjI4NDcsMSAxMywxIEw0LDEgQzMuNDQ3NzE1MjUsMSAzLDEuNDQ3NzE1MjUgMywyIEwzLDMgTDIsMyBMMiwyIEMyLDAuODk1NDMwNSAyLjg5NTQzMDUsMCA0LDAgTDEzLDAgQzE0LjEwNDU2OTUsLTIuMjIwNDQ2MDVlLTE2IDE1LDAuODk1NDMwNSAxNSwyIEwxNSwxNCBDMTUsMTUuMTA0NTY5NSAxNC4xMDQ1Njk1LDE2IDEzLDE2IEw0LDE2IEMyLjg5NTQzMDUsMTYgMiwxNS4xMDQ1Njk1IDIsMTQgTDIsMTMgWiBNMiwxMyBMMywxMyBMMywxNCBDMywxNC41NTIyODQ3IDMuNDQ3NzE1MjUsMTUgNCwxNSBMMTMsMTUgQzEzLjU1MjI4NDcsMTUgMTQsMTQuNTUyMjg0NyAxNCwxNCBMMTQsMiBDMTQsMS40NDc3MTUyNSAxMy41NTIyODQ3LDEgMTMsMSBMNCwxIEMzLjQ0NzcxNTI1LDEgMywxLjQ0NzcxNTI1IDMsMiBMMywzIEwyLDMgTDIsMiBDMiwwLjg5NTQzMDUgMi44OTU0MzA1LDAgNCwwIEwxMywwIEMxNC4xMDQ1Njk1LC0yLjIyMDQ0NjA1ZS0xNiAxNSwwLjg5NTQzMDUgMTUsMiBMMTUsMTQgQzE1LDE1LjEwNDU2OTUgMTQuMTA0NTY5NSwxNiAxMywxNiBMNCwxNiBDMi44OTU0MzA1LDE2IDIsMTUuMTA0NTY5NSAyLDE0IEwyLDEzIFogTTEyLjA3MTA2NzgsNi41MzU1MzM5MSBMMTEuMzYzOTYxLDUuODI4NDI3MTIgTDguNTM1NTMzOTEsOC42NTY4NTQyNSBMNy4xMjEzMjAzNCw3LjI0MjY0MDY5IEw2LjQxNDIxMzU2LDcuOTQ5NzQ3NDcgTDguNTM1NTMzOTEsMTAuMDcxMDY3OCBMMTIuMDcxMDY3OCw2LjUzNTUzMzkxIFogTTEyLjc3ODE3NDYsNy4yNDI2NDA2OSBMOS4yNDI2NDA2OSwxMC43NzgxNzQ2IEM4Ljg1MjExNjQsMTEuMTY4Njk4OSA4LjIxODk1MTQyLDExLjE2ODY5ODkgNy44Mjg0MjcxMiwxMC43NzgxNzQ2IEw1LjcwNzEwNjc4LDguNjU2ODU0MjUgQzUuMzE2NTgyNDksOC4yNjYzMjk5NiA1LjMxNjU4MjQ5LDcuNjMzMTY0OTggNS43MDcxMDY3OCw3LjI0MjY0MDY5IEw2LjQxNDIxMzU2LDYuNTM1NTMzOTEgQzYuODA0NzM3ODUsNi4xNDUwMDk2MSA3LjQzNzkwMjgzLDYuMTQ1MDA5NjEgNy44Mjg0MjcxMiw2LjUzNTUzMzkxIEw4LjUzNTUzMzkxLDcuMjQyNjQwNjkgTDEwLjY1Njg1NDIsNS4xMjEzMjAzNCBDMTEuMDQ3Mzc4NSw0LjczMDc5NjA1IDExLjY4MDU0MzUsNC43MzA3OTYwNSAxMi4wNzEwNjc4LDUuMTIxMzIwMzQgTDEyLjc3ODE3NDYsNS44Mjg0MjcxMiBDMTMuMTY4Njk4OSw2LjIxODk1MTQyIDEzLjE2ODY5ODksNi44NTIxMTY0IDEyLjc3ODE3NDYsNy4yNDI2NDA2OSBaIiBpZD0iQ29tYmluZWQtU2hhcGUiPjwvcGF0aD4NCiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMS41LDMuNSBMMS41LDQuNSBMMy41LDQuNSBMMy41LDMuNSBMMS41LDMuNSBaIE0xLjUsMi41IEwzLjUsMi41IEM0LjA1MjI4NDc1LDIuNSA0LjUsMi45NDc3MTUyNSA0LjUsMy41IEw0LjUsNC41IEM0LjUsNS4wNTIyODQ3NSA0LjA1MjI4NDc1LDUuNSAzLjUsNS41IEwxLjUsNS41IEMwLjk0NzcxNTI1LDUuNSAwLjUsNS4wNTIyODQ3NSAwLjUsNC41IEwwLjUsMy41IEMwLjUsMi45NDc3MTUyNSAwLjk0NzcxNTI1LDIuNSAxLjUsMi41IFogTTEuNSw3LjUgTDEuNSw4LjUgTDMuNSw4LjUgTDMuNSw3LjUgTDEuNSw3LjUgWiBNMS41LDYuNSBMMy41LDYuNSBDNC4wNTIyODQ3NSw2LjUgNC41LDYuOTQ3NzE1MjUgNC41LDcuNSBMNC41LDguNSBDNC41LDkuMDUyMjg0NzUgNC4wNTIyODQ3NSw5LjUgMy41LDkuNSBMMS41LDkuNSBDMC45NDc3MTUyNSw5LjUgMC41LDkuMDUyMjg0NzUgMC41LDguNSBMMC41LDcuNSBDMC41LDYuOTQ3NzE1MjUgMC45NDc3MTUyNSw2LjUgMS41LDYuNSBaIE0xLjUsMTEuNSBMMS41LDEyLjUgTDMuNSwxMi41IEwzLjUsMTEuNSBMMS41LDExLjUgWiBNMS41LDEwLjUgTDMuNSwxMC41IEM0LjA1MjI4NDc1LDEwLjUgNC41LDEwLjk0NzcxNTMgNC41LDExLjUgTDQuNSwxMi41IEM0LjUsMTMuMDUyMjg0NyA0LjA1MjI4NDc1LDEzLjUgMy41LDEzLjUgTDEuNSwxMy41IEMwLjk0NzcxNTI1LDEzLjUgMC41LDEzLjA1MjI4NDcgMC41LDEyLjUgTDAuNSwxMS41IEMwLjUsMTAuOTQ3NzE1MyAwLjk0NzcxNTI1LDEwLjUgMS41LDEwLjUgWiIgaWQ9IkNvbWJpbmVkLVNoYXBlIj48L3BhdGg+DQogICAgICAgICAgICA8L2c+DQogICAgICAgIDwvZz4NCiAgICA8L2c+DQo8L3N2Zz4="}})});
//# sourceMappingURL=widget.js.map