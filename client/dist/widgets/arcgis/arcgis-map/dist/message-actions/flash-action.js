define(["jimu-core"],function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=453)}({2:function(t,n){t.exports=e},312:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);function a(e,t,n){return new Promise(function(a,o){return r.loadArcGISJSAPIModules(["esri/layers/FeatureLayer"]).then(function(r){if(t.features.length<1)return a();var o=void 0;o=r[0];for(var l=t.features[0].layer,s=[],u={},c=0;c<l.fields.length;c++){var f=i(l.fields[c]);u[l.fields[c].name]=f.name,s.push(f)}var p=[];for(var d in t.features[0].attributes)if(u[d]){f={fieldName:u[d],label:d};p.push(f)}var m=[];t.features.forEach(function(e,t){var n=e;if(n.attributes){for(var r in n.attributes)n.attributes[u[r]]=n.attributes[r];n.attributes.exbfid=t}else n.attributes={exbfid:t};m.push(n)});var y=new o({id:n,title:l.title,source:m,fields:s,outFields:["*"],objectIdField:"exbfid",renderer:l.renderer,popupEnabled:!0,popupTemplate:{title:"information",content:[{type:"fields",fieldInfos:p}]}});e.map.add(y),y.on("layerview-create",function(e){return a()})})})}function i(e){return{name:e.name.replace(/\./g,"_").replace(/\(/g,"_").replace(/\)/g,"_"),alias:e.alias,type:e.type}}function o(e){return r.loadArcGISJSAPIModules(["esri/geometry/Extent"]).then(function(t){var n;if(n=t[0],!e||!e.length)return Promise.resolve(null);var r,a=null,i=e.length;for(r=0;r<i;r++){var o=e[r];if(o){var l=o.extent;if(!l&&"point"===o.type){var s=o;s.x&&s.y&&(l=new n({xmax:s.x,xmin:s.x,ymax:s.y,ymin:s.y,zmax:s.z,zmin:s.z,spatialReference:s.spatialReference}))}l&&(a=a?a.union(l):l)}}return a.width<0&&a.height<0?Promise.resolve(null):Promise.resolve(a)})}function l(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}}t.controlUIWidget=function(e,t,n,r,a){var i=e.ui;n&&(t?(i.add(n,r),a&&-1===i.specialComponents.indexOf(a)&&i.specialComponents.push(a)):i.remove(n))},t.createNewFeaturelayer=function(e,t){var n=[];return t&&Object.keys(t).forEach(function(r){e.map.layers.find(function(e){return e.id===r})?console.warn("the feature layer is already created"):n.push(a(e,t[r],r))}),0===n.length?null:Promise.all(n)},t.updateFeaturelayer=function(e,t){var n=[];return t&&Object.keys(t).forEach(function(r){var i=e.map.layers.find(function(e){return e.id===r});i&&(e.map.remove(i),n.push(a(e,t[r],r)))}),0===n.length?null:Promise.all(n)},t.selectFeature=function(e,t,n){var r=n,a=null,i=null;if(r||(i=t instanceof Array?t[0]:t)&&(r=i.layer&&i.layer.id),r){for(var o=e.allLayerViews,l=0;l<o.length;l++)o.getItemAt(l).layer.id===r&&(a=o.getItemAt(l));return a?{layerId:r,handle:a.highlight(t)}:null}},t.mapPanto=function(e,t){var n=t,r=e;if(n instanceof Array){if(0===n.length)return Promise.resolve();if(n[0].geometry){for(var a=[],i=0;i<n.length;i++)a.push(n[i].geometry);return o(a).then(function(e){return r.goTo(e.center)})}return n[0].extent?o(n).then(function(e){return r.goTo(e.center)}):Promise.resolve()}if(n.geometry){var s=n.geometry;return r.goTo(l(s))}if(n.extent)return s=n,r.goTo(l(s));return Promise.resolve()},t.flashFeaturesByQuery=function(e,t,n){if(t){for(var a=e.allLayerViews,i=null,o=0;o<a.length;o++)a.getItemAt(o).layer.id===t&&(i=a.getItemAt(o));if(!i)return null;r.loadArcGISJSAPIModules(["esri/tasks/support/Query","esri/Graphic"]).then(function(t){var r,a;r=t[0],a=t[1];var o=new r;o.where=n,o.outFields=["*"],o.returnGeometry=!0,i.layer.queryFeatures(o).then(function(t){if(t&&t.features&&t.features.length>0){var n=function(e){return["point","multipoint"].indexOf(e)>-1?{type:"simple-marker",style:"circle",color:[255,255,0,.8],size:"16px",outline:{color:[255,255,0,.8],width:3}}:["polyline"].indexOf(e)>-1?{type:"simple-line",color:[255,255,0,.8],width:3,style:"solid"}:["polygon","extent"].indexOf(e)>-1?{type:"simple-fill",color:[255,255,0,.5],style:"solid",outline:{color:[255,255,0,.8],width:3}}:["mesh"].indexOf(e)>-1?{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,0,.8]}}]}:null}(i.layer.geometryType);!function(t,r){for(var i=[],o=0,l=0;l<t.length;l++){var s=new a({geometry:t[l].geometry,symbol:n,attributes:t[l].attributes});i.push(s)}var u=function(){e.graphics.addMany(i),setTimeout(function(){e.graphics.removeMany(i),(o+=1)<r&&setTimeout(function(){u()},500)},500)};u()}(t.features,3)}})})}},t.handleFeature=function(e,t){var n=null;return e.clone?n=e.clone():(n=t.fromJSON(Object.assign({},e))).attributes=Object.assign({},e.attributes),n},t.getMapBaseRestoreData=function(e){return{mapContainer:e.mapContainer,state:e.state,MapView:e.MapView,SceneView:e.SceneView,Extent:e.Extent,Zoom:e.Zoom,ScaleBar:e.ScaleBar,Home:e.Home,Locate:e.Locate,Search:e.Search,Compass:e.Compass,Navigate:e.Navigate,Viewpoint:e.Viewpoint,mapView:e.mapView,sceneView:e.sceneView,mapViewDS:e.mapViewDS,sceneViewDS:e.sceneViewDS,overview:e.overview,zoomBtn:e.zoomBtn,scaleBar:e.scaleBar,homeBtn:e.homeBtn,locateBtn:e.locateBtn,earchBtn:e.searchBtn,compassBtn:e.compassBtn,navigateBtn:e.navigateBtn,extentWatch:e.extentWatch,dsManager:e.dsManager,highLightHandles:e.highLightHandles,mapBaseViewEventHandles:e.mapBaseViewEventHandles,initialViewPoint:e.initialViewPoint}},t.restoreMapBase=function(e,t){e.mapContainer=t.mapContainer,e.state=t.state,e.MapView=t.MapView,e.SceneView=t.SceneView,e.Extent=t.Extent,e.Zoom=t.Zoom,e.ScaleBar=t.ScaleBar,e.Home=t.Home,e.Locate=t.Locate,e.Search=t.Search,e.Compass=t.Compass,e.Navigate=t.Navigate,e.Viewpoint=t.Viewpoint,e.mapView=t.mapView,e.sceneView=t.sceneView,e.mapViewDS=t.mapViewDS,e.sceneViewDS=t.sceneViewDS,e.overview=t.overview,e.zoomBtn=t.zoomBtn,e.scaleBar=t.scaleBar,e.homeBtn=t.homeBtn,e.locateBtn=t.locateBtn,e.searchBtn=t.searchBtn,e.compassBtn=t.compassBtn,e.navigateBtn=t.navigateBtn,e.extentWatch=t.extentWatch,e.dsManager=t.dsManager,e.highLightHandles=t.highLightHandles,e.mapBaseViewEventHandles=t.mapBaseViewEventHandles,e.initialViewPoint=t.initialViewPoint}},453:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),i=n(312),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.filterMessageType=function(e){return e===a.MessageType.SpatialDataRecordsSelectionChange||e===a.MessageType.DataRecordsSelectionChange},t.prototype.filterMessage=function(e){return!0},t.prototype.onExecute=function(e,t){var n=this;return a.loadArcGISJSAPIModules(["esri/Graphic"]).then(function(r){var o;switch(o=r[0],e.type){case a.MessageType.SpatialDataRecordsSelectionChange:if(!t.layerId||!t.layerField||!t.messageField)break;for(var l=e,s=t.layerField.name+" IN ",u=t.messageField.name,c=t.messageField.type,f=[],p=0;p<l.records.length;p++){var d=l.records[p].getData()[u];f.indexOf(""+n.formatValue(d,c))>-1||f.push(""+n.formatValue(l.records[p].getData()[u],c))}s=f.length>0?s+"("+f.join(", ")+")":null;var m=[];if(l.records)for(p=0;p<l.records.length;p++)l.records[p].feature&&m.push(i.handleFeature(l.records[p].feature,o));var y={layerId:t.layerId,querySQL:s};a.getAppStore().dispatch(a.appActions.widgetMutableStatePropChange(n.widgetId,"flashActionValue",y))}return!0})},t.prototype.formatValue=function(e,t){return t===a.JimuFieldType.String?"'"+e+"'":t===a.JimuFieldType.Number?""+e:t===a.JimuFieldType.Date?"'"+e+"'":void 0},t}(a.AbstractMessageAction);t.default=o}})});
//# sourceMappingURL=flash-action.js.map