define(["jimu-core","jimu-ui","jimu-for-builder"],function(e,t,a){return function(e){var t={};function a(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(s,o,function(t){return e[t]}.bind(null,o));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=454)}({2:function(t,a){t.exports=e},355:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={sourceLabel:"Source",sourceDescript:"Select a web map/web scene, or any combination of two",initialMap:"Initial map",toolLabel:"Tools",zoomLabel:"Zoom",homeLabel:"Home button",locateLabel:"Locate button",scalebarLabel:"Scale bar",compassLabel:"Compass",toggleToPanOrRotate:"Rotate control",searchLocationLabel:"Location search",options:"Options",disableScrollZoom:"Disable scroll zoom",chooseALayer:"choose a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message Field"}},4:function(e,a){e.exports=t},454:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),o=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var n,i=a(2),r=a(4),l=a(6),c=a(355),p=[l.AllDataSourceTypes.FeatureQuery,l.AllDataSourceTypes.FeatureLayer],u=function(e){function t(t){var a=e.call(this,t)||this;return a.layerChange=function(e){var t=e.target.value;if(a.state.messageDataSource&&a.state.messageDataSource.getFetchedSchema())if(a.state.messageDataSource.getFetchedSchema().layerDefinition.id===t){var s=a.state.messageDataSource.getIdField(),o=a.getDataSourceSchema().fields[s];a.props.onSettingChange({actionId:a.props.actionId,config:a.props.config.set("layerId",t).set("messageField",o).set("layerField",o)})}else a.props.onSettingChange({actionId:a.props.actionId,config:a.props.config.set("layerId",t).set("layerField",void 0).set("messageField",void 0)});else a.props.onSettingChange({actionId:a.props.actionId,config:a.props.config.set("layerId",t).set("layerField",void 0).set("messageField",void 0)})},a.onSelectLayerField=function(e){var t=a.getLayerSchema(a.props.config.layerId);a.props.onSettingChange({actionId:a.props.actionId,config:a.props.config.set("layerField",t.fields[e])})},a.onSelectMessageField=function(e){var t=a.getDataSourceSchema();a.props.onSettingChange({actionId:a.props.actionId,config:a.props.config.set("messageField",t.fields[e])})},a.getLayerSchema=function(e){var t={layerDefinition:{},fields:{}};if(a.state.layers&&a.state.layers.length>0){var s=a.state.layers.find(function(t){return t.id===e});if(s)s.fields.forEach(function(e){var a=s.popupTemplate&&s.popupTemplate.fieldInfos&&s.popupTemplate.fieldInfos.find(function(t){return t.fieldName===e.name});a&&(a=a.toJSON()),t.fields[e.name]=i.dataSourceUtils.convertFieldToJimuField(e.toJSON(),a)})}return t},a.getDataSourceSchema=function(){var e=null;return a.state.messageDataSource&&(e=a.state.messageDataSource.getSchema()),e},a.getMessageUseDataSource=function(){var e=null,t=i.getAppStore().getState().appStateInBuilder.appConfig.widgets[a.props.messageWidgetId];return t&&t.useDataSources&&t.useDataSources[0]&&(e=t.useDataSources[0]),e},a.getMapViewDataSourceId=function(){var e=null,t=i.getAppStore().getState().appStateInBuilder.appConfig.widgets[a.props.widgetId];return t&&t.outputDataSources&&t.outputDataSources[0]&&(e=t.outputDataSources[0]),e},a.getLayersInMapViewDataSource=function(e){var t=e.view,a=t&&t.map,s=null;return a&&a.layers&&a.layers.length>0&&(s=a.layers.filter(function(e){return"feature"===e.type})),s},a.checkIsConfigDisabled=function(e){return!(e.layerId&&e.messageField&&e.layerField)},a.checkIsSameDatasource=function(){return!!(a.props.config.layerId&&a.state.messageDataSource&&a.state.messageDataSource.getFetchedSchema())&&a.props.config.layerId===a.state.messageDataSource.getFetchedSchema().layerDefinition.id},a.state={layers:void 0,messageDataSource:void 0,mapViewDatasource:void 0},a}return s(t,e),t.prototype.getStyle=function(){return i.css(n||(n=o(["\n      \n      .filter-data-setting {\n\n        .filter-field {\n          width: 45%;\n        }\n      }\n    "],["\n      \n      .filter-data-setting {\n\n        .filter-field {\n          width: 45%;\n        }\n      }\n    "])))},t.prototype.componentDidMount=function(){var e=this;this.props.onSettingChange({actionId:this.props.actionId,config:this.props.config});var t=this.getMessageUseDataSource();t&&(t.rootDataSourceId?l.AppDataSourceManager.getInstance().createDataSource(t.rootDataSourceId).then(function(a){var s=l.AppDataSourceManager.getInstance().getDataSource(t.dataSourceId);p.indexOf(s.type)>-1&&e.setState({messageDataSource:s})}):l.AppDataSourceManager.getInstance().createDataSource(t.dataSourceId).then(function(t){p.indexOf(t.type)>-1&&e.setState({messageDataSource:t})}));var a=this.getMapViewDataSourceId();a&&l.AppDataSourceManager.getInstance().createDataSource(a).then(function(t){var a=e.getLayersInMapViewDataSource(t);e.setState({layers:a,mapViewDatasource:t})})},t.prototype.componentDidUpdate=function(){this.props.onDisableDoneBtn(this.checkIsConfigDisabled(this.props.config))},t.prototype.render=function(){var e=this,t=this.getLayerSchema(this.props.config.layerId),a=this.getDataSourceSchema(),s=this.checkIsSameDatasource();return i.jsx("div",{css:this.getStyle()},i.jsx("div",{className:"filter-data-setting"},i.jsx("div",{className:"mt-3"},this.props.intl.formatMessage({id:"chooseALayer",defaultMessage:c.default.chooseALayer})),i.jsx("div",{className:"mt-2 mb-2",style:{overflow:"hidden"}},(!this.state.layers||0===this.state.layers.length)&&i.jsx(r.Input,{type:"select",value:this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone}),className:"float-right"},i.jsx("option",null,this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone}))),this.state.layers&&this.state.layers.length>0&&i.jsx(r.Input,{type:"select",value:this.props.config.layerId,className:"float-right",onChange:this.layerChange},i.jsx("option",{style:{display:"none"},value:void 0},this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone})),this.state.layers.toArray().map(function(e,t){return i.jsx("option",{key:t,value:e.id,title:e.title&&""!==e.title?e.title:e.id},e.title&&""!==e.title?e.title:e.id)}))),!s&&i.jsx("div",null,i.jsx("div",null,this.props.intl.formatMessage({id:"dataRelationShip",defaultMessage:c.default.dataRelationShip})),i.jsx("div",{className:"d-flex justify-content-between mt-2 mb-2"},i.jsx("div",{className:"filter-field",style:{overflow:"hidden"}},(!t||!t.fields)&&i.jsx(r.Input,{type:"select",value:this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone}),className:"float-right"},i.jsx("option",null,this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone}))),t&&t.fields&&!this.props.config.layerField&&i.jsx(r.Input,{type:"select",title:this.props.config.layerField&&this.props.config.layerField.name,value:this.props.config.layerField&&this.props.config.layerField.name,onChange:function(t){return e.onSelectLayerField(t.target.value)},className:"float-right"},i.jsx("option",{style:{display:"none"},value:void 0},this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone})),Object.keys(t.fields).map(function(e,a){return i.jsx("option",{key:a,value:t.fields[e].name,title:t.fields[e].name},t.fields[e].name)})),t&&t.fields&&this.props.config.layerField&&i.jsx(r.Input,{type:"select",title:this.props.config.layerField&&this.props.config.layerField.name,value:this.props.config.layerField&&this.props.config.layerField.name,onChange:function(t){return e.onSelectLayerField(t.target.value)},className:"float-right"},i.jsx("option",{style:{display:"none"},value:void 0},this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone})),Object.keys(t.fields).map(function(e,a){return i.jsx("option",{key:a,value:t.fields[e].name,title:t.fields[e].name},t.fields[e].name)}))),i.jsx("div",{className:"filter-field d-flex justify-content-center align-items-center border"},"equals")),i.jsx("div",{className:"d-flex justify-content-between"},i.jsx("div",{className:"filter-field d-flex justify-content-center align-items-center bg-gray-200 text-gray-700"},this.props.intl.formatMessage({id:"messageField",defaultMessage:c.default.messageField})+":"),i.jsx("div",{className:"filter-field",style:{overflow:"hidden"}},(!a||!a.fields)&&i.jsx(r.Input,{type:"select",value:this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone}),className:"float-right"},i.jsx("option",null,this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone}))),a&&a.fields&&i.jsx(r.Input,{type:"select",title:this.props.config.messageField&&this.props.config.messageField.name,value:this.props.config.messageField&&this.props.config.messageField.name,onChange:function(t){return e.onSelectMessageField(t.target.value)},className:"float-right"},i.jsx("option",{style:{display:"none"},value:void 0},this.props.intl.formatMessage({id:"mapNone",defaultMessage:c.default.mapNone})),Object.keys(a.fields).map(function(e,t){return i.jsx("option",{key:t,value:e,title:e},e)})))))))},t.defaultProps={config:{layerId:void 0,messageField:void 0,layerField:void 0}},t}(i.React.PureComponent);t.default=u},6:function(e,t){e.exports=a}})});
//# sourceMappingURL=flash-action-setting.js.map