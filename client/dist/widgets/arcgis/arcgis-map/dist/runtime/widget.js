define(["jimu-core/react","jimu-core","jimu-ui","jimu-arcgis/arcgis-data-source"],function(e,t,a,i){return function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=444)}({0:function(t,a){t.exports=e},2:function(e,a){e.exports=t},312:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2);function n(e,t,a){return new Promise(function(n,s){return i.loadArcGISJSAPIModules(["esri/layers/FeatureLayer"]).then(function(i){if(t.features.length<1)return n();var s=void 0;s=i[0];for(var r=t.features[0].layer,p=[],c={},d=0;d<r.fields.length;d++){var u=o(r.fields[d]);c[r.fields[d].name]=u.name,p.push(u)}var l=[];for(var m in t.features[0].attributes)if(c[m]){u={fieldName:c[m],label:m};l.push(u)}var h=[];t.features.forEach(function(e,t){var a=e;if(a.attributes){for(var i in a.attributes)a.attributes[c[i]]=a.attributes[i];a.attributes.exbfid=t}else a.attributes={exbfid:t};h.push(a)});var g=new s({id:a,title:r.title,source:h,fields:p,outFields:["*"],objectIdField:"exbfid",renderer:r.renderer,popupEnabled:!0,popupTemplate:{title:"information",content:[{type:"fields",fieldInfos:l}]}});e.map.add(g),g.on("layerview-create",function(e){return n()})})})}function o(e){return{name:e.name.replace(/\./g,"_").replace(/\(/g,"_").replace(/\)/g,"_"),alias:e.alias,type:e.type}}function s(e){return i.loadArcGISJSAPIModules(["esri/geometry/Extent"]).then(function(t){var a;if(a=t[0],!e||!e.length)return Promise.resolve(null);var i,n=null,o=e.length;for(i=0;i<o;i++){var s=e[i];if(s){var r=s.extent;if(!r&&"point"===s.type){var p=s;p.x&&p.y&&(r=new a({xmax:p.x,xmin:p.x,ymax:p.y,ymin:p.y,zmax:p.z,zmin:p.z,spatialReference:p.spatialReference}))}r&&(n=n?n.union(r):r)}}return n.width<0&&n.height<0?Promise.resolve(null):Promise.resolve(n)})}function r(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}}t.controlUIWidget=function(e,t,a,i,n){var o=e.ui;a&&(t?(o.add(a,i),n&&-1===o.specialComponents.indexOf(n)&&o.specialComponents.push(n)):o.remove(a))},t.createNewFeaturelayer=function(e,t){var a=[];return t&&Object.keys(t).forEach(function(i){e.map.layers.find(function(e){return e.id===i})?console.warn("the feature layer is already created"):a.push(n(e,t[i],i))}),0===a.length?null:Promise.all(a)},t.updateFeaturelayer=function(e,t){var a=[];return t&&Object.keys(t).forEach(function(i){var o=e.map.layers.find(function(e){return e.id===i});o&&(e.map.remove(o),a.push(n(e,t[i],i)))}),0===a.length?null:Promise.all(a)},t.selectFeature=function(e,t,a){var i=a,n=null,o=null;if(i||(o=t instanceof Array?t[0]:t)&&(i=o.layer&&o.layer.id),i){for(var s=e.allLayerViews,r=0;r<s.length;r++)s.getItemAt(r).layer.id===i&&(n=s.getItemAt(r));return n?{layerId:i,handle:n.highlight(t)}:null}},t.mapPanto=function(e,t){var a=t,i=e;if(a instanceof Array){if(0===a.length)return Promise.resolve();if(a[0].geometry){for(var n=[],o=0;o<a.length;o++)n.push(a[o].geometry);return s(n).then(function(e){return i.goTo(e.center)})}return a[0].extent?s(a).then(function(e){return i.goTo(e.center)}):Promise.resolve()}if(a.geometry){var p=a.geometry;return i.goTo(r(p))}if(a.extent)return p=a,i.goTo(r(p));return Promise.resolve()},t.flashFeaturesByQuery=function(e,t,a){if(t){for(var n=e.allLayerViews,o=null,s=0;s<n.length;s++)n.getItemAt(s).layer.id===t&&(o=n.getItemAt(s));if(!o)return null;i.loadArcGISJSAPIModules(["esri/tasks/support/Query","esri/Graphic"]).then(function(t){var i,n;i=t[0],n=t[1];var s=new i;s.where=a,s.outFields=["*"],s.returnGeometry=!0,o.layer.queryFeatures(s).then(function(t){if(t&&t.features&&t.features.length>0){var a=function(e){return["point","multipoint"].indexOf(e)>-1?{type:"simple-marker",style:"circle",color:[255,255,0,.8],size:"16px",outline:{color:[255,255,0,.8],width:3}}:["polyline"].indexOf(e)>-1?{type:"simple-line",color:[255,255,0,.8],width:3,style:"solid"}:["polygon","extent"].indexOf(e)>-1?{type:"simple-fill",color:[255,255,0,.5],style:"solid",outline:{color:[255,255,0,.8],width:3}}:["mesh"].indexOf(e)>-1?{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,0,.8]}}]}:null}(o.layer.geometryType);!function(t,i){for(var o=[],s=0,r=0;r<t.length;r++){var p=new n({geometry:t[r].geometry,symbol:a,attributes:t[r].attributes});o.push(p)}var c=function(){e.graphics.addMany(o),setTimeout(function(){e.graphics.removeMany(o),(s+=1)<i&&setTimeout(function(){c()},500)},500)};c()}(t.features,3)}})})}},t.handleFeature=function(e,t){var a=null;return e.clone?a=e.clone():(a=t.fromJSON(Object.assign({},e))).attributes=Object.assign({},e.attributes),a},t.getMapBaseRestoreData=function(e){return{mapContainer:e.mapContainer,state:e.state,MapView:e.MapView,SceneView:e.SceneView,Extent:e.Extent,Zoom:e.Zoom,ScaleBar:e.ScaleBar,Home:e.Home,Locate:e.Locate,Search:e.Search,Compass:e.Compass,Navigate:e.Navigate,Viewpoint:e.Viewpoint,mapView:e.mapView,sceneView:e.sceneView,mapViewDS:e.mapViewDS,sceneViewDS:e.sceneViewDS,overview:e.overview,zoomBtn:e.zoomBtn,scaleBar:e.scaleBar,homeBtn:e.homeBtn,locateBtn:e.locateBtn,earchBtn:e.searchBtn,compassBtn:e.compassBtn,navigateBtn:e.navigateBtn,extentWatch:e.extentWatch,dsManager:e.dsManager,highLightHandles:e.highLightHandles,mapBaseViewEventHandles:e.mapBaseViewEventHandles,initialViewPoint:e.initialViewPoint}},t.restoreMapBase=function(e,t){e.mapContainer=t.mapContainer,e.state=t.state,e.MapView=t.MapView,e.SceneView=t.SceneView,e.Extent=t.Extent,e.Zoom=t.Zoom,e.ScaleBar=t.ScaleBar,e.Home=t.Home,e.Locate=t.Locate,e.Search=t.Search,e.Compass=t.Compass,e.Navigate=t.Navigate,e.Viewpoint=t.Viewpoint,e.mapView=t.mapView,e.sceneView=t.sceneView,e.mapViewDS=t.mapViewDS,e.sceneViewDS=t.sceneViewDS,e.overview=t.overview,e.zoomBtn=t.zoomBtn,e.scaleBar=t.scaleBar,e.homeBtn=t.homeBtn,e.locateBtn=t.locateBtn,e.searchBtn=t.searchBtn,e.compassBtn=t.compassBtn,e.navigateBtn=t.navigateBtn,e.extentWatch=t.extentWatch,e.dsManager=t.dsManager,e.highLightHandles=t.highLightHandles,e.mapBaseViewEventHandles=t.mapBaseViewEventHandles,e.initialViewPoint=t.initialViewPoint}},32:function(e,t){e.exports=i},33:function(e,t,a){function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}var n=a(0),o=n.createElement("path",{d:"M38.784 9.778v2.962H3.236V9.778h.074L13.086.002l2.111 2.111-7.702 7.665h31.29zM3.236 21.628h31.327l-7.702 7.702 2.111 2.111 9.776-9.813h.037v-2.962H3.237v2.962z"});function s(e){return n.createElement("svg",i({width:39,height:32,viewBox:"0 0 39 32"},e),o)}e.exports=s,s.default=s},4:function(e,t){e.exports=a},444:function(e,t,a){"use strict";var i=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),n=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var o,s=a(2),r=a(4),p=a(445),c=a(449),d=function(e){function t(t){var a=e.call(this,t)||this;return a.startRenderMap=function(){a.setState({startLoadModules:!0}),a.props.dispatch(s.appActions.setWidgetReadyInjectDataSource(a.props.id))},a.getPlaceHolderImage=function(){var e=a.props.config.placeholderImage;e&&(new RegExp("^(.)+/sharing/rest/content/items/(.)+/info/(.)+").test(e)&&(e=s.SessionManager.getInstance().getSession()?e+"?token="+s.SessionManager.getInstance().getSession().token:e));return e},a.state={},a}return i(t,e),t.prototype.getStyle=function(){var e=this.props.theme;return s.css(o||(o=n(["\n      .widget-map{\n        padding: 0;\n        margin: 0;\n        height: 100%;\n        width: 100%;\n        z-index: -1;\n        .overview-container{\n          position: absolute;\n          top: 12px;\n          right: 12px;\n          width: 300px;\n          height: 200px;\n          border: 1px solid black;\n          z-index: 1;\n        }\n      \n        .extent-container{\n          background-color: rgba(0, 0, 0, 0.5);\n          position: absolute;\n          z-index: 2;\n        }\n      \n        .extent-btn-container{\n          button{\n            outline: none;\n          }\n          .previous-extent-btn{\n            color: #111;\n          }\n          .next-extent-btn{\n            color: #222;\n          }\n        }\n      }\n      \n      .mapswitch-container {\n        position: absolute;\n        z-index: 7;\n        width: 32px;\n        height: 32px;\n        bottom: 10px;\n        right: 10px;\n        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3)\n      }\n\n      .mapswitch-icon {\n        fill: black;\n        left: 8px;\n        top: 8px;\n        position: absolute;\n        display: block;\n      }\n\n      .widget-map-background {\n        background-color: ",";\n        position: absolute;\n        z-index: 1;\n      }\n\n      @keyframes appear {\n        0%{opacity:0}\n        25%{opacity:.25}\n        50%{opacity:.5;}\n        75%{opacity:.75}\n        100%{opacity:1;}\n      }\n\n      @keyframes disappear {\n        0%{opacity:1}\n        25%{opacity:.75}\n        50%{opacity:.5;}\n        75%{opacity:.25}\n        100%{opacity:0;}\n      }\n\n      .multisourcemap-item-appear {\n        animation: appear 300ms;\n        -webkit-animation: appear 300ms;\n        -moz-animation: appear 300ms;\n        animation-fill-mode: forwards;\n        -webkit-animation-fill-mode: forwards;\n        -moz-animation-fill-mode: forwards;\n        animation-timing-function: ease-in;\n        -webkit-animation-timing-function: ease-in;\n        -moz-animation-timing-function: ease-in;\n      }\n\n      .multisourcemap-item-disappear {\n        animation: disappear 300ms;\n        -webkit-animation: disappear 300ms;\n        -moz-animation: disappear 300ms;\n        animation-fill-mode: forwards;\n        -webkit-animation-fill-mode: forwards;\n        -moz-animation-fill-mode: forwards;\n        animation-timing-function: ease-in;\n        -webkit-animation-timing-function: ease-in;\n        -moz-animation-timing-function: ease-in;\n      }\n\n      .multisourcemap-item-appear-noanimate {\n        opacity: 1;\n      }\n\n      .multisourcemap-item-disappear-noanimate {\n        opacity: 0;\n      }\n      "],["\n      .widget-map{\n        padding: 0;\n        margin: 0;\n        height: 100%;\n        width: 100%;\n        z-index: -1;\n        .overview-container{\n          position: absolute;\n          top: 12px;\n          right: 12px;\n          width: 300px;\n          height: 200px;\n          border: 1px solid black;\n          z-index: 1;\n        }\n      \n        .extent-container{\n          background-color: rgba(0, 0, 0, 0.5);\n          position: absolute;\n          z-index: 2;\n        }\n      \n        .extent-btn-container{\n          button{\n            outline: none;\n          }\n          .previous-extent-btn{\n            color: #111;\n          }\n          .next-extent-btn{\n            color: #222;\n          }\n        }\n      }\n      \n      .mapswitch-container {\n        position: absolute;\n        z-index: 7;\n        width: 32px;\n        height: 32px;\n        bottom: 10px;\n        right: 10px;\n        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3)\n      }\n\n      .mapswitch-icon {\n        fill: black;\n        left: 8px;\n        top: 8px;\n        position: absolute;\n        display: block;\n      }\n\n      .widget-map-background {\n        background-color: ",";\n        position: absolute;\n        z-index: 1;\n      }\n\n      @keyframes appear {\n        0%{opacity:0}\n        25%{opacity:.25}\n        50%{opacity:.5;}\n        75%{opacity:.75}\n        100%{opacity:1;}\n      }\n\n      @keyframes disappear {\n        0%{opacity:1}\n        25%{opacity:.75}\n        50%{opacity:.5;}\n        75%{opacity:.25}\n        100%{opacity:0;}\n      }\n\n      .multisourcemap-item-appear {\n        animation: appear 300ms;\n        -webkit-animation: appear 300ms;\n        -moz-animation: appear 300ms;\n        animation-fill-mode: forwards;\n        -webkit-animation-fill-mode: forwards;\n        -moz-animation-fill-mode: forwards;\n        animation-timing-function: ease-in;\n        -webkit-animation-timing-function: ease-in;\n        -moz-animation-timing-function: ease-in;\n      }\n\n      .multisourcemap-item-disappear {\n        animation: disappear 300ms;\n        -webkit-animation: disappear 300ms;\n        -moz-animation: disappear 300ms;\n        animation-fill-mode: forwards;\n        -webkit-animation-fill-mode: forwards;\n        -moz-animation-fill-mode: forwards;\n        animation-timing-function: ease-in;\n        -webkit-animation-timing-function: ease-in;\n        -moz-animation-timing-function: ease-in;\n      }\n\n      .multisourcemap-item-appear-noanimate {\n        opacity: 1;\n      }\n\n      .multisourcemap-item-disappear-noanimate {\n        opacity: 0;\n      }\n      "])),e.colors.white)},t.prototype.componentDidMount=function(){this.state.startLoadModules||!window.jimuConfig.isInBuilder&&this.props.config.canPlaceHolder||this.startRenderMap()},t.prototype.componentWillUnmount=function(){s.getAppStore().getState().appConfig.widgets[this.props.id]||this.props.dispatch(s.appActions.widgetMutableStatePropChange(this.props.id,"restoreData",null))},t.prototype.render=function(){return this.props.useDataSources&&this.props.useDataSources[0]&&this.props.useDataSources[0].dataSourceId?this.state.startLoadModules?s.jsx("div",{css:this.getStyle(),className:"jimu-widget"},s.jsx(p.default,{baseWidgetProps:this.props,startLoadModules:this.state.startLoadModules})):s.jsx("div",{css:this.getStyle(),className:"jimu-widget"},s.jsx("div",{className:"widget-map jimu-widget"},s.jsx("div",{className:"jimu-widget",style:{position:"absolute",cursor:"pointer",backgroundImage:"url("+this.getPlaceHolderImage()+")",backgroundSize:"cover"},onClick:this.startRenderMap}))):s.jsx("div",{css:this.getStyle(),className:"jimu-widget"},s.jsx(r.WidgetPlaceholder,{icon:c,message:"Map",widgetId:this.props.id}))},t}(s.BaseWidget);t.default=d},445:function(e,t,a){"use strict";var i=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),o=a(4),s=a(446),r=a(33),p={firstMapVisible:[{zIndex:6,opacity:1},{zIndex:5,opacity:0}],secondMapVisible:[{zIndex:5,opacity:0},{zIndex:6,opacity:1}]},c=function(e){function t(t){var a=e.call(this,t)||this;a.mutableStatePropsMap={},a.reInitWidgetInstance=function(e){a.state=e,a.isReIniting=!0},a.getChangedState=function(e,t,a){var i={};if(a&&a[0]){for(var n=[],o=[],s=0;s<a.length;s++)e!==a[s].dataSourceId?n.push(a[s].dataSourceId):o.push(a[s].dataSourceId);o.length>0?(i.firstMapDsId=e,i.secondMapDsId=n[0]):0===o.length&&(n.indexOf(t)>-1?(n.splice(n.indexOf(t),1),i.firstMapDsId=n[0],i.secondMapDsId=t):(i.firstMapDsId=n[0],i.secondMapDsId=n[1]))}else i.firstMapDsId=null,i.secondMapDsId=null;return i.firstMapDsId!==e?i.firstMapDsId?(i.multiMapStyle=p.firstMapVisible,i.currentMapIndex=0):i.secondMapDsId?(i.multiMapStyle=p.secondMapVisible,i.currentMapIndex=1):(i.multiMapStyle=p.firstMapVisible,i.currentMapIndex=0):i.secondMapDsId?i.secondMapDsId!==t&&(i.multiMapStyle=p.secondMapVisible,i.currentMapIndex=1):(i.multiMapStyle=p.firstMapVisible,i.currentMapIndex=0),i},a.changeInitialMapDataSourceID=function(e){if(a.props.baseWidgetProps.useDataSources.length>1){var t=a.refs.firstMapInstance,i=a.refs.secondMapInstance;a.state.currentMapIndex?a.state.firstMapDsId&&a.state.firstMapDsId===e?(a.startChangeInitialMapAnimation(),t.goHome(!1)):i.goHome(!1):a.state.secondMapDsId&&a.state.secondMapDsId===e?(a.startChangeInitialMapAnimation(),i.goHome(!1)):t.goHome(!1)}},a.startChangeInitialMapAnimation=function(){var e,t=Object.assign({},a.state),i=a.refs.firstMapInstance,n=a.refs.secondMapInstance;a.state.currentMapIndex?(t.currentMapIndex=0,t.multiMapStyle=p.firstMapVisible,(e=n&&n.getViewPoint&&n.getViewPoint())&&i&&i.setViewPoint&&i.setViewPoint(e),a.setState(t)):(t.currentMapIndex=1,t.multiMapStyle=p.secondMapVisible,(e=i&&i.getViewPoint&&i.getViewPoint())&&n&&n.setViewPoint&&n.setViewPoint(e),a.setState(t))},a.switchMap=function(){var e=Object.assign({},a.state);e.useAnimation=!0;var t,i=a.refs.firstMapInstance,n=a.refs.secondMapInstance;a.state.currentMapIndex?(e.currentMapIndex=0,e.multiMapStyle=p.firstMapVisible,(t=n&&n.getViewPoint&&n.getViewPoint())&&i&&i.setViewPoint&&i.setViewPoint(t)):(e.currentMapIndex=1,e.multiMapStyle=p.secondMapVisible,(t=i&&i.getViewPoint&&i.getViewPoint())&&n&&n.setViewPoint&&n.setViewPoint(t));if(i&&n){var o=i.getViewType(),s=n.getViewType();o&&s&&o!==s&&(i.goToTilt(0),n.goToTilt(0),a.state.currentMapIndex?setTimeout(function(){i.goToTilt(45)},300):setTimeout(function(){n.goToTilt(45)},300))}a.setState(e,function(){setTimeout(function(){a.setState({useAnimation:!1})},500)})},a.handleMutableStatePropsChanged=function(e,t,i){a.mutableStatePropsMap[t]?-1===a.mutableStatePropsMap[t].indexOf(e)&&a.mutableStatePropsMap[t].push(e):a.mutableStatePropsMap[t]=[e];var o=[],s=a.refs.firstMapInstance,r=a.refs.secondMapInstance;s&&s.getViewType()&&o.push(a.state.firstMapDsId),r&&r.getViewType()&&o.push(a.state.secondMapDsId);for(var p=!0,c=0;c<o.length;c++)if(-1===a.mutableStatePropsMap[t].indexOf(o[c])){p=!1;break}p&&(delete a.mutableStatePropsMap[t],a.props.baseWidgetProps.dispatch(n.appActions.widgetMutableStatePropChange(a.props.baseWidgetProps.id,t,i)))},a.handleViewChanged=function(e,t){null!==t?a.getCurrentVisibleDsId()===e&&a.setState({activeViewPoint:t}):a.setState({activeViewPoint:null})},a.handleExtentChanged=function(e,t){a.getCurrentVisibleDsId()===e&&n.MessageManager.getInstance().publishMessage(t)},a.handleMapLoaded=function(e,t){a.forceUpdate()},a.isShowMapSwitchBtn=function(){var e=a.refs.firstMapInstance,t=a.refs.secondMapInstance;return!(!e||!t)&&(e.getMapLoadStatus()!==s.MapLoadStatus.Loading&&t.getMapLoadStatus()!==s.MapLoadStatus.Loading||void 0)},a.getCurrentVisibleDsId=function(){return 1===a.state.multiMapStyle[0].opacity?a.state.firstMapDsId:a.state.secondMapDsId};var i=n.MutableStoreManager.getInstance().getStateValue([a.props.baseWidgetProps.id,"restoreData",a.props.baseWidgetProps.id+"-restoreData-multimap"]);return i?(a.reInitWidgetInstance(i),a.props.baseWidgetProps.dispatch(n.appActions.widgetMutableStatePropChange(a.props.baseWidgetProps.id,"restoreData."+a.props.baseWidgetProps.id+"-restoreData-multimap",null))):a.state={currentMapIndex:0,multiMapStyle:p.firstMapVisible,firstMapDsId:null,secondMapDsId:null,activeViewPoint:null,useAnimation:!1},a.mutableStatePropsMap={},a}return i(t,e),t.prototype.componentDidMount=function(){if(!this.isReIniting&&this.props.baseWidgetProps.useDataSources){var e=this.props.baseWidgetProps.config.initialMapDataSourceID;e?e===(this.props.baseWidgetProps.useDataSources[0]&&this.props.baseWidgetProps.useDataSources[0].dataSourceId)?this.setState({firstMapDsId:this.props.baseWidgetProps.useDataSources[0]&&this.props.baseWidgetProps.useDataSources[0].dataSourceId,secondMapDsId:this.props.baseWidgetProps.useDataSources[1]&&this.props.baseWidgetProps.useDataSources[1].dataSourceId}):e===(this.props.baseWidgetProps.useDataSources[1]&&this.props.baseWidgetProps.useDataSources[1].dataSourceId)?this.setState({firstMapDsId:this.props.baseWidgetProps.useDataSources[1]&&this.props.baseWidgetProps.useDataSources[1].dataSourceId,secondMapDsId:this.props.baseWidgetProps.useDataSources[0]&&this.props.baseWidgetProps.useDataSources[0].dataSourceId}):this.setState({firstMapDsId:this.props.baseWidgetProps.useDataSources[0]&&this.props.baseWidgetProps.useDataSources[0].dataSourceId,secondMapDsId:this.props.baseWidgetProps.useDataSources[1]&&this.props.baseWidgetProps.useDataSources[1].dataSourceId}):this.setState({firstMapDsId:this.props.baseWidgetProps.useDataSources[0]&&this.props.baseWidgetProps.useDataSources[0].dataSourceId,secondMapDsId:this.props.baseWidgetProps.useDataSources[1]&&this.props.baseWidgetProps.useDataSources[1].dataSourceId})}},t.prototype.componentWillUnmount=function(){var e=n.getAppStore().getState().appConfig.widgets;if(e[this.props.baseWidgetProps.id]&&e[this.props.baseWidgetProps.id].outputDataSources===this.props.baseWidgetProps.outputDataSources&&e[this.props.baseWidgetProps.id].outputDataSources){var t={currentMapIndex:this.state.currentMapIndex,multiMapStyle:this.state.multiMapStyle,firstMapDsId:this.state.firstMapDsId,secondMapDsId:this.state.secondMapDsId,activeViewPoint:this.state.activeViewPoint,useAnimation:this.state.useAnimation};this.props.baseWidgetProps.dispatch(n.appActions.widgetMutableStatePropChange(this.props.baseWidgetProps.id,"restoreData."+this.props.baseWidgetProps.id+"-restoreData-multimap",t))}},t.prototype.componentWillReceiveProps=function(e){if(e.baseWidgetProps.useDataSources!==this.props.baseWidgetProps.useDataSources){var t=this.getChangedState(this.state.firstMapDsId,this.state.secondMapDsId,e.baseWidgetProps.useDataSources);e.baseWidgetProps.useDataSources&&e.baseWidgetProps.useDataSources[0]||(t.activeViewPoint=null),this.setState(t)}if(e.baseWidgetProps.stateProps&&e.baseWidgetProps.stateProps.initialMapDataSourceID){var a=e.baseWidgetProps.stateProps.initialMapDataSourceID;if(this.state.firstMapDsId===a){var i=this.refs.firstMapInstance;i&&i.goHome(!1)}if(this.state.secondMapDsId===a){var o=this.refs.secondMapInstance;o&&o.goHome(!1)}this.props.baseWidgetProps.dispatch(n.appActions.widgetStatePropChange(this.props.baseWidgetProps.id,"initialMapDataSourceID",null))}},t.prototype.componentDidUpdate=function(e){this.isReIniting?this.isReIniting=!1:this.props.baseWidgetProps.config.initialMapDataSourceID!==e.baseWidgetProps.config.initialMapDataSourceID&&this.changeInitialMapDataSourceID(this.props.baseWidgetProps.config.initialMapDataSourceID)},t.prototype.render=function(){var e=this;return n.React.createElement("div",{className:"jimu-widget",style:{position:"relative"}},n.React.createElement("div",{className:n.classNames("jimu-widget",{"multisourcemap-item-appear":this.state.useAnimation&&this.state.multiMapStyle[0].opacity,"multisourcemap-item-disappear":this.state.useAnimation&&!this.state.multiMapStyle[0].opacity,"multisourcemap-item-appear-noanimate":this.state.multiMapStyle[0].opacity,"multisourcemap-item-disappear-noanimate":!this.state.multiMapStyle[0].opacity}),style:{position:"absolute",zIndex:this.state.multiMapStyle[0].zIndex}},this.state.firstMapDsId&&n.React.createElement(s.default,{ref:"firstMapInstance",activeViewPoint:this.state.activeViewPoint,onViewChanged:this.handleViewChanged,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,onExtentChanged:this.handleExtentChanged,startLoadModules:this.props.startLoadModules,dataSourceId:this.state.firstMapDsId})),n.React.createElement("div",{className:n.classNames("jimu-widget",{"multisourcemap-item-appear":this.state.useAnimation&&this.state.multiMapStyle[1].opacity,"multisourcemap-item-disappear":this.state.useAnimation&&!this.state.multiMapStyle[1].opacity,"multisourcemap-item-appear-noanimate":this.state.multiMapStyle[1].opacity,"multisourcemap-item-disappear-noanimate":!this.state.multiMapStyle[1].opacity}),style:{position:"absolute",zIndex:this.state.multiMapStyle[1].zIndex}},this.state.secondMapDsId&&n.React.createElement(s.default,{ref:"secondMapInstance",activeViewPoint:this.state.activeViewPoint,onViewChanged:this.handleViewChanged,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,onExtentChanged:this.handleExtentChanged,startLoadModules:this.props.startLoadModules,dataSourceId:this.state.secondMapDsId})),this.props.baseWidgetProps.useDataSources.length>1&&this.isShowMapSwitchBtn()&&n.React.createElement("div",{className:"mapswitch-container"},n.React.createElement("div",{onClick:function(t){t.preventDefault(),e.switchMap()},className:"border-0 jimu-widget esri-widget--button"},n.React.createElement(o.Icon,{icon:r,width:16,height:16,className:"mapswitch-icon"}))))},t}(n.React.PureComponent);t.default=c},446:function(e,t,a){"use strict";var i=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var n,o=a(2),s=a(32),r=a(447),p=a(312),c=a(448);!function(e){e.Loading="LOADING",e.Loadok="LOADOK",e.LoadError="LOADERROR"}(n=t.MapLoadStatus||(t.MapLoadStatus={}));var d=function(e){function t(t){var a=e.call(this,t)||this;a.highLightHandles={},a.mapBaseViewEventHandles={},a.dsManager=o.DataSourceManager.getInstance(),a.initialViewPoint=null,a.onExtented=null,a.isReceiveExtentChange=!1,a.startRenderMap=function(){o.loadArcGISJSAPIModules(["esri/geometry/Extent","esri/widgets/Zoom","esri/widgets/ScaleBar","esri/widgets/Home","esri/widgets/Locate","esri/widgets/Search","esri/widgets/Compass","esri/widgets/NavigationToggle","esri/Viewpoint"]).then(function(e){a.Extent=e[0],a.Zoom=e[1],a.ScaleBar=e[2],a.Home=e[3],a.Locate=e[4],a.Search=e[5],a.Compass=e[6],a.Navigate=e[7],a.Viewpoint=e[8],a.setState({isModulesLoaded:!0})})},a.analysisMapView=function(){return a.mapView?Promise.resolve():a.MapView?(a.initMapView(),Promise.resolve()):o.loadArcGISJSAPIModules(["esri/views/MapView"]).then(function(e){return a.MapView=e[0],a.initMapView(),Promise.resolve()})},a.analysisSceneView=function(){return a.sceneView?Promise.resolve():a.SceneView?(a.initSceneView(),Promise.resolve()):o.loadArcGISJSAPIModules(["esri/views/SceneView"]).then(function(e){return a.SceneView=e[0],a.initSceneView(),Promise.resolve()})},a.initMapView=function(){if(a.extentWatch=null,!a.mapView){var e;a.initialViewPoint=null,e={map:a.state.mapDs.map,container:a.mapContainer};var t=a.state.mapDs.map;if(t.initialViewProperties&&t.initialViewProperties.viewpoint&&(a.initialViewPoint=t.initialViewProperties.viewpoint.clone()),!window.jimuConfig.isInBuilder&&a.props.baseWidgetProps.queryObject[a.props.baseWidgetProps.id]){var i=a.props.baseWidgetProps.queryObject[a.props.baseWidgetProps.id].substr("extent=".length),s=void 0;try{s=new a.Extent(JSON.parse(i))}catch(e){console.error("Bad extent URL parameter.")}s&&(e.extent=s)}a.mapView=new a.MapView(e),a.mapView.popup.spinnerEnabled=!1,a.mapView.ui.specialComponents=[],a.mapView.when(function(){if(a.goHome(!1).then(function(){var e=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,a.mapView.extent);e.addRelatedWidgetId(a.props.baseWidgetProps.id),a.props.onExtentChanged(a.props.dataSourceId,e),a.props.onViewChanged&&a.props.onViewChanged(a.props.dataSourceId,a.mapView.viewpoint.clone())}),a.setState({mapLoadStatus:n.Loadok},function(){a.props.onMapLoaded(a.props.dataSourceId,n.Loadok)}),a.props.baseWidgetProps.outputDataSources){var e=o.DataSourceManager.getInstance(),t=a.props.dataSourceId+"-"+a.props.baseWidgetProps.id+"-view";if(a.mapViewDS=e.getDataSource(t),!a.mapViewDS){var i={dataSourceJson:o.getAppStore().getState().appConfig.dataSources[a.props.dataSourceId+"-"+a.props.baseWidgetProps.id+"-view"],view:a.mapView};e.createDataSource(i).then(function(e){a.mapViewDS=e})}a.extentWatch||(a.extentWatch=a.mapView.watch("extent",function(e){e&&(clearTimeout(a.onExtented),a.onExtented=setTimeout(function(){if(e)if(a.isReceiveExtentChange)a.isReceiveExtentChange=!1;else{var t=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,e);t.addRelatedWidgetId(a.props.baseWidgetProps.id),a.props.onExtentChanged(a.props.dataSourceId,t)}},200))}))}}),a.bindMapBaseViewEvent(a.mapView)}},a.initSceneView=function(){if(a.extentWatch=null,!a.sceneView){a.initialViewPoint=null;var e,t=a.state.mapDs.map;t.initialViewProperties&&t.initialViewProperties.viewpoint&&(a.initialViewPoint=t.initialViewProperties.viewpoint.clone()),e={map:a.state.mapDs.map,container:a.mapContainer},a.sceneView=new a.SceneView(e),a.sceneView.popup.spinnerEnabled=!1,a.sceneView.ui.specialComponents=[],a.sceneView.when(function(){if(a.setState({mapLoadStatus:n.Loadok},function(){a.props.onMapLoaded(a.props.dataSourceId,n.Loadok)}),a.props.baseWidgetProps.outputDataSources){var e=o.DataSourceManager.getInstance(),t=a.props.dataSourceId+"-"+a.props.baseWidgetProps.id+"-view";if(a.sceneViewDS=e.getDataSource(t),!a.sceneViewDS){var i={dataSourceJson:o.getAppStore().getState().appConfig.dataSources[a.props.dataSourceId+"-"+a.props.baseWidgetProps.id+"-view"],view:a.sceneView};e.createDataSource(i).then(function(e){a.sceneViewDS=e})}a.extentWatch||(a.extentWatch=a.sceneView.watch("extent",function(e){e&&(clearTimeout(a.onExtented),a.onExtented=setTimeout(function(){if(e)if(a.isReceiveExtentChange)a.isReceiveExtentChange=!1;else{var t=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,e);t.addRelatedWidgetId(a.props.baseWidgetProps.id),a.props.onExtentChanged(a.props.dataSourceId,t)}},200))})),setTimeout(function(){a.goHome(!1).then(function(){var e=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,a.sceneView.extent);e.addRelatedWidgetId(a.props.baseWidgetProps.id),a.props.onExtentChanged(a.props.dataSourceId,e),a.props.onViewChanged&&a.props.onViewChanged(a.props.dataSourceId,a.sceneView.viewpoint.clone())})},500)}}),a.bindMapBaseViewEvent(a.sceneView)}},a.updateMapView=function(e){if(a.mapView.ui)for(var t in a.mapView.ui.components=[],e)switch(t){case"canZoom":if(!a.zoomBtn||a.zoomBtn.view!==a.mapView){var i=new(0,a.Zoom)({view:a.mapView});a.zoomBtn=i}p.controlUIWidget(a.mapView,e[t],a.zoomBtn,"top-left");break;case"canScale":if(!a.scaleBar||a.scaleBar.view!==a.mapView){var n=new(0,a.ScaleBar)({view:a.mapView,unit:"dual"});a.scaleBar=n}p.controlUIWidget(a.mapView,e[t],a.scaleBar,"bottom-left");break;case"canGoHome":if(!a.homeBtn||a.homeBtn.view!==a.mapView){var o=new(0,a.Home)({view:a.mapView,viewpoint:a.initialViewPoint});a.homeBtn=o}p.controlUIWidget(a.mapView,e[t],a.homeBtn,"top-left");break;case"canSearch":if(!a.searchBtn||a.searchBtn.view!==a.mapView){var s=new(0,a.Search)({view:a.mapView});a.searchBtn=s}p.controlUIWidget(a.mapView,e[t],a.searchBtn,"top-right","search");break;case"canOverviewMap":a.overview&&a.overview.parentMapView===a.mapView||(a.overview&&a.overview.destroy(),a.overview=new r.default({webMapId:a.getMapDsId(),parentMapView:a.mapView,parentMap:a.state.mapDs.map})),!e[t]&&a.mapContainer.getElementsByClassName("overview-container").length>0?a.mapContainer.getElementsByClassName("overview-container")[0].parentNode.removeChild(a.overview.elementContainer):e[t]&&a.mapContainer.getElementsByClassName("overview-container").length<1&&a.mapContainer.appendChild(a.overview.elementContainer);break;case"canLocate":if(!a.locateBtn||a.locateBtn.view!==a.mapView){var c=new(0,a.Locate)({view:a.mapView});a.locateBtn=c}p.controlUIWidget(a.mapView,e[t],a.locateBtn,"top-left")}},a.updateSceneView=function(e){if(a.sceneView.ui){for(var t in a.sceneView.ui.components=[],e)switch(t){case"canZoom":if(!a.zoomBtn||a.zoomBtn.view!==a.sceneView){var i=new(0,a.Zoom)({view:a.sceneView});a.zoomBtn=i}p.controlUIWidget(a.sceneView,e[t],a.zoomBtn,"top-left");break;case"canGoHome":if(!a.homeBtn||a.homeBtn.view!==a.sceneView){var n=new(0,a.Home)({view:a.sceneView,viewpoint:a.initialViewPoint});a.homeBtn=n}p.controlUIWidget(a.sceneView,e[t],a.homeBtn,"top-left");break;case"canLocate":if(!a.locateBtn||a.locateBtn.view!==a.sceneView){var o=new(0,a.Locate)({view:a.sceneView});a.locateBtn=o}p.controlUIWidget(a.sceneView,e[t],a.locateBtn,"top-left");break;case"canCompass":if(!a.compassBtn||a.compassBtn.view!==a.sceneView){var s=new(0,a.Compass)({view:a.sceneView});a.compassBtn=s}p.controlUIWidget(a.sceneView,e[t],a.compassBtn,"top-left");break;case"canSearch":if(!a.searchBtn||a.searchBtn.view!==a.sceneView){var r=new(0,a.Search)({view:a.sceneView});a.searchBtn=r}p.controlUIWidget(a.sceneView,e[t],a.searchBtn,"top-right","search");break;case"canNavigate":if(!a.navigateBtn||a.navigateBtn.view!==a.sceneView){var c=new(0,a.Navigate)({view:a.sceneView});a.navigateBtn=c}p.controlUIWidget(a.sceneView,e[t],a.navigateBtn,"top-left")}a.mapContainer.getElementsByClassName("overview-container").length>0&&a.mapContainer.getElementsByClassName("overview-container")[0].parentNode.removeChild(a.overview.elementContainer)}},a.bindMapBaseViewEvent=function(e){e&&(a.mapBaseViewEventHandles["mouse-wheel"]&&(a.mapBaseViewEventHandles["mouse-wheel"].remove(),a.mapBaseViewEventHandles["mouse-wheel"]=null),a.mapBaseViewEventHandles["mouse-wheel"]=e.on("mouse-wheel",function(t){if(a.props.baseWidgetProps.config.disableScroll)return t.stopPropagation(),void a.handleDisableWheel();a.props.onViewChanged&&a.props.onViewChanged(a.props.dataSourceId,e.viewpoint.clone())}),a.mapBaseViewEventHandles.drag&&(a.mapBaseViewEventHandles.drag.remove(),a.mapBaseViewEventHandles.drag=null),a.mapBaseViewEventHandles.drag=e.on("drag",function(){a.props.onViewChanged&&a.props.onViewChanged(a.props.dataSourceId,e.viewpoint.clone())}),a.mapBaseViewEventHandles.click&&(a.mapBaseViewEventHandles.click.remove(),a.mapBaseViewEventHandles.click=null),a.mapBaseViewEventHandles.click=e.on("click",function(){for(var e in a.highLightHandles)a.highLightHandles[e].remove()}))},a.getMapDsId=function(){return a.state.mapDs&&a.state.mapDs.id},a.onDataSourceCreated=function(e){a.setState({mapDs:e,preMapDs:a.state.mapDs})},a.onCreateDataSourceFailed=function(e){console.warn(e),a.setState({mapLoadStatus:n.LoadError,mapDs:null,preMapDs:a.state.mapDs},function(){a.props.onMapLoaded(a.props.dataSourceId,n.LoadError)})},a.setViewPoint=function(e){e&&a.state.mapDs&&(a.state.mapDs.type===s.DataSourceTypes.WebMap&&a.mapView&&(a.mapView.viewpoint=e),a.state.mapDs.type===s.DataSourceTypes.WebScene&&a.sceneView&&(a.sceneView.viewpoint=e))},a.getMapLoadStatus=function(){return a.state.mapLoadStatus},a.getViewPoint=function(){return a.state.mapDs?a.state.mapDs.type===s.DataSourceTypes.WebMap?a.mapView&&a.mapView.viewpoint?a.mapView.viewpoint.clone():null:a.state.mapDs.type===s.DataSourceTypes.WebScene?a.sceneView&&a.sceneView.viewpoint?a.sceneView.viewpoint.clone():null:void 0:null},a.getViewType=function(){return a.state.mapDs&&a.state.mapDs.type},a.goToTilt=function(e){a.sceneView&&a.sceneView.goTo({tilt:e})},a.goHome=function(e){return a.initialViewPoint&&a.state.mapDs?a.state.mapDs.type===s.DataSourceTypes.WebMap&&a.mapView?a.mapView.goTo(a.initialViewPoint,{animate:e}):a.state.mapDs.type===s.DataSourceTypes.WebScene&&a.sceneView?a.sceneView.goTo(a.initialViewPoint,{animate:e}):Promise.resolve():Promise.resolve()},a.handleAction=function(e,t){if(e.zoomToFeatureActionValue)if(e.zoomToFeatureActionValue.relatedWidgets&&e.zoomToFeatureActionValue.relatedWidgets.indexOf(a.props.baseWidgetProps.id)>-1)a.props.onMutableStatePropsChanged(a.props.dataSourceId,"zoomToFeatureActionValue",null);else{var i=t,n=e.zoomToFeatureActionValue.relatedWidgets?e.zoomToFeatureActionValue.relatedWidgets:[],s=e.zoomToFeatureActionValue.value;s.features?i.goTo(s.features).then(function(){n.push(a.props.baseWidgetProps.id);var e=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,i.extent);e.setRelatedWidgetIds(n),a.props.onExtentChanged(a.props.dataSourceId,e)}):i.goTo(s).then(function(){n.push(a.props.baseWidgetProps.id);var e=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,i.extent);e.setRelatedWidgetIds(n),a.props.onExtentChanged(a.props.dataSourceId,e)}),a.isReceiveExtentChange=!0,a.props.onMutableStatePropsChanged(a.props.dataSourceId,"zoomToFeatureActionValue",null)}if(e.panToActionValue){if(e.panToActionValue.relatedWidgets&&e.panToActionValue.relatedWidgets.indexOf(a.props.baseWidgetProps.id)>-1)a.props.onMutableStatePropsChanged(a.props.dataSourceId,"panToActionValue",null);else{var r=t,c=e.panToActionValue.relatedWidgets?e.panToActionValue.relatedWidgets:[],d=e.panToActionValue.value;d.features?p.mapPanto(t,d.features).then(function(){c.push(a.props.baseWidgetProps.id);var e=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,r.extent);e.setRelatedWidgetIds(c),a.props.onExtentChanged(a.props.dataSourceId,e)}):p.mapPanto(t,d).then(function(){c.push(a.props.baseWidgetProps.id);var e=new o.ExtentChangeMessage(a.props.baseWidgetProps.id,r.extent);e.setRelatedWidgetIds(c),a.props.onExtentChanged(a.props.dataSourceId,e)})}a.isReceiveExtentChange=!0,a.props.onMutableStatePropsChanged(a.props.dataSourceId,"panToActionValue",null)}if(e.newFeatureSetActionValue&&!e.newFeatureSetActionValue.promise){var u=p.createNewFeaturelayer(t,e.newFeatureSetActionValue.value);u?(a.props.onMutableStatePropsChanged(a.props.dataSourceId,"newFeatureSetActionValue.promise",u),u.then(function(){a.props.onMutableStatePropsChanged(a.props.dataSourceId,"newFeatureSetActionValue",null)})):a.props.onMutableStatePropsChanged(a.props.dataSourceId,"newFeatureSetActionValue",null)}if(e.changedFeatureSetActionValue&&(p.updateFeaturelayer(t,e.changedFeatureSetActionValue),a.props.onMutableStatePropsChanged(a.props.dataSourceId,"changedFeatureSetActionValue",null)),e.selectFeatureActionValue){for(var l in t.popup.close(),a.highLightHandles)a.highLightHandles[l].remove();var m=p.selectFeature(t,e.selectFeatureActionValue);m&&(a.highLightHandles[m.layerId]=m.handle),setTimeout(function(){a.props.onMutableStatePropsChanged(a.props.dataSourceId,"selectFeatureActionValue",null)},500)}e.flashActionValue&&(e.flashActionValue.querySQL&&p.flashFeaturesByQuery(t,e.flashActionValue.layerId,e.flashActionValue.querySQL),a.props.onMutableStatePropsChanged(a.props.dataSourceId,"flashActionValue",null))},a.formatMessage=function(e){return a.props.baseWidgetProps.intl.formatMessage({id:e,defaultMessage:c.default[e]})},a.handleDisableWheel=function(){a.widgetContainer.style.pointerEvents="none",setTimeout(function(){a.widgetContainer.style.pointerEvents="auto"},50)};var i=o.MutableStoreManager.getInstance().getStateValue([a.props.baseWidgetProps.id,"restoreData",a.props.baseWidgetProps.id+"-restoreData-"+a.props.dataSourceId]);return i?(p.restoreMapBase(a,i),a.props.baseWidgetProps.dispatch(o.appActions.widgetMutableStatePropChange(a.props.baseWidgetProps.id,"restoreData."+a.props.baseWidgetProps.id+"-restoreData-"+a.props.dataSourceId,null)),a.bindMapBaseViewEvent(a.mapView||a.sceneView)):a.state={mapLoadStatus:n.Loading},a}return i(t,e),t.prototype.componentDidMount=function(){var e=this;0===this.widgetContainer.getElementsByClassName("widget-map").length&&(this.mapContainer||(this.mapContainer=document&&document.createElement("div"),this.mapContainer.className="jimu-widget widget-map"),this.widgetContainer.appendChild(this.mapContainer)),!this.props.startLoadModules||this.state.isModulesLoaded?this.getMapDsId()&&this.state.mapDs&&(this.state.mapDs.type===s.DataSourceTypes.WebMap&&this.analysisMapView().then(function(){e.updateMapView(e.props.baseWidgetProps.config)}),this.state.mapDs.type===s.DataSourceTypes.WebScene&&this.analysisSceneView().then(function(){e.updateSceneView(e.props.baseWidgetProps.config)})):this.startRenderMap()},t.prototype.componentDidUpdate=function(){var e=this;if(this.state.isModulesLoaded){var t=this.getMapDsId(),a=this.state.preMapDs&&this.state.preMapDs.id,i=this.state.mapDs&&this.state.mapDs.dataSourceJson.itemId,o=this.state.preMapDs&&this.state.preMapDs.dataSourceJson.itemId;if(t!==a||i!==o){this.mapView=null,this.sceneView=null;var r=this.state.preMapDs&&this.state.preMapDs.id+"-"+this.props.baseWidgetProps.id+"-view";if(r&&this.dsManager.destroyDataSource(r),this.state.mapLoadStatus===n.LoadError&&!this.state.mapDs)return void this.setState({preMapDs:this.state.mapDs});this.setState({preMapDs:this.state.mapDs,mapLoadStatus:n.Loading})}this.state.mapDs&&(this.state.mapDs.type===s.DataSourceTypes.WebMap&&(this.sceneView=null,this.analysisMapView().then(function(){e.updateMapView(e.props.baseWidgetProps.config),e.mapView&&e.props.baseWidgetProps.mutableStateProps&&e.props.baseWidgetProps.mutableStateProps&&e.handleAction(e.props.baseWidgetProps.mutableStateProps,e.mapView)})),this.state.mapDs.type===s.DataSourceTypes.WebScene&&(this.mapView=null,this.analysisSceneView().then(function(){e.updateSceneView(e.props.baseWidgetProps.config),e.sceneView&&e.props.baseWidgetProps.mutableStateProps&&e.props.baseWidgetProps.mutableStateProps&&e.handleAction(e.props.baseWidgetProps.mutableStateProps,e.sceneView)})))}},t.prototype.componentWillReceiveProps=function(e){e.activeViewPoint!==this.props.activeViewPoint&&(e.activeViewPoint?this.setViewPoint(e.activeViewPoint):this.goHome(!1)),e.dataSourceId!==this.props.dataSourceId&&this.setState({mapLoadStatus:n.Loading})},t.prototype.componentWillUnmount=function(){var e=o.getAppStore().getState().appConfig.widgets;if(e[this.props.baseWidgetProps.id]&&e[this.props.baseWidgetProps.id].outputDataSources===this.props.baseWidgetProps.outputDataSources&&e[this.props.baseWidgetProps.id].outputDataSources&&e[this.props.baseWidgetProps.id].useDataSources===this.props.baseWidgetProps.useDataSources&&e[this.props.baseWidgetProps.id].outputDataSources.indexOf(this.props.dataSourceId+"-"+this.props.baseWidgetProps.id+"-view")>-1){var t=p.getMapBaseRestoreData(this);this.props.baseWidgetProps.dispatch(o.appActions.widgetMutableStatePropChange(this.props.baseWidgetProps.id,"restoreData."+this.props.baseWidgetProps.id+"-restoreData-"+this.props.dataSourceId,t)),this.mapView&&p.controlUIWidget(this.mapView,!1,this.searchBtn,"top-right"),this.sceneView&&p.controlUIWidget(this.sceneView,!1,this.searchBtn,"top-right")}else if(this.props.onViewChanged&&this.props.onViewChanged(this.props.dataSourceId,null),this.props.dataSourceId){var a=this.props.dataSourceId+"-"+this.props.baseWidgetProps.id+"-view";this.dsManager.destroyDataSource(a),this.mapView&&!this.mapView.destroyed&&(this.mapView.container=null,this.mapView=null),this.sceneView&&!this.sceneView.destroyed&&(this.sceneView.container=null,this.sceneView=null),this.highLightHandles={},this.extentWatch=null}},t.prototype.render=function(){for(var e=this,t=null,a=0;a<this.props.baseWidgetProps.useDataSources.length;a++)this.props.baseWidgetProps.useDataSources[a].dataSourceId==this.props.dataSourceId&&(t=this.props.baseWidgetProps.useDataSources[a]);return o.React.createElement("div",{className:"jimu-widget",style:{position:"relative"},ref:function(t){e.widgetContainer=t}},this.state.mapLoadStatus===n.Loading&&o.React.createElement("div",{className:"jimu-widget widget-map-background"},o.React.createElement("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-small-loading"})),this.state.mapLoadStatus===n.LoadError&&o.React.createElement("div",{className:"jimu-widget widget-map-background"},o.React.createElement("div",{className:"jimu-widget d-flex justify-content-center align-items-center"},this.formatMessage("mapFailure"))),o.React.createElement("div",{style:{position:"absolute",display:"none"}},o.React.createElement(o.DataSourceComponent,{useDataSource:t,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})))},t}(o.React.PureComponent);t.default=d},447:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),n=function(){return function(e){var t=this;this.initOverviewMapDatasource=function(){var e=new t.MapView({map:t.parentMap,container:t.elementContainer});t.overviewMapView=e,t.overviewMapView.when(function(){t.parentMapView.watch("extent",t.updateOverviewExtent.bind(t)),t.overviewMapView.watch("extent",t.updateOverviewExtent.bind(t)),t.WatchUtils.when(t.parentMapView,"stationary",t.updateOverview.bind(t))}),t.overviewMapView.ui.components=[]},this.updateOverview=function(){t.overviewMapView.goTo({extent:t.parentMapView.extent,scale:2*t.parentMapView.scale*Math.max(t.parentMapView.width/t.overviewMapView.width,t.parentMapView.height/t.overviewMapView.height)})},this.updateOverviewExtent=function(){var e=t.parentMapView.extent,a=new t.Point({x:e.xmin,y:e.ymin,spatialReference:e.spatialReference}),i=new t.Point({x:e.xmax,y:e.ymax,spatialReference:e.spatialReference}),n=t.overviewMapView.toScreen(a),o=t.overviewMapView.toScreen(i);t.extentContainer.style.top=o.y+"px",t.extentContainer.style.left=n.x+"px",t.extentContainer.style.height=n.y-o.y+"px",t.extentContainer.style.width=o.x-n.x+"px"},this.destroy=function(){t.elementContainer&&t.elementContainer.parentNode&&t.elementContainer.parentNode.removeChild(t.elementContainer),t.overviewMapView.destroy()};var a=document&&document.createElement("div"),n=document&&document.createElement("div");n&&(n.className="extent-container"),a&&(a.className="overview-container",a.appendChild(n)),this.extentContainer=n,this.elementContainer=a,this.webMapId=e.webMapId,this.parentMapView=e.parentMapView,this.parentMap=e.parentMap,i.loadArcGISJSAPIModules(["esri/geometry/Point","esri/core/watchUtils","esri/views/MapView"]).then(function(e){t.Point=e[0],t.WatchUtils=e[1],t.MapView=e[2],t.initOverviewMapDatasource()})}}();t.default=n},448:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={_widgetLabel:"Map",_action_displayFeatureSet_label:"Display feature set",_action_panTo_label:"Pan to",_action_zoomToFeature_label:"Zoom to",_action_selectFeature_label:"Select feature",_action_flash_label:"Flash",mapFailure:"Create map failed"}},449:function(e,t,a){function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e}).apply(this,arguments)}var n=a(0),o=n.createElement("path",{d:"M6 10.943l4 1.711V3.057L6 1.346v9.597zm-1 .17V1.494l-4 1.48v9.619l4-1.48zm6 1.393l4-1.48V1.407l-4 1.48v9.619zM0 14V2.307L5.75.18l4.528 1.937L16 0v11.693l-5.75 2.127-4.528-1.937L0 14z",fill:"currentColor",fillRule:"nonzero"});function s(e){return n.createElement("svg",i({width:16,height:14,viewBox:"0 0 16 14"},e),o)}e.exports=s,s.default=s}})});
//# sourceMappingURL=widget.js.map