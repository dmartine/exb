define(["jimu-core","jimu-ui","jimu-for-builder","jimu-arcgis/arcgis-data-source"],function(t,e,o,a){return function(t){var e={};function o(a){if(e[a])return e[a].exports;var s=e[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=t,o.c=e,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(a,s,function(e){return t[e]}.bind(null,s));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=455)}({2:function(e,o){e.exports=t},32:function(t,e){t.exports=a},355:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={sourceLabel:"Source",sourceDescript:"Select a web map/web scene, or any combination of two",initialMap:"Initial map",toolLabel:"Tools",zoomLabel:"Zoom",homeLabel:"Home button",locateLabel:"Locate button",scalebarLabel:"Scale bar",compassLabel:"Compass",toggleToPanOrRotate:"Rotate control",searchLocationLabel:"Location search",options:"Options",disableScrollZoom:"Disable scroll zoom",chooseALayer:"choose a layer",dataRelationShip:"Data relationship",mapNone:"none",messageField:"Message Field"}},4:function(t,o){t.exports=e},455:function(t,e,o){"use strict";var a=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function a(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),s=this&&this.__makeTemplateObject||function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t};Object.defineProperty(e,"__esModule",{value:!0});var n,i=o(2),r=o(4),p=o(32),c=o(6),u=o(355),l=o(456),d=function(t){function e(e){var o=t.call(this,e)||this;return o.unmount=!1,o.dsManager=i.DataSourceManager.getInstance(),o.integratedDataSourceSetting={},o.supportedDsTypes=i.Immutable([p.DataSourceTypes.WebMap,p.DataSourceTypes.WebScene]),o.getOutputDataSourceJson=function(t){var e=null;return t.type===p.DataSourceTypes.WebMap&&(e=i.Immutable({id:t.id+"-"+o.props.id+"-view",label:t.label,type:p.DataSourceTypes.MapView,itemId:t.itemId,originDataSourceId:t.id,isOutputFromWidget:!0})),t.type===p.DataSourceTypes.WebScene&&(e=i.Immutable({id:t.id+"-"+o.props.id+"-view",label:t.title,type:p.DataSourceTypes.SceneView,itemId:t.itemId,originDataSourceId:t.id,isOutputFromWidget:!0})),e},o.getPortUrl=function(){return i.getAppStore().getState().portalUrl},o.onDataSourceSelected=function(t,e){if(e&&e.dataSourceJson){var a=[];(a=Object.assign(a,o.props.useDataSources)).push({dataSourceId:e.dataSourceJson.id,rootDataSourceId:e.rootDataSourceId});var s=null,n=o.props.outputDataSources,r=i.getAppStore().getState().appStateInBuilder.appConfig.dataSources;if(o.props.outputDataSources&&o.props.outputDataSources[0]){s=[];for(var p=0;p<o.props.outputDataSources.length;p++){var c=r[n[p]];s.push(c)}(u=o.getOutputDataSourceJson(e.dataSourceJson))&&s.push(u)}else{var u;(u=o.getOutputDataSourceJson(e.dataSourceJson))&&(s=[u])}o.integratedDataSourceSetting={widgetId:o.props.id,useDataSources:i.Immutable(a),outputDataSourcesJson:i.Immutable(s)};var l=Object.assign({},o.integratedDataSourceSetting);l.config=o.props.config.set("initialMapDataSourceID",e.dataSourceJson.id),o.props.onSettingChange(l)}},o.onDataSourceRemoved=function(t,e){if(e&&e.dataSourceJson){var a=e.dataSourceJson.id,s=[];s=Object.assign(s,o.props.useDataSources);for(var n=0;n<s.length;n++)if(s[n].dataSourceId===a){s.splice(n,1);break}var r=null,p=o.props.outputDataSources,c=i.getAppStore().getState().appStateInBuilder.appConfig.dataSources;if(p&&p[0]){r=[];for(n=0;n<o.props.outputDataSources.length;n++){var u=c[p[n]];u.originDataSourceId!==a&&r.push(u)}}var l={widgetId:o.props.id,useDataSources:i.Immutable(s),outputDataSourcesJson:i.Immutable(r)},d={};if(o.integratedDataSourceSetting=l,d=Object.assign({},o.integratedDataSourceSetting),s.length>0){var h=s[0]&&s[0].dataSourceId;d.config=o.props.config.set("initialMapDataSourceID",h)}else d.config=o.props.config.set("initialMapDataSourceID",null);o.props.onSettingChange(Object.assign({},d))}},o.onMapToolsChanged=function(t,e){o.props.onSettingChange({widgetId:o.props.id,config:o.props.config.set(e,t)})},o.onMapOptionsChanged=function(t,e){o.props.onSettingChange({widgetId:o.props.id,config:o.props.config.set(e,t)})},o.extentModeChanged=function(t){o.props.onSettingChange({widgetId:o.props.id,config:o.props.config.set("extentMode",t)})},o.onDisableSelection=function(t){return t.length>1},o.initDataSourceSettingOption=function(){var t=[];t=Object.assign(t,o.props.useDataSources);var e=null,a=o.props.outputDataSources,s=i.getAppStore().getState().appStateInBuilder.appConfig.dataSources;if(o.props.outputDataSources&&o.props.outputDataSources[0]){e=[];for(var n=0;n<o.props.outputDataSources.length;n++){var r=s[a[n]];e.push(r)}}var p={widgetId:o.props.id,useDataSources:i.Immutable(t),outputDataSourcesJson:i.Immutable(e)};o.integratedDataSourceSetting=p},o.setInitialMap=function(t){o.props.onSettingChange({widgetId:o.props.id,config:o.props.config.set("initialMapDataSourceID",t)}),c.builderAppSync.publishWidgetsStatePropChange({widgetId:o.props.id,propKey:"initialMapDataSourceID",value:t})},o.initDataSourceSettingOption(),o}return a(e,t),e.prototype.getStyle=function(){return i.css(n||(n=s(["\n      .widget-setting-map{\n        font-weight: lighter;\n        font-size: 13px;\n\n        .source-descript {\n          color: ",";\t\n        }\n\n        .webmap-thumbnail{\n          cursor: pointer;\n          width: 100%;\n          height: 120px;\n          overflow: hidden;\n          padding: 1px;\n          border: "," solid initial;\n          img, div{\n            width: 100%;\n            height: 100%;\n          }\n        }\n\n        .selected-item{\n          border: "," solid "," !important;\n        }\n\n        .webmap-thumbnail-multi{\n          cursor: pointer;\n          width: 48%;\n          height: 100px;\n          overflow: hidden;\n          padding: 1px;\n          border: "," solid initial;\n          img, div{\n            width: 100%;\n            height: 100%;\n          }\n        }\n\n        .placeholder-container {\t\n          background-color: ",";\t\n          width: 100%;\t\n          height: 120px;\t\n          position: relative;\t\n        }\t\n  \n        .placeholder-icon {\t\n          top: 40%;\t\n          left: 46%;\t\n          position: absolute;\t\n          fill: ",";\t\n        }\n      \n        .choose-btn{\n          width: 100%;\n        }\n      \n        .webmap-tools{\n          .webmap-tools-item{\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 8px;\n          }\n        }\n\n        .uploadInput {\n          position: absolute;\n          opacity: 0;\n          left: 0;\n          top: 0;\n          cursor: pointer;\n        }\n      \n        .uploadInput-container {\n          position: relative;\n        }\n\n        .setting-map-button{\n          cursor: 'pointer';\n        }\n      }\n      .item-chooser-popup {\n        width: 850px;\n        .modal-body {\n          max-height: 70vh;\n          overflow: auto;\n        }\n      }"],["\n      .widget-setting-map{\n        font-weight: lighter;\n        font-size: 13px;\n\n        .source-descript {\n          color: ",";\t\n        }\n\n        .webmap-thumbnail{\n          cursor: pointer;\n          width: 100%;\n          height: 120px;\n          overflow: hidden;\n          padding: 1px;\n          border: "," solid initial;\n          img, div{\n            width: 100%;\n            height: 100%;\n          }\n        }\n\n        .selected-item{\n          border: "," solid "," !important;\n        }\n\n        .webmap-thumbnail-multi{\n          cursor: pointer;\n          width: 48%;\n          height: 100px;\n          overflow: hidden;\n          padding: 1px;\n          border: "," solid initial;\n          img, div{\n            width: 100%;\n            height: 100%;\n          }\n        }\n\n        .placeholder-container {\t\n          background-color: ",";\t\n          width: 100%;\t\n          height: 120px;\t\n          position: relative;\t\n        }\t\n  \n        .placeholder-icon {\t\n          top: 40%;\t\n          left: 46%;\t\n          position: absolute;\t\n          fill: ",";\t\n        }\n      \n        .choose-btn{\n          width: 100%;\n        }\n      \n        .webmap-tools{\n          .webmap-tools-item{\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 8px;\n          }\n        }\n\n        .uploadInput {\n          position: absolute;\n          opacity: 0;\n          left: 0;\n          top: 0;\n          cursor: pointer;\n        }\n      \n        .uploadInput-container {\n          position: relative;\n        }\n\n        .setting-map-button{\n          cursor: 'pointer';\n        }\n      }\n      .item-chooser-popup {\n        width: 850px;\n        .modal-body {\n          max-height: 70vh;\n          overflow: auto;\n        }\n      }"])),this.props.theme.colors.grays.gray700,i.polished.rem(2),i.polished.rem(2),this.props.theme.colors.cyans.cyan500,i.polished.rem(2),this.props.theme.colors.secondary,this.props.theme.colors.grays.gray600)},e.prototype.componentDidMount=function(){this.unmount=!1},e.prototype.componentWillUnmount=function(){this.unmount=!0},e.prototype.render=function(){var t=this,e=this.getPortUrl(),o=[];if(this.props.useDataSources)for(var a=0;a<this.props.useDataSources.length;a++)o.push(this.props.useDataSources[a].dataSourceId);return i.jsx("div",{css:this.getStyle()},i.jsx("div",{className:"widget-setting-map"},i.jsx(c.SettingSection,{title:this.props.intl.formatMessage({id:"sourceLabel",defaultMessage:u.default.sourceLabel})},i.jsx(c.SettingRow,null,i.jsx("div",{className:"source-descript"},this.props.intl.formatMessage({id:"sourceDescript",defaultMessage:u.default.sourceDescript}))),i.jsx(c.SettingRow,null,i.jsx(c.DataSourceChooser,{isMultiple:!0,types:this.supportedDsTypes,widgetId:this.props.id,onSelect:this.onDataSourceSelected,selectedDataSourceIds:i.Immutable(o),onRemove:this.onDataSourceRemoved,disableSelection:this.onDisableSelection,mustUseDataSource:!0})),e&&this.props.dsJsons&&this.props.useDataSources&&1===this.props.useDataSources.length&&i.jsx(c.SettingRow,null,i.jsx("div",{className:"w-100"},i.jsx("div",{className:"webmap-thumbnail",title:this.props.dsJsons[this.props.useDataSources[0].dataSourceId].label,onClick:function(){t.setInitialMap(t.props.useDataSources[0].dataSourceId)}},i.jsx(l.default,{mapItemId:this.props.dsJsons[this.props.useDataSources[0].dataSourceId]?this.props.dsJsons[this.props.useDataSources[0].dataSourceId].itemId:null,portUrl:this.props.dsJsons[this.props.useDataSources[0].dataSourceId]?this.props.dsJsons[this.props.useDataSources[0].dataSourceId].portalUrl:null}))))),e&&this.props.dsJsons&&this.props.useDataSources&&2===this.props.useDataSources.length&&i.jsx(c.SettingSection,{title:this.props.intl.formatMessage({id:"initialMap",defaultMessage:u.default.initialMap})},i.jsx(c.SettingRow,null,i.jsx("div",{className:"w-100 d-flex justify-content-between"},i.jsx("div",{onClick:function(){t.setInitialMap(t.props.useDataSources[0].dataSourceId)},title:this.props.dsJsons[this.props.useDataSources[0].dataSourceId].label,className:i.classNames("webmap-thumbnail-multi",{"selected-item":this.props.config.initialMapDataSourceID===this.props.useDataSources[0].dataSourceId})},i.jsx(l.default,{mapItemId:this.props.dsJsons[this.props.useDataSources[0].dataSourceId]?this.props.dsJsons[this.props.useDataSources[0].dataSourceId].itemId:null,portUrl:this.props.dsJsons[this.props.useDataSources[0].dataSourceId]?this.props.dsJsons[this.props.useDataSources[0].dataSourceId].portalUrl:null})),i.jsx("div",{onClick:function(){t.setInitialMap(t.props.useDataSources[1].dataSourceId)},title:this.props.dsJsons[this.props.useDataSources[1].dataSourceId].label,className:i.classNames("webmap-thumbnail-multi",{"selected-item":this.props.config.initialMapDataSourceID===this.props.useDataSources[1].dataSourceId})},i.jsx(l.default,{mapItemId:this.props.dsJsons[this.props.useDataSources[1].dataSourceId]?this.props.dsJsons[this.props.useDataSources[1].dataSourceId].itemId:null,portUrl:this.props.dsJsons[this.props.useDataSources[1].dataSourceId]?this.props.dsJsons[this.props.useDataSources[1].dataSourceId].portalUrl:null}))))),i.jsx(c.SettingSection,{title:this.props.intl.formatMessage({id:"toolLabel",defaultMessage:u.default.toolLabel})},i.jsx(c.SettingRow,null,i.jsx("div",{className:"w-100 webmap-tools"},i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"zoomLabel",defaultMessage:u.default.zoomLabel})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.canZoom||!1,"data-key":"canZoom",onChange:function(e){t.onMapToolsChanged(e.target.checked,"canZoom")}})),i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"homeLabel",defaultMessage:u.default.homeLabel})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.canGoHome||!1,"data-key":"canGoHome",onChange:function(e){t.onMapToolsChanged(e.target.checked,"canGoHome")}})),i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"locateLabel",defaultMessage:u.default.locateLabel})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.canLocate||!1,"data-key":"canLocate",onChange:function(e){t.onMapToolsChanged(e.target.checked,"canLocate")}})),i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"scalebarLabel",defaultMessage:u.default.scalebarLabel})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.canScale||!1,"data-key":"canScale",onChange:function(e){t.onMapToolsChanged(e.target.checked,"canScale")}})),i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"compassLabel",defaultMessage:u.default.compassLabel})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.canCompass||!1,"data-key":"canCompass",onChange:function(e){t.onMapToolsChanged(e.target.checked,"canCompass")}})),i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"toggleToPanOrRotate",defaultMessage:u.default.toggleToPanOrRotate})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.canNavigate||!1,"data-key":"canNavigate",onChange:function(e){t.onMapToolsChanged(e.target.checked,"canNavigate")}})),i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"searchLocationLabel",defaultMessage:u.default.searchLocationLabel})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.canSearch||!1,"data-key":"canSearch",onChange:function(e){t.onMapToolsChanged(e.target.checked,"canSearch")}}))))),i.jsx(c.SettingSection,{title:this.props.intl.formatMessage({id:"options",defaultMessage:u.default.options})},i.jsx(c.SettingRow,null,i.jsx("div",{className:"w-100 webmap-tools"},i.jsx("div",{className:"webmap-tools-item"},i.jsx("label",null,i.jsx(i.FormattedMessage,{id:"disableScrollZoom",defaultMessage:u.default.disableScrollZoom})),i.jsx(r.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.disableScroll||!1,"data-key":"disableScroll",onChange:function(e){t.onMapOptionsChanged(e.target.checked,"disableScroll")}})))))))},e.mapExtraStateProps=function(t){return{dsJsons:t.appStateInBuilder.appConfig.dataSources}},e}(c.BaseWidgetSetting);e.default=d},456:function(t,e,o){"use strict";var a=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function a(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=o(2),n=o(4),i=function(t){function e(e){var o=t.call(this,e)||this;return o.unmount=!1,o.setMapThumbUrl=function(t){if(t||o.setState({mapThumbUrl:null}),o.props.portUrl&&o.props.portUrl!==s.getAppStore().getState().portalUrl)s.esri.restPortal.searchItems({q:"id:"+t,portal:o.props.portUrl+"/sharing/rest"}).then(function(t){if(!o.unmount)if(t.results[0]){var e=o.props.portUrl+"/sharing/rest/content/items/"+t.results[0].id+"/info/"+t.results[0].thumbnail;o.setState({mapThumbUrl:e})}else o.setState({mapThumbUrl:null})});else{var e=s.getAppStore().getState().portalUrl;s.esri.restPortal.searchItems({q:"id:"+t,authentication:s.SessionManager.getInstance().getSession(),portal:e+"/sharing/rest"}).then(function(t){if(!o.unmount)if(t.results[0]){var a=e+"/sharing/rest/content/items/"+t.results[0].id+"/info/"+t.results[0].thumbnail+"?token="+s.SessionManager.getInstance().getSession().token;o.setState({mapThumbUrl:a})}else o.setState({mapThumbUrl:null})})}},o.state={mapThumbUrl:null},o}return a(e,t),e.prototype.componentDidMount=function(){this.unmount=!1,this.setMapThumbUrl(this.props.mapItemId)},e.prototype.componentWillReceiveProps=function(t){t.mapItemId!==this.props.mapItemId&&this.setMapThumbUrl(t.mapItemId)},e.prototype.componentWillUnmount=function(){this.unmount=!0},e.prototype.render=function(){return this.state.mapThumbUrl?s.React.createElement(n.ImageWithParam,{imageParam:{url:this.state.mapThumbUrl}}):s.React.createElement(n.ImageWithParam,{imageParam:{}})},e}(s.React.PureComponent);e.default=i},6:function(t,e){t.exports=o}})});
//# sourceMappingURL=setting.js.map