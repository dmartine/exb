define(["jimu-core"],function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}({0:function(t,n){t.exports=e},10:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11);t.appServices=r},11:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),i=o.esri.restPortal,s=i.searchItems,u=i.removeItem,c=i.updateItem,a=i.getItem,l=i.createItem,f=i.getItemData,p=i.getItemResources,g=i.addItemResource;function m(e){var t=o.SessionManager.getInstance().getSession();return s(r({},e,{authentication:t})).then(function(e){return Promise.resolve(e.results)})}function h(e){var t=o.SessionManager.getInstance().getSession();return a(e,{authentication:t}).then(function(e){return Promise.resolve(e)})}function v(e){return u({id:e,authentication:o.SessionManager.getInstance().getSession()})}function d(e,t,n){var r=o.SessionManager.getInstance().getSession(),i=o.getAppStore().getState().portalUrl+"/sharing/rest/content/items/"+t+"/resources/";if("config/config.json"===n.resource||"images/image-resources-list.json"===n.resource){var s=i+n.resource+"?token="+r.token;return fetch(s,{cache:"no-cache"}).then(function(e){return e.json()}).then(function(o){return j(e,t,o).then(function(t){var o=new Blob([JSON.stringify(t)],{type:"application/json"});return g({id:e,resource:o,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:r}).then(function(){return Promise.resolve(!0)},function(e){return Promise.reject(e)})})}).catch(function(e){return console.error(e),Promise.reject(e)})}var u=i+n.resource+"?token="+r.token;return new Promise(function(t,o){var i=new XMLHttpRequest;i.open("GET",u,!0),i.responseType="blob",i.onload=function(i){if(200==this.status){var s=this.response;return g({id:e,resource:s,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:r}).then(function(){return t(!0)},function(){return o(!1)})}return o(!1)},i.onerror=function(e){return o()},i.send()})}function P(e){var t=o.SessionManager.getInstance().getSession();return f(e,{authentication:t}).then(function(e){return Promise.resolve(e)},function(e){return Promise.reject(e)})}function j(e,t,n){var r=o.getAppStore().getState().portalUrl+"/sharing/rest/content/items/"+t+"/resources/",i=new RegExp("^"+r);var s={matchFunction:function(e){return i.test(e)},matchHandle:function(n){var r=n.obj,o=n.key,i=n.value;"number"==typeof n.i?r[o][n.i]=i.replace(t,e):r[o]=i.replace(t,e)}};return o.appConfigUtils.replaceAppConfigNodeValue(n,s)}t.searchApp=m,t.searchAppById=h,t.updateAppItem=function(e){var t=o.SessionManager.getInstance().getSession();return c({item:e,authentication:t}).then(function(){})},t.deleteApp=v,t.duplicateApp=function(e){return h(e).then(function(t){return t?function(e){var t=null;return m({q:'type: "Web Experience" AND owner:'+o.SessionManager.getInstance().getSession().username+' AND  title:"'+e+'"',sortField:"title",sortOrder:"desc"}).then(function(n){if(n&&n.length>0){for(var r=[],o=0;o<n.length;o++){if(n[o].title===e){t=e+"-1";break}var i=n[o].title.split("-");if(2===i.length){var s=Number(i[i.length-1]);isNaN(s)||r.push(s)}}return r.length>0&&(r.sort(function(e,t){return e<t?1:-1}),t=e+"-"+(r[0]+1)),t||(t=e),Promise.resolve(t)}return t=e,Promise.resolve(t)}).catch(function(e){return console.error(e),Promise.reject(e)})}(t.title+"-copy").then(function(n){return n?function(e){var t={title:e.name,type:"Web Experience",typeKeywords:["EXB Experience","Ready To Use","JavaScript"],snippet:e.description,tags:e.tags,thumbnail:e.thumbnail};return l({item:t,authentication:o.SessionManager.getInstance().getSession()})}({name:n,description:t.description,tags:t.tags,thumbnail:t.thumbnail}).then(function(t){return t?function(e,t){return function(e,t){var n=o.SessionManager.getInstance().getSession();return P(t).then(function(r){if(r)return j(e,t,r).then(function(t){return t?c({item:{id:e,owner:n.username,data:t},authentication:o.SessionManager.getInstance().getSession()}).then(function(){return Promise.resolve(!0)},function(e){return console.error(e),Promise.reject(e)}):Promise.reject(null)});Promise.reject(null)},function(e){console.error(e),Promise.reject(e)})}(e,t).then(function(n){return n?function(e,t){var n=o.SessionManager.getInstance().getSession();return p(t,{authentication:n}).then(function(n){var r=[],o=n&&n.resources;if(o)for(var i=0;i<o.length;i++)r.push(d(e,t,o[i]));return Promise.all(r)})}(e,t).then(function(e){return e?Promise.resolve(!0):Promise.reject(null)}):Promise.reject(null)},function(){return Promise.reject(null)})}(t.id,e).then(function(){return Promise.resolve(!0)},function(e){return console.error(e),v(t.id),Promise.reject(null)}):Promise.reject(null)}):Promise.reject(null)}):Promise.reject(null)})},t.getAppItemData=P}})});
//# sourceMappingURL=common.js.map