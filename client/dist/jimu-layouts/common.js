define(["jimu-core"],function(e){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=332)}({1:function(t,o){t.exports=e},11:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),i=o(17);t.removeItemFromParent=function(e,t,o){var i=e.layoutId,r=e.layoutItemId;if(!o[i])return o;if(!o[i].content[r])return o;var a=o[i],u=n.Immutable(o);if(a.order&&a.order.indexOf(r)>=0){var d=[];a.order.forEach(function(e){e!==r&&d.push(e)}),u=u.setIn([i,"order"],d)}return t&&(u=u.setIn([i,"content"],u[i].content.without(r))),u},t.selectLayoutItem=function(e,t){var o=e&&e.layoutId&&e.layoutItemId?e:null;return n.lodash.defer(function(){n.getAppStore().dispatch(n.appActions.selectionChanged(o))}),t},t.disableSelectMode=function(e){n.lodash.defer(function(){n.getAppStore().dispatch(n.appActions.setSelectMode(!1))})},t.createEmptyLayoutItem=function(e,t){var o=i.getMaximumId(t[e])+1,r=n.Immutable(t),a={id:""+o};return r=r.setIn([e,"content",a.id],a),{layoutInfo:{layoutId:e,layoutItemId:a.id},layouts:r}},t.findLayoutItem=function(e,t){if(!t)return null;var o=t.layoutId,i=t.layoutItemId;return n.lodash.getValue(e,"layouts."+o+".content."+i,null)},t.getMaximumLayoutItemId=function(e){return i.getMaximumId(e)}},17:function(e,t,o){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=o(1);function r(e){return"string"==typeof e&&e.length>1&&"%"===e[e.length-1]&&a(+e.slice(0,e.length-1))}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}function u(e,t){var o=t.layoutId,n=e.appConfig.layouts;if(!n[o])return{selected:!1,layoutItem:null,appMode:e.appRuntimeInfo.appMode,inSelectMode:e.appRuntimeInfo.inSelectMode,browserSizeMode:e.browserSizeMode};var r,a=n[o],u=t.layoutItemId,d=e.appRuntimeInfo.selection||{},l=a.content[u],s=!1,p=!1,f=!1;if(l&&(p=o===d.layoutId&&l.id===d.layoutItemId,f=Boolean(l.isPending),l.type===i.LayoutItemType.Widget)){var g=e.appConfig.widgets[l.widgetId];r=i.lodash.getValue(g,"manifest.name"),g&&g.manifest&&g.manifest.properties&&(s=g.manifest.properties.type===i.WidgetType.Layout||g.manifest.properties.type===i.WidgetType.Controller||g.manifest.properties.hasEmbeddedLayout)}return{selected:p,isLayoutWidget:s,widgetName:r,layoutItem:f?null:l,appMode:e.appRuntimeInfo.appMode,inSelectMode:e.appRuntimeInfo.inSelectMode,theme:e.theme,browserSizeMode:e.browserSizeMode}}function d(e,t,o,n){if(null==t[e]||"auto"===t[e])return t;return r(t[e])?"left"===e||"right"===e||"width"===e?r(o)?t.set(e,o):t.set(e,(100*+o/n.width).toFixed(4)+"%"):r(o)?t.set(e,o):t.set(e,(100*+o/n.height).toFixed(4)+"%"):r(o)?"left"===e||"right"===e||"width"===e?t.set(e,Math.round(parseFloat(""+o)*n.width/100)):t.set(e,Math.round(parseFloat(""+o)*n.height/100)):t.set(e,Math.round(+o)+"px")}t.emptyFunc=function(){},t.autoBindHandlers=function(e,t){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})},t.toPixelUnit=function(e){if(a(e))return e;if("string"==typeof e){var t=parseFloat(e)/100;if(/\d+vh$/.test(e))return t*(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);if(/\d+vw$/.test(e))return t*(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)}return 0},t.getSectionInfo=function(e,t){var o=e.appConfig.sections[t];if(!o||!o.views)return null;var n=e.appRuntimeInfo.currentViewIds&&e.appRuntimeInfo.currentViewIds.find(function(e){return o.views.indexOf(e)>-1})||o.views[0];return{views:o.views,activeView:n}},t.getMaximumId=function(e){var t=-1;return e.content&&Object.keys(e.content).forEach(function(e){var o=parseInt(e,10);o>t&&(t=o)}),t},t.isPercentage=r,t.isNumber=a,t.toRatio=function(e,t){return(100*e/t).toFixed(4)+"%"},t.fromRatio=function(e,t){return parseFloat(""+e)*t/100},t.mapStateToLayoutProps=function(e,t){var o=i.utils.findLayoutId(t.layouts,e.browserSizeMode,e.appConfig.mainSizeMode),n=e.appConfig.layouts,r=!0;if(!n[o])return{layout:null,theme:e.theme,appMode:e.appRuntimeInfo.appMode,inSelectMode:e.appRuntimeInfo.inSelectMode,mainSizeMode:e.appConfig.mainSizeMode,browserSizeMode:e.browserSizeMode};if(!e.appRuntimeInfo.draggingWidget&&e.appRuntimeInfo.selection||e.appRuntimeInfo.draggingWidget&&e.appRuntimeInfo.draggingWidget.layoutInfo){var a=e.appRuntimeInfo.draggingWidget&&e.appRuntimeInfo.draggingWidget.layoutInfo||e.appRuntimeInfo.selection,u=n[a.layoutId];if(u){var d=i.lodash.getValue(u,"content."+a.layoutItemId),l=i.lodash.getValue(d,"setting.lockParent",!1);(u.type===i.LayoutType.FlowLayout||l)&&(r=a.layoutId===o);var s=i.appConfigUtils.getWidgetIdThatUseTheLayoutId(e.appConfig,o);s&&e.appConfig.widgets[s].manifest.properties.type!==i.WidgetType.Layout&&(r=Object.keys(t.layouts).some(function(e){return t.layouts[e]===u.id}))}}return{canDrop:r,appMode:e.appRuntimeInfo.appMode,inSelectMode:e.appRuntimeInfo.inSelectMode,layout:n[o],theme:e.theme,draggingWidgetInfo:e.appRuntimeInfo.draggingWidget,mainSizeMode:e.appConfig.mainSizeMode,browserSizeMode:e.browserSizeMode}},t.mapStateToLayoutItemProps=u,t.getActiveLayout=function(e){var t,o;e||(e=i.getAppStore().getState().appStateInBuilder),t=e.appRuntimeInfo,o=e.appConfig;var n=t.activeLayout,r=t.currentDialogId,a=t.currentPageId;if(n)return n;var u=void 0;if(a)if(o.pages[a])u=o.pages[a].layout;else{var d=Object.keys(o.pages);u=o.pages[d[0]].layout}else u=r?o.dialogs[r].layout:o.pages.default.layout;return u},t.mapStateToWidgetProps=function(e,t){var o,r,a=u(e,t),d=!1,l=!1;if(a.layoutItem&&a.layoutItem.widgetId){var s=e.appConfig.widgets[a.layoutItem.widgetId];d=!0===i.lodash.getValue(s,"manifest.properties.supportInlineEditing"),l=!0===i.lodash.getValue(s,"manifest.properties.supportRepeat"),o=e.widgetsRuntimeInfo[a.layoutItem.widgetId],r=e.widgetsState[a.layoutItem.widgetId]}return n({},a,{supportInlineEditing:d,supportRepeat:l,runtimeInfo:o,widgetState:r})},t.snapToGridSize=function(e,t){return Math.round(e/t)*t},t.removePositionRelatedStyle=function(e){return["height","width","order","flexGrow","flexShrink","alignSelf"].forEach(function(t){e[t]&&delete e[t]}),e},t.replaceBoundingBox=function(e,t,o){if(!e)return i.Immutable({left:r(t.left)?t.left:Math.round(t.left)+"px",top:r(t.top)?t.top:Math.round(t.top)+"px",width:r(t.width)?t.width:Math.round(t.width)+"px",height:r(t.height)?t.height:Math.round(t.height)+"px"});var n=e;return["left","right","top","bottom","width","height"].forEach(function(e){null!=n[e]&&(n=d(e,n,t[e],o))}),n},t.updateBoundingBoxProp=d,t.generateBBoxStyle=function(e,t){var o={},n=t&&t.autoProps||{};return["left","right","top","bottom","width","height"].forEach(function(t){void 0!==e[t]&&!0!==n[t]&&(o[t]=e[t])}),o},t.generateResizingBBoxStyle=function(e,t,o){var n={};n.left=e.left+o.dx,n.width=e.width+o.dw;var i=t.right-e.right;0===o.dw?n.right=i-o.dx:0===o.dx?n.right=i-o.dw:n.right=i,n.top=e.top+o.dy,n.height=e.height+o.dh;var r=t.bottom-e.bottom;return 0===o.dh?n.bottom=r-o.dy:0===o.dy?n.bottom=r-o.dh:n.bottom=r,n},t.relativeClientRect=function(e,t){return{left:e.left-t.left,top:e.top-t.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,id:null}},t.findContainerWidgetId=function(e,t){var o,n=e.widgets||{};return Object.keys(n).some(function(n){var i=e.widgets[n];return Object.keys(i.layouts||[]).some(function(e){var r=i.layouts[e];return Object.keys(r).some(function(e){if(r[e]===t)return o=n,!0})})}),o},t.getBuilderThemeVariables=function(){var e=window.parent;if(e&&e.jimuConfig&&e.jimuConfig.isBuilder)return e._appState.theme},t.parseTranslateCoords=function(e){var t=0,o=0;if(e&&0===e.indexOf("translate(")){var n=e.substring("translate(".length).split(",");n.length>1&&(t=parseFloat(n[0]),o=parseFloat(n[1]))}return{x:t,y:o}};var l={SMALL:54,MEDIUM:69,LARGE:84};t.getIconSize=function(e){return l[e]}},332:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(333),i=o(11);t.layoutUtils=i;var r=o(335);t.PageContext=r.PageContext,t.PageContextProps=r.PageContextProps;var a=o(336);t.registerLayoutBuilder=a.registerLayoutBuilder,t.registerLayoutViewer=a.registerLayoutViewer,t.findLayoutBuilder=a.findLayoutBuilder,t.findLayoutViewer=a.findLayoutViewer;var u=o(17);t.autoBindHandlers=u.autoBindHandlers,t.mapStateToLayoutProps=u.mapStateToLayoutProps,t.mapStateToWidgetProps=u.mapStateToWidgetProps,t.mapStateToLayoutItemProps=u.mapStateToLayoutItemProps,t.replaceBoundingBox=u.replaceBoundingBox,t.getBuilderThemeVariables=u.getBuilderThemeVariables,t.isPercentage=u.isPercentage,t.isNumber=u.isNumber,t.relativeClientRect=u.relativeClientRect,t.getSectionInfo=u.getSectionInfo,t.findContainerWidgetId=u.findContainerWidgetId,t.getIconSize=u.getIconSize,t.fromRatio=u.fromRatio,t.toRatio=u.toRatio,t.getMaximumId=u.getMaximumId,t.generateBBoxStyle=u.generateBBoxStyle,t.generateResizingBBoxStyle=u.generateResizingBBoxStyle,t.parseTranslateCoords=u.parseTranslateCoords,function(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}(o(8)),t.init=function(){return Promise.all([n.loadMessage()])}},333:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),i=o(334);t.loadMessage=function(){var e=n.getAppStore().getState().appContext.locale;return(e=n.i18n.getLocaleToLoad(e,["en"]))?n.i18n.loadLocaleMessages("jimu-layouts/lib/builder/translations",e).then(function(e){return n.getAppStore().dispatch(n.appActions.i18nMessagesLoaded("jimu-layouts",e)),e}):Promise.resolve(i.default)}},334:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={edit:"Edit",delete:"Delete",previousView:"Previous View",nextView:"Next View",originTL:"Top left as origin",originTR:"Top right as origin",originBL:"Bottom left as origin",originBR:"Bottom right as origin",alignLeft:"Align left",alignRight:"Align right",alignTop:"Align top",alignCenter:"Align center",alignBottom:"Align bottom",alignStretch:"Align stretch",sendBackward:"Send backward",bringForward:"Bring forward",sendToBack:"Send to back",bringToFront:"Bring to front",zoomoutFixed:"Zoom out fixed",align:"Align",order:"Order",moveToLeft:"Move to left",moveToRight:"Move to right",moveToTop:"Mvoe to top",moveToBottom:"Move to bottom",addView:"Add view",deleteView:"Delete view",duplicateView:"Duplicate view",close:"Close",background:"Background",border:"Border",borderRadius:"Border radius",boxShadow:"Box shadow"}},335:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(1);t.PageContext=n.React.createContext({viewOnly:!0})},336:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={},i={};t.registerLayoutBuilder=function(e,t){n[e]=t},t.registerLayoutViewer=function(e,t){i[e]=t},t.findLayoutBuilder=function(e){return n[e]},t.findLayoutViewer=function(e){return i[e]}},8:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(t.IconTextSize||(t.IconTextSize={})),function(e){e.Normal="NORMAL",e.Icon="ICON",e.IconText="ICON_TEXT",e.Custom="CUSTOM"}(t.WidgetDisplayMode||(t.WidgetDisplayMode={})),function(e){e[e.BringForward=0]="BringForward",e[e.SendBackward=1]="SendBackward",e[e.BringToFront=2]="BringToFront",e[e.SendToBack=3]="SendToBack"}(t.OrderAdjustType||(t.OrderAdjustType={}))}})});
//# sourceMappingURL=common.js.map