/* @preserve
* @esri/arcgis-rest-request - v2.1.1 - Apache-2.0
* Copyright (c) 2017-2019 Esri, Inc.
* Mon Jul 15 2019 11:49:40 GMT-0700 (PDT)
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).arcgisRest=e.arcgisRest||{})}(this,function(e){"use strict";var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function t(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var h=function(){return(h=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function p(r){return Object.keys(r).some(function(e){var t=r[e];if(!t)return!1;switch(t&&t.toParam&&(t=t.toParam()),t.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}})}function a(n){var o={};return Object.keys(n).forEach(function(e){var t=n[e];if(t&&t.toParam&&(t=t.toParam()),t||0===t||"boolean"==typeof t||"string"==typeof t){var r;switch(t.constructor.name){case"Array":r=t[0]&&t[0].constructor&&"Object"===t[0].constructor.name?JSON.stringify(t):t.join(",");break;case"Object":r=JSON.stringify(t);break;case"Date":r=t.valueOf();break;case"Function":r=null;break;case"Boolean":r=t+"";break;default:r=t}(r||0===r||"string"==typeof r)&&(o[e]=r)}}),o}function r(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}function d(e){var t=a(e);return Object.keys(t).map(function(e){return r(e,t[e])}).join("&")}function l(e,t){var r=p(e)||t,n=a(e);if(r){var o=new FormData;return Object.keys(n).forEach(function(e){if("undefined"!=typeof Blob&&n[e]instanceof Blob){var t=n.fileName||n[e].name||e;o.append(e,n[e],t)}else o.append(e,n[e])}),o}return d(e)}var m=function(e,t,r,n,o){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=o};function o(e){console&&console.warn&&console.warn.apply(console,[e])}m.prototype=Object.create(Error.prototype),m.prototype.constructor=m;var O="@esri/arcgis-rest-js",y={httpMethod:"POST",params:{f:"json"}};var s,f=function(s){function e(e,t,r,n,o){void 0===e&&(e="AUTHENTICATION_ERROR"),void 0===t&&(t="AUTHENTICATION_ERROR_CODE");var a=s.call(this,e,t,r,n,o)||this;return a.name="ArcGISAuthError",a.message="AUTHENTICATION_ERROR_CODE"===t?e:t+": "+e,a}return t(e,s),e.prototype.retry=function(e,n){var o=this;void 0===n&&(n=3);var a=0,s=function(t,r){e(o.url,o.options).then(function(e){var t=h({},o.options,{authentication:e});return a+=1,i(o.url,t)}).then(function(e){t(e)}).catch(function(e){"ArcGISAuthError"===e.name&&a<n?s(t,r):"ArcGISAuthError"===e.name&&n<=a?r(o):r(e)})};return new Promise(function(e,t){s(e,t)})},e}(m);function v(t,e,r,n,o){if(400<=t.code){var a=t.message,s=t.code;throw new m(a,s,t,e,n)}if(t.error){var i=t.error,c=(a=i.message,s=i.code,i.messageCode),u=c||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s||"GWM_0003"===c||400===s&&"Unable to generate token."===a)throw o||new f(a,u,t,e,n);throw new m(a,u,t,e,n)}if("failed"!==t.status&&"failure"!==t.status)return t;a=void 0,s="UNKNOWN_ERROR_CODE";try{a=JSON.parse(t.statusMessage).message,s=JSON.parse(t.statusMessage).code}catch(e){a=t.statusMessage||t.message}throw new m(a,s,t,e,n)}function i(n,e){void 0===e&&(e={params:{f:"json"}});var o=h({httpMethod:"POST"},y,e,{params:h({},y.params,e.params),headers:h({},y.headers,e.headers)}),t=[],r=[];if(o.fetch||"undefined"==typeof fetch?(t.push("`fetch`"),r.push("`node-fetch`")):o.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(t.push("`Promise`"),r.push("`es6-promise`")),"undefined"==typeof FormData&&(t.push("`FormData`"),r.push("`isomorphic-form-data`")),!o.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+t.join(", ")+". We recommend installing the "+r.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var a=o.httpMethod,s=o.authentication,i=o.rawResponse,c=h({f:"json"},o.params),u=null,f={method:a,credentials:"same-origin"};return(s?s.getToken(n,{fetch:o.fetch}).catch(function(e){return e.url=n,e.options=o,u=e,Promise.resolve("")}):Promise.resolve("")).then(function(e){if(e.length&&(c.token=e),"GET"===f.method){var t=""===d(c)?n:n+"?"+d(c);o.maxUrlLength&&t.length>o.maxUrlLength?f.method="POST":n=t}var r=new RegExp("/items/.+/updateResources").test(n);return"POST"===f.method&&(f.body=l(c,r)),f.headers=h({},o.headers),"undefined"!=typeof window||f.headers.referer||(f.headers.referer=O),p(c)||r||(f.headers["Content-Type"]="application/x-www-form-urlencoded"),o.fetch(n,f)}).then(function(e){if(!e.ok){var t=e.status,r=e.statusText;throw new m(r,"HTTP "+t,e,n,o)}if(i)return e;switch(c.f){case"json":case"geojson":return e.json();case"html":case"text":return e.text();default:return e.blob()}}).then(function(e){if("json"!==c.f&&"geojson"!==c.f||i)return e;var t=v(e,n,0,o,u);if(u){var r=n.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];o.authentication.trustedServers[r]={token:[],expires:new Date(Date.now()+864e5)},u=null}return t})}(s=e.ErrorTypes||(e.ErrorTypes={})).ArcGISRequestError="ArcGISRequestError",s.ArcGISAuthError="ArcGISAuthError",e.ArcGISAuthError=f,e.ArcGISRequestError=m,e.NODEJS_DEFAULT_REFERER_HEADER=O,e.appendCustomParams=function(r,e,t){var n=h({params:{}},t,r);return n.params=e.reduce(function(e,t){return(r[t]||"boolean"==typeof r[t])&&(e[t]=r[t]),e},n.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce(function(e,t){return n[t]&&(e[t]=n[t]),e},{})},e.checkForErrors=v,e.cleanUrl=function(e){return"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e},e.encodeFormData=l,e.encodeParam=r,e.encodeQueryString=d,e.processParams=a,e.request=i,e.requiresFormData=p,e.setDefaultRequestOptions=function(e,t){e.authentication&&!t&&o("You should not set `authentication` as a default in a shared environment such as a web server which will process multiple users requests. You can call `setDefaultRequestOptions` with `true` as a second argument to disable this warning."),y=e},e.warn=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=request.umd.min.js.map
