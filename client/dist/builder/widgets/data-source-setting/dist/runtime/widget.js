define(["jimu-core","jimu-core/react","jimu-ui","jimu-for-builder"],function(e,t,n,s){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=84)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={addData:"Add data",back:"Back",dataSource:"Data",createFailedWarning:"Failed to create data!",noSupportedDataSource:"No supported data available.",done:"Done",next:"Next",noUsedFieldToMap:"No in use fields need to be mapped.",noChildDssToMap:"No child data needs to be mapped.",inUse:"In use",widgets:"widgets",rename:"Rename",remove:"Remove",affectedWidgets:"Affected widgets",deleteBrokenWidgets:"Delete the broken widgets.",removeDataSource:"Remove data",cancel:"Cancel",others:"Others",data:"Data",relatedWidgets:"Related widgets",previous:"Previous",creatingDataSourceFailed:"Failed to create data!",featureLayer:"Feature Layer",featureLayerView:"Feature Layer View",hubAnnotations:"Hub Annotations",hubEvents:"Hub Events",map:"Map",mapView:"Map View",sceneView:"Scene View",simpleLocal:"Simple Local",webMap:"Web Map",webScene:"Web Scene",csv:"CSV",noRelatedWidget:"No related widget",noUsedField:"No used field"}},function(e,t,n){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(0),r=n(3),i=n(4);function c(e,t){var n,a,o=h(e);return o?(e.isDataSourceSet?(a={childSchemas:{}},n=p(),Object.keys(o.childSchemas).filter(function(t){return n.some(function(n){return e.getFullChildDataSourceId(t)===n})}).forEach(function(n){return a.childSchemas[n]=Object.assign({},c(e.getChildDataSource(n),t))})):(a=s({},h(e),{fields:{}}),n=l(e.id),o.fields&&Object.keys(o.fields).filter(function(e){return n.some(function(t){return e===t})}).forEach(function(e){a.fields[e]=Object.assign({},o.fields[e]),"function"==typeof t&&(a.fields[e]=t(a.fields[e]))})),a):null}function p(){var e=[];return o.appConfigUtils.getAllWidgets(o.getAppStore().getState().appStateInBuilder.appConfig).forEach(function(t){return t.useDataSourcesEnabled&&t.useDataSources&&t.useDataSources.forEach(function(t){t.dataSourceId&&(e=e.concat(t.dataSourceId))})}),e}function l(e){var t=[];return o.appConfigUtils.getAllWidgets(o.getAppStore().getState().appStateInBuilder.appConfig).forEach(function(n){return n.useDataSourcesEnabled&&n.useDataSources&&n.useDataSources.forEach(function(n){n.fields&&n.dataSourceId&&n.dataSourceId===e&&(t=t.concat(n.fields))})}),t}function d(e){if(!e)return[];var t=[];return Object.keys(e).forEach(function(n){t.push(e[n])}),t}function u(e){return!!e&&!!e.childSchemas}function h(e){return e&&e.getSchema?e.getSchema():null}function m(e){return"[object Object]"===Object.prototype.toString.call(e)}function f(e,t){e.isDataSourceSet&&e.getChildDataSources().forEach(function(e){e&&e.dataSourceJson&&e.id&&(t.push(e),f(e,t))})}function g(e,t,n){var a,o,r={};if(!e||!t)return e&&u(e)&&(r.childSchemas={}),r;u(e)&&u(t)?(r={childSchemas:{}},Object.keys(e.childSchemas).forEach(function(s){a=e.childSchemas[s].childId,o=n&&n.childSchemas&&n.childSchemas[s],r.childSchemas[s]=t.childSchemas[a]?g(e.childSchemas[s],t.childSchemas[a],o):null})):u(e)||u(t)?console.error("types of data sources are not matched"):delete(r=s({},t,{fields:S(e,t,n),jimuChildId:e.jimuChildId})).layerDefinition;return r}function S(e,t,n){var s,a,o,r,i={};return e&&e.fields&&t&&t.fields?(Object.keys(e.fields).forEach(function(c){o=e.fields[c],s=o.jimuName,a=o.name,(r=t.fields[a])&&r.esriFieldType===o.esriFieldType&&(i[s]=D(o,r,n))}),i):i}function D(e,t,n){var a;return n&&n.fields&&n.fields[e.jimuName]?(a=n.asMutable({deep:!0}).fields[e.jimuName]).name=t.name:(a=y(s({},t))).jimuName=e.jimuName,a}function y(e){if(!e)return null;var t=s({},e);return t.alias&&delete t.alias,t}function v(e,t){return!!(e&&t&&t.childSchemas)&&Object.keys(t.childSchemas).some(function(t){return t===e})}function w(e,t){return!!(e&&t&&t.childSchemas)&&Object.keys(t.childSchemas).some(function(n){return t.childSchemas[n].childId===e})}function b(e,t){return!!(e&&t&&t.fields)&&Object.keys(t.fields).some(function(n){return t.fields[n].name===e})}function M(e,t){return!!(e&&t&&t.fields)&&!!t.fields[e]}function R(e,n){var s,a=0;if(!n||!e)return a;var o=e.split(t.autoMappingSymbol)[0];return Object.keys(n.childSchemas).forEach(function(e){(s=e.split(t.autoMappingSymbol)||[]).length>1&&s[0]===o&&parseInt(s[1])>a&&(a=parseInt(s[1]))}),a+1}function x(e,n){var s,a=0;if(!n||!n.fields)return a;var o=e.split(t.autoMappingSymbol)[0];return Object.keys(n.fields).forEach(function(e){(s=n.fields[e].jimuName?n.fields[e].jimuName.split(t.autoMappingSymbol):[]).length>1&&s[0]===o&&parseInt(s[1])>a&&(a=parseInt(s[1]))}),a+1}function E(e,n){var a,o,r=s({},e),i=n.jimuName;return M(i,r)&&!b(n.name,r)&&(a=""+i+t.autoMappingSymbol+x(i,r),o=s({},n,{jimuName:a}),r.fields[a]=D(o,o,null)),r}!function(e){e.Point="POINT",e.Polyline="POLYLINE",e.Polygon="POLYGON"}(a=t.GeoType||(t.GeoType={})),t.getDsIcon=function(e){switch(function(e,t){switch(e){case r.AllDataSourceTypes.WebMap:case r.AllDataSourceTypes.MapView:case r.AllDataSourceTypes.WebScene:case r.AllDataSourceTypes.SceneView:case r.AllDataSourceTypes.HubAnnotations:case r.AllDataSourceTypes.HubEvents:return e;case r.AllDataSourceTypes.FeatureLayer:case r.AllDataSourceTypes.FeatureLayerView:case r.AllDataSourceTypes.FeatureQuery:return t?e+"_"+t:e;default:return"UNKNOWN"}}(e&&e.type,e&&e.dataSourceJson&&function(e){var t=e&&e.getSchema&&e.getSchema(),n=t&&t.layerDefinition&&t.layerDefinition.geometryType;if(n){if(-1!==n.toLocaleLowerCase().indexOf(a.Point.toLocaleLowerCase()))return a.Point;if(-1!==n.toLocaleLowerCase().indexOf(a.Polyline.toLocaleLowerCase()))return a.Polyline;if(-1!==n.toLocaleLowerCase().indexOf(a.Polygon.toLocaleLowerCase()))return a.Polygon}return null}(e))){case r.AllDataSourceTypes.WebMap:case r.AllDataSourceTypes.MapView:return n(87);case r.AllDataSourceTypes.WebScene:case r.AllDataSourceTypes.SceneView:return n(88);case r.AllDataSourceTypes.HubAnnotations:return n(89);case r.AllDataSourceTypes.HubEvents:return n(90);case r.AllDataSourceTypes.FeatureLayer+"_"+a.Point:case r.AllDataSourceTypes.FeatureLayerView+"_"+a.Point:case r.AllDataSourceTypes.FeatureQuery+"_"+a.Point:return n(91);case r.AllDataSourceTypes.FeatureLayer+"_"+a.Polyline:case r.AllDataSourceTypes.FeatureLayerView+"_"+a.Polyline:case r.AllDataSourceTypes.FeatureQuery+"_"+a.Polyline:return n(92);case r.AllDataSourceTypes.FeatureLayer+"_"+a.Polygon:case r.AllDataSourceTypes.FeatureLayerView+"_"+a.Polygon:case r.AllDataSourceTypes.FeatureQuery+"_"+a.Polygon:return n(93);case""+r.AllDataSourceTypes.FeatureLayer:case""+r.AllDataSourceTypes.FeatureLayerView:case""+r.AllDataSourceTypes.FeatureQuery:return n(94);default:return n(95)}},t.getDsTypeString=function(e,t){if(!e||!t)return"";switch(e){case r.AllDataSourceTypes.FeatureLayer:case r.AllDataSourceTypes.FeatureQuery:return t.formatMessage({id:"featureLayer",defaultMessage:i.default.featureLayer});case r.AllDataSourceTypes.FeatureLayerView:return t.formatMessage({id:"featureLayerView",defaultMessage:i.default.featureLayerView});case r.AllDataSourceTypes.HubAnnotations:return t.formatMessage({id:"hubAnnotations",defaultMessage:i.default.hubAnnotations});case r.AllDataSourceTypes.HubEvents:return t.formatMessage({id:"hubEvents",defaultMessage:i.default.hubEvents});case r.AllDataSourceTypes.Map:return t.formatMessage({id:"map",defaultMessage:i.default.map});case r.AllDataSourceTypes.MapView:return t.formatMessage({id:"mapView",defaultMessage:i.default.mapView});case r.AllDataSourceTypes.SceneView:return t.formatMessage({id:"sceneView",defaultMessage:i.default.sceneView});case r.AllDataSourceTypes.SimpleLocal:return t.formatMessage({id:"simpleLocal",defaultMessage:i.default.simpleLocal});case r.AllDataSourceTypes.WebMap:return t.formatMessage({id:"webMap",defaultMessage:i.default.webMap});case r.AllDataSourceTypes.WebScene:return t.formatMessage({id:"webScene",defaultMessage:i.default.webScene});case r.AllDataSourceTypes.CSV:return t.formatMessage({id:"csv",defaultMessage:i.default.csv});default:return""}},t.autoMappingSymbol="-$",t.getUsedDsSchema=c,t.getWidgetUsedDss=p,t.getWidgetUsedFields=l,t.getDsUsedWidgets=function(e,t){return e&&t?d(t).filter(function(t){return t&&t.useDataSourcesEnabled&&t.useDataSources&&t.useDataSources.some(function(t){return t.dataSourceId===e})}):[]},t.getAllDsUsedWidgets=function(e,t){return e&&t?d(t).filter(function(t){return t&&t.useDataSources&&t.useDataSources.some(function(t){return t.dataSourceId===e||t.rootDataSourceId&&t.rootDataSourceId===e})}):[]},t.getWhetherMappingIsDone=function e(t,n){return!(!t||!n)&&(u(t)?Object.keys(t.childSchemas).every(function(s){return e(t.childSchemas[s],n.childSchemas[s])}):t.fields&&Object.keys(t.fields).every(function(e){return!(!n.fields||!n.fields[e])}))},t.getWhetherChildMappingIsDone=function(e,t){return!(!e||!t)&&(u(e)?Object.keys(e.childSchemas).every(function(e){return!(!t.childSchemas||!t.childSchemas[e])}):e.fields&&Object.keys(e.fields).every(function(e){return!(!t.fields||!t.fields[e])}))},t.getWhetherSchemaIsSet=u,t.getDsSchema=h,t.getMappedDsJson=function(e,t,n){var s=t.merge({});return s=(s=s.set("id",e.id)).set("schema",o.Immutable(n))},t.getElementPosition=function(e){if(!e)return null;for(var t=e.offsetLeft,n=e.offsetTop,s=e.offsetParent;null!==s;)t+=s.offsetLeft,n+=s.offsetTop,s=s.offsetParent;return{x:t,y:n}},t.isObject=m,t.traverseSchema=function e(t,n,s){if(u(t))for(var a in s.childSchemas||(s.childSchemas={}),t.childSchemas)m(t.childSchemas[a])&&t.childSchemas[a].childId===n.childId?s.childSchemas[a]=n:m(t.childSchemas[a])&&u(t.childSchemas[a])&&(s.childSchemas[a]||(s.childSchemas[a]={}),e(t.childSchemas[a],n,s.childSchemas[a]))},t.getAllChildDss=function(e){var t=[];return e&&e.id&&e.dataSourceJson&&e.isDataSourceSet&&f(e,t),t},t.traverseGetAllChildDss=f,t.getMappedSchemaFromNewSchema=g,t.getMappedFieldsFromNewSchema=S,t.getMappedFieldFromNewField=D,t.getFieldWithoutAlias=y,t.getWhetherJimuChildIdInSchema=v,t.getWhetherChildIdInSchema=w,t.getWhetherNameInSchema=b,t.getWhetherJimuNameInSchema=M,t.getUniqueDsIdFromSchema=R,t.getUniqueFieldIdFromSchema=x,t.getAutoMappedSetSchema=function e(n,a){if(!n||!a)return null;var o,r,i,c=s({},n),p=a.jimuChildId,l=a.childId;return v(p,n)&&!w(l,n)&&(o=""+p+t.autoMappingSymbol+R(p,n),r=u(a)?s({},a,{jimuChildId:o}):s({},a,{fields:{},jimuChildId:o}),c.childSchemas[o]=g(r,r,null)),Object.keys(n.childSchemas).filter(function(e){return n.childSchemas[e].childId===l}).forEach(function(t){(i=n.childSchemas[t])&&(u(a)&&u(i)?Object.keys(a.childSchemas).forEach(function(n){c.childSchemas[t]=e(i,a.childSchemas[n])}):u(a)||u(i)?console.error("types of data sources are not matched"):Object.keys(a.fields).forEach(function(e){c.childSchemas[t]=E(i,a.fields[e])}))}),c},t.getAutoMappedSchema=E,t.getSortedKeys=function(e){return Object.keys(e).sort(function(e,t){return e.localeCompare(t)})},t.getSortedArrayByLabel=function(e){return e.sort(function(e,t){return e.label.localeCompare(t.label)})},t.getIsLastFieldMapping=function(e,t,n){var s=c(t),a=h(e);return w(a.childId,s)?Object.keys(s.childSchemas).filter(function(e){return s.childSchemas[e].childId!==a.childId}).every(function(e){return n.some(function(t){return h(t).childId===s.childSchemas[e].childId})}):(console.warn("data source is not child of ",t),!1)}},,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(18);t.ArcGISDataSourceTypes=s.DataSourceTypes},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Map="MAP",e.WebMap="WEB_MAP",e.WebScene="WEB_SCENE",e.MapView="MAP_VIEW",e.SceneView="SCENE_VIEW",e.FeatureLayer="FEATURE_LAYER",e.FeatureLayerView="FEATURE_LAYER_VIEW"}(t.DataSourceTypes||(t.DataSourceTypes={}))},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(3),r=n(2),i=n(5),c=n(4),p=n(28);r.ReactModal.setAppElement(document&&document.getElementsByTagName("body")[0]);var l=function(e){function t(t){var n=e.call(this,t)||this;return n.onRemove=function(e){if(e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.props.onRemoveItem){var t=n.props.dsJson&&n.props.dsJson.id;0===i.getAllDsUsedWidgets(t,n.props.widgets).length?(o.getAppConfigAction().removeDataSource(t).exec(),o.AppDataSourceManager.getInstance().destroyDataSource(t)):n.setState({isRemoveOptionsShown:!0}),n.props.onRemoveItem()}},n.onRename=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),n.props.onRenameItem&&n.props.onRenameItem()},n.hideRemovePopup=function(){n.setState({isRemoveOptionsShown:!1})},n.state={isRemoveOptionsShown:!1,selectedWidgets:[]},n}return s(t,e),t.prototype.render=function(){if(!this.props.rootDom||!this.props.dsJson)return null;var e=i.getElementPosition(this.props.rootDom);return a.React.createElement("div",{className:a.classNames("shadow ds-more-options",{"d-none":!this.props.isShown}),style:{left:e.x+this.props.rootDom.offsetWidth+16,top:e.y+15}},this.props.onRenameItem&&a.React.createElement("div",{className:"ds-more-option",onClick:this.onRename},this.props.intl.formatMessage({id:"rename",defaultMessage:c.default.rename})),this.props.onRemoveItem&&a.React.createElement("div",{className:"ds-more-option",onClick:this.onRemove},this.props.intl.formatMessage({id:"remove",defaultMessage:c.default.remove})),a.React.createElement(p.default,{dsJson:this.props.dsJson,isShown:this.state.isRemoveOptionsShown,intl:this.props.intl,hideRemovePopup:this.hideRemovePopup,widgets:this.props.widgets}))},t}(a.React.PureComponent);t.default=l},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M2.333 4a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm0 12a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm0 12a3 3 0 1 1 6 0 3 3 0 0 1-6 0z"});function r(e){return a.createElement("svg",s({width:11,height:32,viewBox:"0 0 11 32"},e),o)}e.exports=r,r.default=r},,,,,,,function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(3),r=n(2),i=n(19),c=n(5),p=n(4),l=n(20),d=function(e){function t(t){var n=e.call(this,t)||this;return n.showRenameInput=function(){n.setState({isRenameShown:!0})},n.onRemoveItem=function(){n.props.onToggleMoreOptions(n.props.ds.id)},n.onRenameItem=function(){n.props.onToggleMoreOptions(n.props.ds.id),n.setState({isRenameShown:!0})},n.onToggleMoreOptions=function(e){e.stopPropagation(),n.props.onToggleMoreOptions(n.props.ds.id)},n.onRename=function(){var e=!!n.props.ds.parentDataSource,t=n.state.newName.trim();if(t)if(e){var s=n.props.ds.getRootDataSource(),a=c.getDsSchema(s),r=c.getDsSchema(n.props.ds),i={};r.label=t,delete r.layerDefinition,c.traverseSchema(a,r,i),o.getAppConfigAction().editDataSource(s.dataSourceJson.set("schema",i)).exec(),n.setState({isRenameShown:!1})}else o.getAppConfigAction().editDataSource(n.props.ds.dataSourceJson.set("label",t)).exec(),n.setState({isRenameShown:!1});else n.setState({isRenameShown:!1})},n.onRenameChange=function(e){n.setState({newName:e.target.value})},n.onDsClicked=function(e){n.props.onDsClicked(n.props.ds)},n.onMappingClicked=function(){n.props.onMappingClicked(n.props.ds)},n.stopPropagation=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.state={isRenameShown:!1,newName:n.props.ds?n.props.ds.label||n.props.ds.id:""},n}return s(t,e),t.prototype.componentDidUpdate=function(e,t){t.isRenameShown!==this.state.isRenameShown&&this.state.isRenameShown&&this.renameInput&&(this.renameInput.focus(),this.renameInput.select()),e.ds!==this.props.ds&&this.setState({newName:this.props.ds?this.props.ds.label||this.props.ds.id:""})},t.prototype.render=function(){var e=this;if(!this.props.ds)return null;var t=c.getDsUsedWidgets(this.props.ds.id,this.props.widgets),n=this.props.ds.dataSourceJson&&this.props.ds.dataSourceJson.itemId&&this.props.portalUrl?this.props.portalUrl.replace(/\/sharing\/rest/,"").replace(/\/$/,"")+"/home/item.html?id="+this.props.ds.dataSourceJson.itemId:null;return a.React.createElement("div",{className:"m-3 p-2 list-item",ref:function(t){e.rootDom=t},onClick:this.onDsClicked},a.React.createElement("div",{className:"d-flex align-items-center ds-thumbnail-type-label"},a.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},a.React.createElement(r.Icon,{icon:c.getDsIcon(this.props.ds),className:"text-dark",size:"20"})),this.state.isRenameShown?a.React.createElement(r.Input,{className:"m-2 flex-grow-1 text-truncate p-1 ds-label ds-label-input",ref:function(t){return e.renameInput=t},onBlur:this.onRename,onKeyUp:this.onRename,onChange:this.onRenameChange,value:this.state.newName,onClick:this.stopPropagation}):a.React.createElement("div",{className:"ml-2 flex-grow-1 two-line-truncate ds-label",title:this.props.ds.label||this.props.ds.id},this.props.ds.label||this.props.ds.id),this.props.ds.parentDataSource?null:a.React.createElement("div",{className:"ml-1 flex-shrink-0 ds-more"},a.React.createElement("span",{onClick:this.onToggleMoreOptions},a.React.createElement(r.Icon,{icon:l,className:"text-dark align-baseline"})))),a.React.createElement("div",{className:"mt-2 d-flex justify-content-between ds-type-related-widgets"},a.React.createElement("div",{className:"flex-shrink-0 ds-type"},a.React.createElement("div",{className:"text-truncate ds-type-name"},c.getDsTypeString(this.props.ds.type,this.props.intl))),a.React.createElement("div",{className:"flex-shrink-0 flex-row ds-related-widgets"},a.React.createElement("span",{className:"align-middle"},t&&t.length," ",this.props.intl.formatMessage({id:"widgets",defaultMessage:p.default.widgets})))),a.React.createElement("div",{className:"d-flex justify-content-between"},a.React.createElement("div",{className:"border-gray-300 ds-origin-label",title:this.props.ds.label||this.props.ds.id},n?a.React.createElement(r.Link,{to:n,className:"p-0 ds-origin-label-link",color:"link",target:"_blank",onClick:this.stopPropagation},a.React.createElement("span",{className:"align-middle text-truncate ds-origin-label-link-text"},this.props.ds.label||this.props.ds.id)):null)),a.React.createElement(i.default,{isShown:this.props.isMoreOptionsShown,rootDom:this.rootDom,intl:this.props.intl,widgets:this.props.widgets,dsJson:this.props.ds&&this.props.ds.dataSourceJson,onRemoveItem:this.onRemoveItem,onRenameItem:this.onRenameItem}))},t}(a.React.PureComponent);t.default=d},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(3),r=n(2),i=n(5),c=n(4);r.ReactModal.setAppElement(document&&document.getElementsByTagName("body")[0]);var p=function(e){function t(t){var n=e.call(this,t)||this;return n.modalStyle={content:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"600px",height:"400px"},overlay:{background:"transparent"}},n.onCloseRemoveOptions=function(e){n.stopPropagation(e),n.props.hideRemovePopup()},n.onCheckboxBtnClick=function(e,t){n.stopPropagation(t);var s=n.state.selectedWidgets.indexOf(e);s<0?n.state.selectedWidgets.push(e):n.state.selectedWidgets.splice(s,1),n.setState({selectedWidgets:n.state.selectedWidgets.slice()})},n.onRemoveWidgets=function(e){n.stopPropagation(e);var t,s,r=o.getAppConfigAction();i.getAllDsUsedWidgets(n.props.dsJson.id,n.props.widgets).forEach(function(e){t=e.useDataSources.asMutable(),s=t.filter(function(e){return e.dataSourceId!==n.props.dsJson.id&&(!e.rootDataSourceId||e.rootDataSourceId!==n.props.dsJson.id)}),r.editWidget(e.set("useDataSources",a.Immutable(s)))}),n.state.selectedWidgets.length>0?n.state.selectedWidgets.forEach(function(e,t){t!==n.state.selectedWidgets.length-1?r.removeWidget(e,!0):r.removeWidget(e,!0).removeDataSource(n.props.dsJson.id)}):r.removeDataSource(n.props.dsJson.id),r.exec(),n.props.hideRemovePopup()},n.onToggleRemoveAll=function(e){n.stopPropagation(e),n.setState({whetherRemoveAll:!n.state.whetherRemoveAll,selectedWidgets:n.state.whetherRemoveAll?[]:i.getAllDsUsedWidgets(n.props.dsJson.id,n.props.widgets).map(function(e){return e.id})})},n.stopPropagation=function(e){e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},n.state={selectedWidgets:[],whetherRemoveAll:!1},n}return s(t,e),t.prototype.render=function(){var e=this;return this.props.dsJson?a.React.createElement(r.ReactModal,{isOpen:this.props.isShown,style:this.modalStyle,contentLabel:"Remove Options",className:"bg-gray-100"},a.React.createElement("div",{className:"d-flex justify-content-between border-color-gray-300 pl-2",style:{height:60,border:1}},a.React.createElement("div",{className:"d-flex align-items-center"},a.React.createElement("h2",null,this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:c.default.removeDataSource})))),a.React.createElement("div",{className:"p-2"},a.React.createElement("p",null,this.props.intl.formatMessage({id:"affectedWidgets",defaultMessage:c.default.affectedWidgets})),a.React.createElement("div",null,i.getAllDsUsedWidgets(this.props.dsJson.id,this.props.widgets).map(function(t){return t&&t.id?a.React.createElement(r.Button,{key:t.id,outline:!0,className:"ml-2 mt-2",onClick:function(n){return e.onCheckboxBtnClick(t.id,n)},active:e.state.selectedWidgets.indexOf(t.id)>-1},t.label):null}))),a.React.createElement("div",{style:{position:"absolute",bottom:20,left:0,right:0}},a.React.createElement("div",{className:"ml-2 mb-3"},a.React.createElement(r.Button,{color:"primary",onClick:this.onToggleRemoveAll,active:this.state.whetherRemoveAll},this.props.intl.formatMessage({id:"deleteBrokenWidgets",defaultMessage:c.default.deleteBrokenWidgets}))),a.React.createElement("div",{className:"d-flex justify-content-end"},a.React.createElement(r.Button,{color:"primary",className:"mr-1",onClick:this.onRemoveWidgets},this.props.intl.formatMessage({id:"removeDataSource",defaultMessage:c.default.removeDataSource})),a.React.createElement(r.Button,{color:"primary",className:"mr-3",onClick:this.onCloseRemoveOptions},this.props.intl.formatMessage({id:"cancel",defaultMessage:c.default.cancel}))))):null},t}(a.React.PureComponent);t.default=p},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(3),r=n(2),i=n(19),c=n(5),p=n(4),l=n(20),d=function(e){function t(t){var n=e.call(this,t)||this;return n.onRootClicked=function(e){e.currentTarget.className&&e.currentTarget.className.indexOf&&e.currentTarget.className.indexOf("ds-info")>-1&&n.setState({isMoreOptionsShown:!1})},n.onRemoveItem=function(){n.setState({isMoreOptionsShown:!1})},n.onShowDetailClicked=function(){n.props.onShowDetailClicked(n.props.ds)},n.onRenameItem=function(){n.setState({isMoreOptionsShown:!1,isRenameShown:!0})},n.onRename=function(){var e=!!n.props.ds.parentDataSource,t=n.state.newName.trim();if(t)if(e){var s=n.props.ds.getRootDataSource(),a=c.getDsSchema(s),r=c.getDsSchema(n.props.ds),i={};r.label=t,delete r.layerDefinition,c.traverseSchema(a,r,i),o.getAppConfigAction().editDataSource(s.dataSourceJson.set("schema",i)).exec(),n.setState({isRenameShown:!1})}else o.getAppConfigAction().editDataSource(n.props.ds.dataSourceJson.set("label",t)).exec(),n.setState({isRenameShown:!1});else n.setState({isRenameShown:!1})},n.onRenameChange=function(e){n.setState({newName:e.target.value})},n.onToggleMoreOptions=function(e){e.stopPropagation(),n.setState({isMoreOptionsShown:!n.state.isMoreOptionsShown})},n.onMappingClicked=function(){n.props.onMappingClicked(n.props.ds)},n.state={isMoreOptionsShown:!1,isMappingDetailShown:!1,isRenameShown:!1,newName:n.props.ds?n.props.ds.label||n.props.ds.id:""},n}return s(t,e),t.prototype.componentDidUpdate=function(e,t){t.isRenameShown!==this.state.isRenameShown&&this.state.isRenameShown&&this.renameInput&&(this.renameInput.focus(),this.renameInput.select()),e.ds!==this.props.ds&&this.setState({newName:this.props.ds?this.props.ds.label||this.props.ds.id:""})},t.prototype.render=function(){var e=this;if(!this.props.ds)return a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:p.default.noSupportedDataSource}));var t=!!this.props.ds.parentDataSource,n=this.props.ds.dataSourceJson&&this.props.ds.dataSourceJson.itemId&&this.props.portalUrl?this.props.portalUrl.replace(/\/sharing\/rest/,"").replace(/\/$/,"")+"/home/item.html?id="+this.props.ds.dataSourceJson.itemId:null;return a.React.createElement("div",{className:"p-2 ds-info",ref:function(t){return e.rootDom=t},onClick:this.onRootClicked},a.React.createElement("div",{className:"d-flex align-items-center justify-content-between ds-thumbnail-type-label"},a.React.createElement("div",{className:"d-flex"},a.React.createElement("div",{className:"d-flex align-items-center justify-content-center mr-1 flex-shrink-0 ds-thumbnail"},a.React.createElement(r.Icon,{icon:c.getDsIcon(this.props.ds),className:"text-dark",size:"20"}))),this.state.isRenameShown?a.React.createElement(r.Input,{className:"m-2 flex-grow-1 text-truncate ds-label-input ds-label",ref:function(t){return e.renameInput=t},onBlur:this.onRename,onKeyUp:this.onRename,onChange:this.onRenameChange,value:this.state.newName}):a.React.createElement("div",{className:"ml-2 flex-grow-1 two-line-truncate ds-label",title:this.props.ds.label||this.props.ds.id,onClick:this.onShowDetailClicked},this.props.ds.label||this.props.ds.id),a.React.createElement("div",{className:"d-flex"},t?null:a.React.createElement("div",{className:"ml-1 flex-shrink-0 ds-more"},a.React.createElement("span",{className:"ds-more",onClick:this.onToggleMoreOptions},a.React.createElement(r.Icon,{icon:l,className:"text-dark"}))))),a.React.createElement("div",{className:"mt-2 d-flex ds-type"},a.React.createElement("div",{className:"flex-shrink-0 text-gray-700 text-truncate ds-type-name"},c.getDsTypeString(this.props.ds.type,this.props.intl))),a.React.createElement("div",{className:"mt-2 d-flex justify-content-between"},a.React.createElement("div",{className:"border-gray-300 text-truncate ds-origin-label",title:this.props.ds.label||this.props.ds.id},n?a.React.createElement(r.Link,{to:n,className:"p-0 ds-origin-label-link",color:"link",target:"_blank"},a.React.createElement("span",{className:"align-middle text-truncate ds-origin-label-link-text"},this.props.ds.label||this.props.ds.id)):a.React.createElement("span",{className:"align-middle"},this.props.ds.label||this.props.ds.id))),a.React.createElement(i.default,{isShown:this.state.isMoreOptionsShown,rootDom:this.rootDom,intl:this.props.intl,widgets:this.props.widgets,dsJson:this.props.ds&&this.props.ds.dataSourceJson,onRemoveItem:this.onRemoveItem,onRenameItem:this.onRenameItem}))},t}(a.React.PureComponent);t.default=d},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(5),r=n(4),i=function(e){function t(t){var n=e.call(this,t)||this;return n.Item=function(e){var t=e.widgetJson;return a.React.createElement("div",{className:"container-fluid field-item mb-3",key:t.id},a.React.createElement("div",{className:"row align-items-center no-gutters d-flex field-name"},a.React.createElement("div",{className:"col-1 flex-shrink-0 widget-icon"},a.React.createElement("img",{src:t.icon})),a.React.createElement("div",{className:"col-11"},t.label)))},n.state={},n}return s(t,e),t.prototype.render=function(){if(!this.props.ds)return a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:r.default.noSupportedDataSource}));var e=o.getDsUsedWidgets(this.props.ds.id,this.props.widgets);if(!e||e&&0===e.length)return a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noRelatedWidget",defaultMessage:r.default.noRelatedWidget}));var t=this.Item;return a.React.createElement(a.React.Fragment,null,a.React.createElement("h5",{className:"m-2 in-use-related-widgets"},this.props.intl.formatMessage({id:"relatedWidgets",defaultMessage:r.default.relatedWidgets})),o.getSortedArrayByLabel(e).map(function(e){return a.React.createElement(t,{widgetJson:e,key:e.id})}))},t}(a.React.PureComponent);t.default=i},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}(),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(2),i=n(105),c=n(32),p=n(5),l=n(4),d=function(e){function t(t){var n=e.call(this,t)||this;return n.__unmount=!1,n.updateMappedSchema=function(e,t){var s=a({},n.state.mappedSchema),o=n.props.curDs&&n.props.curDs.dataSourceJson&&n.props.curDs.dataSourceJson.schema,r=p.getMappedFieldFromNewField(e,t,o);s.fields[r.jimuName]=r,n.setState({mappedSchema:s})},n.getIsDoneStatus=function(){return!(!p.getWhetherMappingIsDone(n.state.curSchema,n.state.mappedSchema)||!n.props.newDs)},n.getCanSelectNewDs=function(){return!n.props.newDs||n.props.newDs.id===n.props.curDs.id},n.getSelectedNewField=function(e,t){if(!(n.state.newSchema&&n.state.newSchema.fields&&n.state.mappedSchema&&n.state.mappedSchema.fields&&n.state.mappedSchema.fields[e]))return null;var s=n.state.newSchema.fields[n.state.mappedSchema.fields[e].name];return s&&s.esriType===t?s:null},n.onNextClicked=function(){var e=a({},n.state.mappedSchema);n.state.newSchema&&n.state.newSchema.fields&&Object.keys(n.state.newSchema.fields).forEach(function(t){e=p.getAutoMappedSchema(e,n.state.newSchema.fields[t])}),n.setState({mappedSchema:e},function(){n.props.onMappingFinished(n.props.curDs,n.state.mappedSchema,n.props.isLast)})},n.onPreviousClicked=function(){n.props.backToPreviouseMapping()},n.state={curSchema:p.getUsedDsSchema(n.props.curDs),newSchema:p.getDsSchema(n.props.newDs),mappedSchema:n.props.defaultMappedSchema&&n.props.defaultMappedSchema.fields?o.Immutable(n.props.defaultMappedSchema).asMutable({deep:!0}):null,isDone:!1},n}return s(t,e),t.prototype.componentDidMount=function(){if(this.__unmount=!1,this.getCanSelectNewDs()?this.props.toggleExternalDs(!0):this.props.toggleExternalDs(!1),!this.state.mappedSchema||!this.state.mappedSchema.fields||0===Object.keys(this.state.mappedSchema.fields).length){var e=this.props.curDs&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson.schema;this.setState({mappedSchema:{fields:p.getMappedFieldsFromNewSchema(this.state.curSchema,this.state.newSchema,e)}})}this.setState({isDone:this.getIsDoneStatus()})},t.prototype.componentDidUpdate=function(e,t){if(e.curDs!==this.props.curDs&&this.setState({curSchema:p.getUsedDsSchema(this.props.curDs)}),e.newDs!==this.props.newDs&&this.setState({newSchema:p.getDsSchema(this.props.newDs)}),t.newSchema!==this.state.newSchema||t.curSchema!==this.state.curSchema)if(this.props.defaultMappedSchema&&this.props.defaultMappedSchema.fields&&Object.keys(this.props.defaultMappedSchema.fields).length>0)this.setState({mappedSchema:o.Immutable(this.props.defaultMappedSchema).asMutable({deep:!0})});else{var n=this.props.curDs&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson.schema,s={fields:p.getMappedFieldsFromNewSchema(this.state.curSchema,this.state.newSchema,n)};this.setState({mappedSchema:s})}t.curSchema===this.state.curSchema&&t.mappedSchema===this.state.mappedSchema&&t.newSchema===this.state.newSchema||this.setState({isDone:this.getIsDoneStatus()})},t.prototype.componentWillMount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this;return this.props.curDs?o.React.createElement("div",{className:"ds-mapping-field"},o.React.createElement(c.default,{curDs:this.props.curDs,newDs:this.props.newDs,hideMapping:this.props.hideMapping,isOpenSelectDataBtnHide:!this.getCanSelectNewDs(),toggleExternalDs:this.props.toggleExternalDs,isMappingReady:this.props.isMappingReady,isExternalDsShown:this.props.isExternalDsShown,intl:this.props.intl}),this.state.curSchema&&this.state.curSchema.fields&&Object.keys(this.state.curSchema.fields).length>0?p.getSortedKeys(this.state.curSchema.fields).map(function(t,n){return o.React.createElement(i.default,{curField:e.state.curSchema.fields[t],newSchema:e.state.newSchema,updateMappedSchema:e.updateMappedSchema,selectedNewField:e.getSelectedNewField(t,e.state.curSchema.fields[t].esriType),key:n})}):o.React.createElement("div",{className:"ml-4 mt-2"},this.props.intl.formatMessage({id:"noUsedFieldToMap",defaultMessage:l.default.noUsedFieldToMap})),o.React.createElement("div",{className:"fixed-bottom ds-mapping-buttons"},this.props.curDs.parentDataSource&&o.React.createElement(r.Button,{outline:!0,onClick:this.onPreviousClicked,disabled:!this.props.isMappingReady||this.props.isWarning},this.props.intl.formatMessage({id:"previous",defaultMessage:l.default.previous})),o.React.createElement(r.Button,{disabled:!this.state.isDone||!this.props.isMappingReady||this.props.isWarning,onClick:this.onNextClicked,className:"bg-primary ml-2"},this.props.isLast?this.props.intl.formatMessage({id:"done",defaultMessage:l.default.done}):this.props.intl.formatMessage({id:"next",defaultMessage:l.default.next})))):o.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:l.default.noSupportedDataSource}))},t}(o.React.PureComponent);t.default=d},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),r=n(5),i=n(4),c=n(106),p=n(33),l=function(e){function t(t){var n=e.call(this,t)||this;return n.onToggleExternalDsClicked=function(){n.props.toggleExternalDs(!n.props.isExternalDsShown)},n.onCancelClicked=function(){n.props.hideMapping()},n}return s(t,e),t.prototype.render=function(){if(!this.props.curDs)return a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:i.default.noSupportedDataSource}));var e=this.props.newDs||this.props.curDs;return a.React.createElement("div",{className:"mapping-info"},a.React.createElement("div",{className:"border-color-gray-300 m-2 ds-mapping-header"},this.props.isMappingReady&&a.React.createElement("div",{className:"d-inline-block ds-mapping-header-back",onClick:this.onCancelClicked},a.React.createElement(o.Icon,{icon:p}),a.React.createElement("span",{className:"align-middle ml-2"},this.props.intl.formatMessage({id:"cancel",defaultMessage:i.default.cancel})))),a.React.createElement("div",{className:"border-color-gray-300 ds-mapping-cur-info"},a.React.createElement("div",{className:"flex-grow-1 m-2 align-self-center text-truncate ds-label",title:this.props.curDs.label||this.props.curDs.id},this.props.curDs.label||this.props.curDs.id),a.React.createElement("div",{className:"d-flex m-2"},a.React.createElement("div",{className:"d-flex bg-gray-300 ds-type h6"},a.React.createElement("div",{className:"ml-1 mr-1 bg-success ds-type-icon"}),a.React.createElement("div",{className:"flex-shrink-0 text-gray-700 mr-1 text-truncate ds-type-name"},r.getDsTypeString(this.props.curDs.type,this.props.intl))))),a.React.createElement("div",{className:"m-2 d-flex flex-column ds-mapping-collapse"},a.React.createElement("div",{className:"mt-1 d-flex justify-content-between"},a.React.createElement("span",{className:"align-middle ml-1"},"Source"),this.props.isOpenSelectDataBtnHide?null:a.React.createElement("span",{className:"inline-block mr-1 bg-gray-300 ds-mapping-source",onClick:this.onToggleExternalDsClicked},a.React.createElement(o.Icon,{icon:c,size:"12",className:"text-dark"}))),a.React.createElement("div",{className:a.classNames("text-truncate pl-1 mt-2 w-100 ds-origin-label",{"border border-primary":!!this.props.newDs},{"border-gray-300":!this.props.newDs}),title:e.label||e.id},a.React.createElement("span",{className:"align-middle"},e.label||e.id))))},t}(a.React.PureComponent);t.default=l},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M18.568 27.566c.873.913.873 2.392 0 3.305s-2.288.913-3.16 0L2.766 17.652a2.413 2.413 0 0 1 0-3.305L15.408 1.128c.873-.913 2.288-.913 3.16 0s.873 2.392 0 3.305L7.507 15.999l11.061 11.566z"});function r(e){return a.createElement("svg",s({width:21,height:32,viewBox:"0 0 21 32"},e),o)}e.exports=r,r.default=r},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),r=n(3),i=n(17),c=n(85),p=n(96),l=n(27),d=n(99),u=n(100),h=n(5),m=n(4),f=n(108),g=n(33),S=n(109),D=function(e){function t(t){var n=e.call(this,t)||this;return n.__unmount=!1,n.externalDsStyle={width:"100%",height:"100%",maxWidth:"5000px",margin:0},n.initDss=function(){r.AppDataSourceManager.getInstance().createAllDataSources().then(function(e){n.__unmount||n.setState({isDataSourceInited:!0})},function(e){n.__unmount||(n.setState({isDataSourceInited:!0,isErrorToastShown:!0},function(){setTimeout(function(){n.setState({isErrorToastShown:!1})},3e3)}),console.error(e))})},n.addToDsHistory=function(e){n.setState({dsHistory:n.state.dsHistory.concat(e)})},n.removeFromDsHistory=function(){var e=[];n.state.dsHistory.length>0&&(e=n.state.dsHistory.slice(0,n.state.dsHistory.length-1)),n.setState({dsHistory:e})},n.getItemId=function(e){switch(e.type){case i.ArcGISDataSourceTypes.WebScene:case i.ArcGISDataSourceTypes.WebMap:return e.dataSourceJson.itemId;case i.ArcGISDataSourceTypes.FeatureLayer:return h.getDsSchema(e).childId;default:return null}},n.getSearch=function(e){return{q:"id: "+n.getItemId(e),authentication:a.SessionManager.getInstance().getSession()}},n.getNewDsById=function(e){return e?r.AppDataSourceManager.getInstance().getDataSource(e):null},n.getListUsedDs=function(e){return e?n.state.isDataSourceInited?n.getNewDsById(e.id):e:null},n.onBackClicked=function(){n.removeFromDsHistory()},n.onSelectDataFinished=function(e){e?(r.getAppConfigAction().addDataSources(e).exec(),n.setState({isExternalDsShown:!1,isDataSourceInited:!1})):n.setState({isExternalDsShown:!1})},n.onSelectDataCanceled=function(){n.setState({isExternalDsShown:!1})},n.onMappingClicked=function(e){n.setState({mappingDs:e})},n.onShowDetailClicked=function(e){n.setState({isDataSourceInited:!1});var t=n.getSearch(e);t&&a.esri.restPortal.searchItems(t).then(function(e){n.__unmount||n.setState({item:e.results[0],isDataSourceInited:!0})},function(e){n.__unmount||(console.error(e),n.setState({isDataSourceInited:!0}))})},n.onCloseDetailClicked=function(){n.setState({item:null})},n.onToggleMoreOptions=function(e){n.setState({moreOptionsDsId:n.state.moreOptionsDsId===e?null:e})},n.onToggleExternalDs=function(){n.setState({isExternalDsShown:!n.state.isExternalDsShown})},n.resetSelectedMoreOptions=function(e){e.currentTarget.className&&e.currentTarget.className.indexOf&&e.currentTarget.className.indexOf("widget-ds-setting")>-1&&n.setState({moreOptionsDsId:null})},n.hideMapping=function(){n.setState({mappingDs:null})},n.showExternalDs=function(){n.setState({isExternalDsShown:!0})},n.ExternalDs=a.jsx(r.ExternalDataSourceChooser,{portalUrl:n.props.portalUrl,onCancel:n.onSelectDataCanceled,onFinish:n.onSelectDataFinished}),n.AddDataSourceBtn=a.jsx("div",{className:"d-flex m-3"},a.jsx(o.Button,{color:"primary",className:"text-truncate flex-grow-1 text-center add-data",onClick:n.showExternalDs},a.jsx(o.Icon,{icon:S,size:12}),n.props.intl.formatMessage({id:"addData",defaultMessage:m.default.addData}))),n.state={isDataSourceInited:!1,isExternalDsShown:!1,isErrorToastShown:!1,mappingDs:null,item:null,dsHistory:[],moreOptionsDsId:null},n}return s(t,e),t.prototype.componentDidMount=function(){this.__unmount=!1,this.rootPosition=h.getElementPosition(this.rootDom),this.state.isDataSourceInited||this.initDss()},t.prototype.componentDidUpdate=function(e){this.props.dataSources!==e.dataSources&&(this.__unmount||this.setState({isDataSourceInited:!1})),this.state.isDataSourceInited||this.initDss()},t.prototype.componentWillUnmount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this;return a.jsx("div",{css:f.getStyle(this.props.theme),className:"w-100 h-100"},a.jsx("div",{className:"jimu-widget widget-ds-setting setting-pane",ref:function(t){return e.rootDom=t},onClick:this.resetSelectedMoreOptions},this.state.mappingDs?a.jsx(u.default,{portalUrl:this.props.portalUrl,ds:this.state.mappingDs,widgets:this.props.widgets,dispatch:this.props.dispatch,hideMapping:this.hideMapping,intl:this.props.intl}):a.jsx("div",null,this.state.dsHistory.length>0?a.jsx("div",{className:"border-color-gray-300 jimu-widget-setting--header"},a.jsx("div",{className:"text-dark ds-back",onClick:this.onBackClicked},a.jsx(o.Icon,{icon:g}),a.jsx("span",{className:"align-middle ml-2"},this.props.intl.formatMessage({id:"back",defaultMessage:m.default.back})))):a.jsx("div",{className:"w-100"},this.AddDataSourceBtn),this.props.dataSources&&0===this.state.dsHistory.length?h.getSortedArrayByLabel(Object.keys(this.props.dataSources).filter(function(t){return!e.props.dataSources[t].isOutputFromWidget&&!e.props.dataSources[t].parentDataSource&&e.props.dataSources[t].label}).map(function(t){return e.props.dataSources[t]})).map(function(t,n){if(t&&t.id){var s=r.AppDataSourceManager.getInstance().getDataSource(t.id);return s&&s.id?a.jsx(l.default,{ds:s,key:n,onDsClicked:e.addToDsHistory,intl:e.props.intl,widgets:e.props.widgets,onMappingClicked:e.onMappingClicked,isMoreOptionsShown:e.state.moreOptionsDsId===s.id,onToggleMoreOptions:e.onToggleMoreOptions,isDataSourceInited:e.state.isDataSourceInited,portalUrl:e.props.portalUrl}):a.jsx(d.default,{dsJson:t,key:n,intl:e.props.intl,widgets:e.props.widgets,isMoreOptionsShown:e.state.moreOptionsDsId===t.id,isDataSourceInited:e.state.isDataSourceInited,onToggleMoreOptions:e.onToggleMoreOptions,dataSources:e.props.dataSources})}return null}):null,this.props.dataSources&&this.state.dsHistory.length>0&&!this.state.dsHistory[this.state.dsHistory.length-1].isDataSourceSet?a.jsx(p.default,{onShowDetailClicked:this.onShowDetailClicked,isDataSourceInited:this.state.isDataSourceInited,ds:this.getListUsedDs(this.state.dsHistory[this.state.dsHistory.length-1]),widgets:this.props.widgets,onMappingClicked:this.onMappingClicked,intl:this.props.intl,portalUrl:this.props.portalUrl}):null,this.props.dataSources&&this.state.dsHistory.length>0&&this.state.dsHistory[this.state.dsHistory.length-1].isDataSourceSet?a.jsx(c.default,{onDsItemClicked:this.addToDsHistory,portalUrl:this.props.portalUrl,dispatch:this.props.dispatch,ds:this.getListUsedDs(this.state.dsHistory[this.state.dsHistory.length-1]),onMappingClicked:this.onMappingClicked,isDataSourceInited:this.state.isDataSourceInited,onShowDetailClicked:this.onShowDetailClicked,intl:this.props.intl,widgets:this.props.widgets}):null),this.state.isDataSourceInited?null:a.jsx("div",{className:"jimu-small-loading"})),this.state.item&&this.rootDom?a.jsx(r.ItemDetail,{item:this.state.item,portalUrl:this.props.portalUrl,onClose:this.onCloseDetailClicked,style:{position:"fixed",top:"99px",bottom:0,width:"300px",left:this.rootPosition.x+this.rootDom.offsetWidth+"px"}}):null,this.state.isExternalDsShown?a.jsx(o.Modal,{isOpen:this.state.isExternalDsShown,style:this.externalDsStyle,toggle:this.onToggleExternalDs,contentClassName:"border-0 h-100",className:"widget-ds-setting-add-data-popup"},this.ExternalDs):null,this.state.isErrorToastShown?a.jsx(o.Toast,{type:o.ToastType.Error,text:this.props.intl.formatMessage({id:"creatingDataSourceFailed",defaultMessage:m.default.creatingDataSourceFailed})}):null)},t.mapExtraStateProps=function(e){return{dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,widgets:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.widgets}},t}(a.BaseWidget);t.default=D},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),r=n(86),i=n(29),c=n(30),p=n(4),l=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.render=function(){return this.props.ds?a.React.createElement("div",{className:"ds-list"},a.React.createElement(i.default,{ds:this.props.ds,onMappingClicked:this.props.onMappingClicked,widgets:this.props.widgets,onShowDetailClicked:this.props.onShowDetailClicked,intl:this.props.intl,portalUrl:this.props.portalUrl}),a.React.createElement(o.Tabs,null,a.React.createElement(o.Tab,{title:this.props.intl.formatMessage({id:"data",defaultMessage:p.default.data}),active:!0},a.React.createElement(r.default,{portalUrl:this.props.portalUrl,ds:this.props.ds,key:this.props.ds.id,intl:this.props.intl,dispatch:this.props.dispatch,onDsClicked:this.props.onDsItemClicked,isDataSourceInited:this.props.isDataSourceInited,widgets:this.props.widgets})),a.React.createElement(o.Tab,{title:this.props.intl.formatMessage({id:"widgets",defaultMessage:p.default.widgets})},a.React.createElement(c.default,{ds:this.props.ds,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets})))):a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:p.default.noSupportedDataSource}))},t}(a.React.PureComponent);t.default=l},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(27),r=n(5),i=n(4),c=function(e){function t(t){var n=e.call(this,t)||this;return n.__unmount=!1,n.getInUseAndOthers=function(){var e=[],t=[];return n.state.childDataSources&&n.state.childDataSources.forEach(function(s){s&&s.id&&(r.getDsUsedWidgets(s.id,n.props.widgets).length>0?e.push(s):t.push(s))}),{inUseDss:e,otherDss:t}},n.onToggleMoreOptions=function(e){n.setState({moreOptionsDsId:e})},n.state={isMoreOptionsShown:!1,isMapping:!1,childDataSources:null,moreOptionsDsId:null},n}return s(t,e),t.prototype.componentDidMount=function(){this.__unmount=!1,this.props.ds&&this.setState({childDataSources:this.props.ds.getChildDataSources()})},t.prototype.componentDidUpdate=function(e,t){e.ds!==this.props.ds&&(this.props.ds?this.setState({childDataSources:this.props.ds.getChildDataSources()}):this.setState({childDataSources:null}))},t.prototype.componentWillUnmount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this;if(!this.props.ds)return a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:i.default.noSupportedDataSource}));var t=this.getInUseAndOthers();return a.React.createElement(a.React.Fragment,null,t.inUseDss.length>0?a.React.createElement("div",null,a.React.createElement("h5",{className:"m-2 in-use-related-widgets"},this.props.intl.formatMessage({id:"inUse",defaultMessage:i.default.inUse})),a.React.createElement("div",null,r.getSortedArrayByLabel(t.inUseDss).map(function(t,n){return t&&t.id?a.React.createElement(o.default,{ds:t,key:n,onDsClicked:e.props.onDsClicked,isMoreOptionsShown:e.state.moreOptionsDsId===t.id,onToggleMoreOptions:e.onToggleMoreOptions,isDataSourceInited:e.props.isDataSourceInited,intl:e.props.intl,widgets:e.props.widgets,portalUrl:e.props.portalUrl}):null}))):null,t.otherDss.length>0?a.React.createElement("div",null,a.React.createElement("h5",{className:"m-2 in-use-related-widgets"},this.props.intl.formatMessage({id:"others",defaultMessage:i.default.others})),a.React.createElement("div",null,r.getSortedArrayByLabel(t.otherDss).map(function(t,n){return t&&t.id?a.React.createElement(o.default,{ds:t,key:n,onDsClicked:e.props.onDsClicked,isMoreOptionsShown:e.state.moreOptionsDsId===t.id,onToggleMoreOptions:e.onToggleMoreOptions,isDataSourceInited:e.props.isDataSourceInited,intl:e.props.intl,widgets:e.props.widgets,portalUrl:e.props.portalUrl}):null}))):null)},t}(a.React.PureComponent);t.default=c},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M6 11.943l4 1.711V4.057L6 2.346v9.597zm-1 .17V2.494l-4 1.48v9.619l4-1.48zm6 1.393l4-1.48V2.407l-4 1.48v9.619zM0 15V3.307L5.75 1.18l4.528 1.937L16 1v11.693l-5.75 2.127-4.528-1.937L0 15z",fill:"currentColor",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M7.5 4V1.39C6.402 2.12 5.565 2.99 4.985 4H7.5zm0 3.5V5H4.512a8.13 8.13 0 0 0-.5 2.5H7.5zm0 3.5V8.5H4.012a8.13 8.13 0 0 0 .5 2.5H7.5zm0 3.61V12H4.985c.58 1.01 1.417 1.88 2.515 2.61zm2.543.087A7.014 7.014 0 0 0 13.745 12h-1.6a8.278 8.278 0 0 1-2.102 2.697zM11.015 12H8.5v2.61c1.098-.73 1.935-1.6 2.515-2.61zm1.974-3.5a9.328 9.328 0 0 1-.441 2.5h1.778c.365-.767.594-1.61.656-2.5H12.99zm-1.001 0H8.5V11h2.988a8.13 8.13 0 0 0 .5-2.5zm.56-3.5c.254.775.401 1.609.441 2.5h1.993a6.957 6.957 0 0 0-.656-2.5h-1.778zm-1.06 0H8.5v2.5h3.488a8.13 8.13 0 0 0-.5-2.5zm-1.445-3.697c.91.78 1.611 1.68 2.102 2.697h1.6a7.014 7.014 0 0 0-3.702-2.697zM8.5 4h2.515c-.58-1.01-1.417-1.88-2.515-2.61V4zm-.527 12a8 8 0 1 1 .055-16 8 8 0 0 1-.055 16zM5.957 1.302A7.014 7.014 0 0 0 2.255 4h1.6a8.278 8.278 0 0 1 2.102-2.697zM3.011 7.5c.04-.891.187-1.725.441-2.5H1.674a6.957 6.957 0 0 0-.656 2.5H3.01zm.441 3.5a9.328 9.328 0 0 1-.441-2.5H1.018c.062.89.291 1.733.656 2.5h1.778zm2.505 3.697A8.278 8.278 0 0 1 3.855 12h-1.6a7.014 7.014 0 0 0 3.702 2.697z",fill:"currentColor",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M5.162 12.969A8.28 8.28 0 0 0 8 13.461c3.9 0 7-2.607 7-5.73S11.9 2 8 2 1 4.608 1 7.73c0 1.093.375 2.141 1.078 3.052.409.53.465 1.341.243 2.596 1.369-.482 2.251-.624 2.84-.409zM8 14.461a9.279 9.279 0 0 1-3.181-.553c-.46-.167-1.76.196-3.901 1.092.544-2.018.667-3.22.369-3.607C.473 10.339 0 9.08 0 7.73 0 4.013 3.582 1 8 1s8 3.013 8 6.73c0 3.718-3.582 6.731-8 6.731zM4 9a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm4 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm4 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z",fill:"currentColor",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M1.143 5h13.714V2.154H12V3h-1v-.846H5V3H4v-.846H1.143V5zm0 1v8.846h13.714V6H1.143zM12 1h4v15H0V1h4V0h1v1h6V0h1v1zM3 8.5h2v1H3v-1zm4 0h2v1H7v-1zm4 0h2v1h-2v-1zm-8 3h2v1H3v-1zm4 0h2v1H7v-1zm4 0h2v1h-2v-1z",fill:"currentColor",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M1.5 16a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm0-13a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm13 13a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm0-13a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zM8 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M2.147 13.146l11-11a1.5 1.5 0 1 1 .707.707l-11 11a1.5 1.5 0 1 1-.707-.707z",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M2.915 14h10.17c.05-.14.12-.271.207-.389l-2.204-4.114a1.5 1.5 0 1 1 0-2.995l2.204-4.113A1.496 1.496 0 0 1 13.085 2H2.915c-.151.426-.489.764-.915.915v10.17c.426.151.764.489.915.915zm0 1A1.5 1.5 0 1 1 1 13.085V2.915A1.5 1.5 0 1 1 2.915 1h10.17a1.5 1.5 0 1 1 1.276 1.994l-2.272 3.975a1.495 1.495 0 0 1 0 2.063l2.272 3.974A1.5 1.5 0 1 1 13.086 15H2.914z",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M8 0l8 6-8 6-8-6 8-6zM1.887 6L8 10.82 14.113 6 8 1.18 1.887 6zM.563 9L8 14.775 15.437 9l.563.81L8 16 0 9.81.563 9z",fill:"currentColor",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:16,height:16,viewBox:"0 0 16 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M1 5.304V6.5C1 7.692 3.615 9 7 9s6-1.308 6-2.5V5.304C11.775 6.32 9.546 7 7 7s-4.775-.68-6-1.696zM14 3.5v9c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5v-9C0 1.567 3.134 0 7 0s7 1.567 7 3.5zm-1 4.804C11.775 9.32 9.546 10 7 10s-4.775-.68-6-1.696V9.5C1 10.692 3.615 12 7 12s6-1.308 6-2.5V8.304zm0 3C11.775 12.32 9.546 13 7 13s-4.775-.68-6-1.696V12.5C1 13.692 3.615 15 7 15s6-1.308 6-2.5v-1.196zM7 6c3.385 0 6-1.308 6-2.5S10.385 1 7 1 1 2.308 1 3.5 3.615 6 7 6z",fill:"currentColor",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:14,height:16,viewBox:"0 0 14 16"},e),o)}e.exports=r,r.default=r},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),r=n(97),i=n(30),c=n(29),p=n(4),l=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.render=function(){return this.props.ds?a.React.createElement("div",{className:"field-list"},a.React.createElement(c.default,{ds:this.props.ds,onMappingClicked:this.props.onMappingClicked,widgets:this.props.widgets,onShowDetailClicked:this.props.onShowDetailClicked,intl:this.props.intl,portalUrl:this.props.portalUrl}),a.React.createElement(o.Tabs,null,a.React.createElement(o.Tab,{title:"Data",active:!0},a.React.createElement(r.default,{ds:this.props.ds,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets})),a.React.createElement(o.Tab,{title:"Widgets"},a.React.createElement(i.default,{ds:this.props.ds,isDataSourceInited:this.props.isDataSourceInited,intl:this.props.intl,widgets:this.props.widgets})))):a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:p.default.noSupportedDataSource}))},t}(a.React.PureComponent);t.default=l},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(98),r=n(28),i=n(5),c=n(4),p=function(e){function t(t){var n=e.call(this,t)||this;return n.getFields=function(e){var t=i.getUsedDsSchema(e);return t&&t.fields},n.onRemove=function(e){},n.hideRemovePopup=function(){n.setState({isRemoveOptionsShown:!1})},n.state={isRemoveOptionsShown:!1},n}return s(t,e),t.prototype.render=function(){var e=this;if(!this.props.ds)return a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:c.default.noSupportedDataSource}));var t=this.getFields(this.props.ds);return t&&0!==Object.keys(t).length?a.React.createElement(a.React.Fragment,null,a.React.createElement("h5",{className:"m-2 in-use-related-widgets"},this.props.intl.formatMessage({id:"inUse",defaultMessage:c.default.inUse})),t&&i.getSortedKeys(t).map(function(n,s){return a.React.createElement(o.default,{field:t[n],key:s,onRemove:e.onRemove,isDataSourceInited:e.props.isDataSourceInited})}),a.React.createElement(r.default,{dsJson:this.props.ds&&this.props.ds.dataSourceJson,isShown:this.state.isRemoveOptionsShown,hideRemovePopup:this.hideRemovePopup,intl:this.props.intl,widgets:this.props.widgets})):a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noUsedField",defaultMessage:c.default.noUsedField}))},t}(a.React.PureComponent);t.default=p},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=function(e){function t(t){var n=e.call(this,t)||this;return n.onRemove=function(){n.props.onRemove(n.props.field)},n}return s(t,e),t.prototype.render=function(){if(!this.props.field)return null;var e=this.props.field;return a.React.createElement("div",{className:"container-fluid field-item"},a.React.createElement("div",{className:"row align-items-center no-gutters"},a.React.createElement("div",{className:"col-11 text-truncate field-label",title:e&&(e.alias||e.name)},e&&(e.alias||e.name))),a.React.createElement("div",{className:"row align-items-center no-gutters field-name"}))},t}(a.React.PureComponent);t.default=o},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),r=n(19),i=n(5),c=n(4),p=n(20),l=function(e){function t(t){var n=e.call(this,t)||this;return n.onRemoveItem=function(){n.props.onToggleMoreOptions(n.props.dsJson.id)},n.onToggleMoreOptions=function(e){e.stopPropagation(),n.props.onToggleMoreOptions(n.props.dsJson.id)},n}return s(t,e),t.prototype.render=function(){var e=this;if(!this.props.dsJson)return null;var t=i.getDsUsedWidgets(this.props.dsJson.id,this.props.widgets);return a.React.createElement("div",{className:"m-3 p-2 list-item list-error-item",ref:function(t){e.rootDom=t}},a.React.createElement("div",{className:"d-flex align-items-center ds-thumbnail-type-label"},a.React.createElement("div",{className:"d-flex align-items-center justify-content-center flex-shrink-0 ds-thumbnail"},a.React.createElement(o.Icon,{icon:i.getDsIcon(this.props.dsJson),size:"20"})),a.React.createElement("div",{className:"ml-2 flex-grow-1 two-line-truncate ds-label",title:this.props.dsJson.label||this.props.dsJson.id},this.props.dsJson.label||this.props.dsJson.id),this.props.dataSources&&Object.keys(this.props.dataSources).some(function(t){return!e.props.dataSources[t].isOutputFromWidget&&t===e.props.dsJson.id})?a.React.createElement("div",{className:"ml-1 flex-shrink-0 ds-more"},a.React.createElement("span",{onClick:this.onToggleMoreOptions},a.React.createElement(o.Icon,{icon:p,className:"text-dark align-baseline"}))):null),a.React.createElement("div",{className:"mt-2 d-flex justify-content-between ds-type-related-widgets"},a.React.createElement("div",{className:"flex-shrink-0 ds-type"},a.React.createElement("div",{className:"text-truncate ds-type-name"},i.getDsTypeString(this.props.dsJson.type,this.props.intl))),a.React.createElement("div",{className:"flex-shrink-0 flex-row ds-related-widgets"},a.React.createElement("span",{className:"align-middle"},t&&t.length," ",this.props.intl.formatMessage({id:"widgets",defaultMessage:c.default.widgets})))),a.React.createElement("div",{className:"d-flex justify-content-between"},a.React.createElement("div",{className:"border-gray-300 text-truncate ds-origin-label",title:this.props.dsJson.label||this.props.dsJson.id},a.React.createElement("span",{className:"align-middle"},this.props.dsJson.label||this.props.dsJson.id))),a.React.createElement(r.default,{isShown:this.props.isMoreOptionsShown,rootDom:this.rootDom,intl:this.props.intl,dsJson:this.props.dsJson,onRemoveItem:this.onRemoveItem,widgets:this.props.widgets}))},t}(a.React.PureComponent);t.default=l},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(3),r=n(5),i=n(4),c=n(101),p=n(31),l=n(107),d=function(e){function t(t){var n=e.call(this,t)||this;return n.__unmount=!1,n.createSameDsWithDiffId=function(e){if(!e||!e.id)return Promise.reject("Pass a wrong data source");var t=n.getTempDsId(e.id),s=e.set("id",t).without("schema");return n.creatingDsId=t,o.AppDataSourceManager.getInstance().createDataSource(s).then(function(e){return n.creatingDsId=null,e})},n.destoryDs=function(e){e&&e!==n.props.ds.id&&o.AppDataSourceManager.getInstance().destroyDataSource(e)},n.updateMappingHistory=function(e){n.setState({mappingHistory:e})},n.hideMapping=function(){n.state.newDs&&n.destoryDs(n.state.newDs.id),n.creatingDsId&&n.destoryDs(n.creatingDsId),n.props.hideMapping()},n.hideExternalDs=function(){n.setState({isExternalDsShown:!1})},n.getTempDsId=function(e){return e+"-"+a.uuidv1()},n.toggleExternalDs=function(e){n.setState({isExternalDsShown:e})},n.onSelectExternalDs=function(e){var t=e[0];t?(n.setState({isMappingReady:!1}),n.createSameDsWithDiffId(t).then(function(e){n.__unmount||n.setState({newDs:e,isMappingReady:!0,isWarning:!1})},function(e){n.__unmount||(console.error(e),n.setState({isMappingReady:!0,isWarning:!0}))})):n.setState({isWarning:!0})},n.onRemoveExternalDs=function(e){e[0]||n.setState({isWarning:!0}),n.setState({newDs:null})},n.state={newDs:null,mappedSchema:n.props.ds&&n.props.ds.isDataSourceSet?{childSchemas:{}}:{},mappingHistory:n.props.ds?[n.props.ds]:[],isExternalDsShown:!0,isDone:!1,isMappingReady:!1,isWarning:!1},n}return s(t,e),t.prototype.componentDidMount=function(){var e=this;this.__unmount=!1,this.rootDom&&this.dataChooser&&this.moveDataChooser(),this.props.ds&&this.createSameDsWithDiffId(this.props.ds.dataSourceJson).then(function(t){e.__unmount||e.setState({newDs:t,mappedSchema:r.getUsedDsSchema(t,function(e){return delete e.alias,e}),isMappingReady:!0,isWarning:!1})},function(t){e.__unmount||(console.error(t),e.setState({isMappingReady:!0,isWarning:!0}))})},t.prototype.componentDidUpdate=function(e,t){var n=this;this.rootDom&&this.dataChooser&&this.moveDataChooser(),t.newDs!==this.state.newDs&&t.newDs&&this.destoryDs(t.newDs.id),!this.state.newDs&&this.props.ds&&(this.setState({isMappingReady:!1}),this.createSameDsWithDiffId(this.props.ds.dataSourceJson).then(function(e){n.__unmount||n.setState({newDs:e,mappedSchema:r.getUsedDsSchema(e,function(e){return delete e.alias,e}),isMappingReady:!0,isWarning:!1})},function(e){n.__unmount||(console.error(e),n.setState({isMappingReady:!0,isWarning:!0}))}))},t.prototype.componentWillUnmount=function(){this.__unmount=!0,this.state.newDs&&this.destoryDs(this.state.newDs.id),this.creatingDsId&&this.destoryDs(this.creatingDsId)},t.prototype.moveDataChooser=function(){var e=r.getElementPosition(this.rootDom);e&&(this.dataChooser.style.left=e.x+this.rootDom.offsetWidth+"px",this.dataChooser.style.top=e.y-10+"px",this.dataChooser.style.width=document.body.offsetWidth-e.x-this.rootDom.offsetWidth+"px",this.dataChooser.style.height=document.body.offsetHeight-100+"px")},t.prototype.onMappingFinished=function(e,t){var n;e&&this.state.newDs&&(e.dataSourceJson?e.dataSourceJson&&t&&(n=r.getMappedDsJson(this.props.ds.dataSourceJson,this.state.newDs.dataSourceJson,t)):n=e,o.getAppConfigAction().editDataSource(n).exec(),this.setState({mappedSchema:n.schema}),this.hideMapping())},t.prototype.render=function(){var e=this;return this.props.ds?a.React.createElement("div",{className:"ds-mapping",ref:function(t){return e.rootDom=t}},this.props.ds.isDataSourceSet?a.React.createElement("div",{className:"ds-mapping-ds-container"},a.React.createElement(c.default,{curDs:this.props.ds,newDs:this.state.newDs,isRoot:!0,intl:this.props.intl,onMappingFinished:this.onMappingFinished.bind(this),defaultMappedSchema:this.state.mappedSchema,hideMapping:this.hideMapping,toggleExternalDs:this.toggleExternalDs,isWarning:this.state.isWarning,isExternalDsShown:this.state.isExternalDsShown,isMappingReady:this.state.isMappingReady,mappingHistory:this.state.mappingHistory,updateMappingHistory:this.updateMappingHistory,widgets:this.props.widgets})):null,this.props.ds.isDataSourceSet?null:a.React.createElement("div",{className:"ds-mapping-field-container"},a.React.createElement(p.default,{curDs:this.props.ds,newDs:this.state.newDs,onMappingFinished:this.onMappingFinished.bind(this),defaultMappedSchema:this.state.mappedSchema,hideMapping:this.hideMapping,isWarning:this.state.isWarning,isMappingReady:this.state.isMappingReady,isExternalDsShown:this.state.isExternalDsShown,isLast:!0,toggleExternalDs:this.toggleExternalDs,mappingHistory:this.state.mappingHistory,intl:this.props.intl,widgets:this.props.widgets})),this.state.isMappingReady?null:a.React.createElement("div",{className:"jimu-small-loading"}),this.state.isExternalDsShown?a.React.createElement("div",{className:"ds-mapping-external-data",ref:function(t){return e.dataChooser=t}},a.React.createElement(o.ExternalDataSourceChooser,{portalUrl:this.props.portalUrl,onSelect:this.onSelectExternalDs,onRemove:this.onRemoveExternalDs,onCancel:this.hideExternalDs,isRadio:!0,types:this.props.ds?a.Immutable([this.props.ds.type]):a.Immutable([])})):null,this.state.isWarning?a.React.createElement(l.default,{warning:this.props.intl.formatMessage({id:"createFailedWarning",defaultMessage:i.default.createFailedWarning})}):null):a.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:i.default.noSupportedDataSource}))},t}(a.React.PureComponent);t.default=d},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}(),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(2),i=n(102),c=n(31),p=n(32),l=n(5),d=n(4),u=function(e){function t(t){var n=e.call(this,t)||this;return n.__unmount=!1,n.updateMappedChildSchema=function(e,t){var s,o=a({},n.state.mappedSchema),r=l.getDsSchema(e),i=r&&r.jimuChildId,c=e&&e.dataSourceJson&&e.dataSourceJson&&e.dataSourceJson.schema;s=l.getMappedSchemaFromNewSchema(l.getUsedDsSchema(e),l.getDsSchema(t),c),o.childSchemas[i]=s,n.setState({mappedSchema:o})},n.updateMappedSchema=function(e,t){var s=a({},n.state.mappedSchema),o=l.getDsSchema(t),r=o&&o.jimuChildId;s.childSchemas[r]=a({},s.childSchemas[r],e),n.setState({mappedSchema:s})},n.setChildDs=function(e,t){n.setState({curChildDs:e,newChildDs:t})},n.getIsDoneStatus=function(){return!!l.getWhetherMappingIsDone(n.state.curSchema,n.state.mappedSchema)},n.getIsChildMappingDoneStatus=function(){return!!l.getWhetherChildMappingIsDone(n.state.curSchema,n.state.mappedSchema)},n.getSelectedNewDs=function(e){if(!(n.state.mappedSchema&&n.state.mappedSchema.childSchemas&&n.state.mappedSchema.childSchemas[e]&&n.props.newDs))return null;var t=n.state.mappedSchema.childSchemas[e].childId;return t?n.props.newDs.getChildDataSource(t):null},n.getDefaultMappedFieldSchema=function(){var e=l.getDsSchema(n.props.curDs);return n.props.defaultMappedSchema&&e?n.props.defaultMappedSchema.childSchemas[e.jimuChildId]:null},n.getWhetherHaveChildDssToMap=function(){return n.state.curSchema&&n.state.curSchema.childSchemas&&0!==Object.keys(n.state.curSchema.childSchemas).length},n.onFieldMappingFinished=function(e,t,s){var o=a({},t);n.props.updateMappedSchema&&n.props.updateMappedSchema(o,n.props.curDs),s?n.props.onDsMappingFinished():n.props.traverseParentDsMapping&&n.props.traverseParentDsMapping()},n.onDsMappingFinished=function(){if(n.props.newDs){var e=a({},n.state.mappedSchema);n.props.newDs.getChildDataSources().forEach(function(t){e=l.getAutoMappedSetSchema(e,l.getDsSchema(t))}),n.setState({mappedSchema:e},function(){if(n.props.isRoot){var e=l.getMappedDsJson(n.props.curDs.dataSourceJson,n.props.newDs.dataSourceJson,n.state.mappedSchema);n.props.onMappingFinished&&n.props.onMappingFinished(e)}else n.props.updateMappedSchema&&n.props.updateMappedSchema(n.state.mappedSchema,n.props.curDs);n.props.hideMapping()})}},n.traverseDsMapping=function(){var e=l.getSortedKeys(n.state.curSchema.childSchemas).find(function(e){return n.props.mappingHistory.every(function(t){return!l.getDsSchema(t).jimuChildId||l.getDsSchema(t).jimuChildId!==e})}),t=n.props.curDs.getChildDataSource(e),s=n.getSelectedNewDs(e);t?(n.setChildDs(t,s),n.props.updateMappingHistory(n.props.mappingHistory.concat(t))):n.props.traverseParentDsMapping?n.props.traverseParentDsMapping():(n.setChildDs(null,null),n.onDsMappingFinished())},n.reverseTraverseDsMapping=function(){var e=n.props.mappingHistory.length>1?n.props.mappingHistory.slice(n.props.mappingHistory.length-2)[0]:null,t=l.getDsSchema(e)&&l.getDsSchema(e).jimuChildId,s=n.getSelectedNewDs(t);e&&(n.setChildDs(e,s),n.props.updateMappingHistory(n.props.mappingHistory.slice(0,n.props.mappingHistory.length-1)))},n.state={newChildDs:null,curChildDs:null,curSchema:n.props.curDs&&n.props.curDs.isDataSourceSet?l.getUsedDsSchema(n.props.curDs):null,newSchema:n.props.newDs&&n.props.newDs.isDataSourceSet?l.getDsSchema(n.props.newDs):null,mappedSchema:n.props.defaultMappedSchema||null,isDone:!1,isChildMappingDone:!1},n}return s(t,e),t.prototype.componentDidMount=function(){if(this.__unmount=!1,!this.state.mappedSchema||0===Object.keys(this.state.mappedSchema).length){var e=this.props.curDs&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson.schema;this.setState({mappedSchema:l.getMappedSchemaFromNewSchema(this.state.curSchema,this.state.newSchema,e)})}this.setState({isDone:this.getIsDoneStatus(),isChildMappingDone:this.getIsChildMappingDoneStatus()})},t.prototype.componentDidUpdate=function(e,t){if(e.curDs!==this.props.curDs&&this.props.curDs&&this.props.curDs.isDataSourceSet&&this.setState({curSchema:l.getUsedDsSchema(this.props.curDs)}),e.newDs!==this.props.newDs&&this.props.newDs&&this.props.newDs.isDataSourceSet&&this.setState({newSchema:l.getDsSchema(this.props.newDs)}),t.newSchema!==this.state.newSchema){var n=this.props.curDs&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson&&this.props.curDs.dataSourceJson.schema;this.setState({mappedSchema:l.getMappedSchemaFromNewSchema(this.state.curSchema,this.state.newSchema,n)})}t.curSchema===this.state.curSchema&&t.mappedSchema===this.state.mappedSchema&&t.newSchema===this.state.newSchema||this.setState({isDone:this.getIsDoneStatus(),isChildMappingDone:this.getIsChildMappingDoneStatus()}),e.isRoot!==this.props.isRoot&&this.props.isRoot&&this.props.toggleExternalDs(!0)},t.prototype.componentWillMount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this;return this.props.curDs?o.React.createElement(o.React.Fragment,null,this.state.curChildDs&&this.state.newChildDs?o.React.createElement(t,{newDs:this.state.newChildDs,curDs:this.state.curChildDs,defaultMappedSchema:this.state.mappedSchema,isRoot:!1,isExternalDsShown:this.props.isExternalDsShown,isMappingReady:this.props.isMappingReady,hideMapping:this.props.hideMapping,toggleExternalDs:this.props.toggleExternalDs,isWarning:this.props.isWarning,mappingHistory:this.props.mappingHistory,updateMappedSchema:this.updateMappedSchema,traverseParentDsMapping:this.traverseDsMapping,updateMappingHistory:this.props.updateMappingHistory,reverseTraverseParentDsMapping:this.reverseTraverseDsMapping,widgets:this.props.widgets,onDsMappingFinished:this.onDsMappingFinished,intl:this.props.intl}):o.React.createElement("div",{className:"w-100 h-100 ds-mapping-ds"},this.props.curDs.isDataSourceSet?o.React.createElement("div",null,o.React.createElement(p.default,{curDs:this.props.curDs,newDs:this.props.newDs,hideMapping:this.props.hideMapping,toggleExternalDs:this.props.toggleExternalDs,isMappingReady:this.props.isMappingReady,isExternalDsShown:this.props.isExternalDsShown,intl:this.props.intl}),this.getWhetherHaveChildDssToMap()?o.React.createElement("div",null,o.React.createElement("h5",{className:"m-2 in-use-related-widgets"},this.props.intl.formatMessage({id:"inUse",defaultMessage:d.default.inUse})),l.getSortedKeys(this.state.curSchema.childSchemas).map(function(t,n){return o.React.createElement(i.default,{curDs:e.props.curDs.getChildDataSource(t),selectedNewDs:e.getSelectedNewDs(t),key:n,newParentDs:e.props.newDs,updateMappedSchema:e.updateMappedChildSchema,isDone:l.getWhetherMappingIsDone(e.state.curSchema.childSchemas[t],e.state.mappedSchema.childSchemas[t]),widgets:e.props.widgets,intl:e.props.intl})})):o.React.createElement("div",{className:"p-2"},this.props.intl.formatMessage({id:"noChildDssToMap",defaultMessage:d.default.noChildDssToMap})),o.React.createElement("div",{className:"fixed-bottom ds-mapping-buttons"},o.React.createElement(r.Button,{disabled:1===this.props.mappingHistory.length||!this.props.isMappingReady||this.props.isWarning,outline:!0,onClick:this.reverseTraverseDsMapping},this.props.intl.formatMessage({id:"previous",defaultMessage:d.default.previous})),o.React.createElement(r.Button,{outline:!0,onClick:this.traverseDsMapping,disabled:!this.state.isChildMappingDone||!this.props.isMappingReady||this.props.isWarning,className:"bg-primary ml-2"},this.getWhetherHaveChildDssToMap()?this.props.intl.formatMessage({id:"next",defaultMessage:d.default.next}):this.props.intl.formatMessage({id:"done",defaultMessage:d.default.done})))):o.React.createElement("div",{className:"ds-mapping-field-container"},o.React.createElement(c.default,{curDs:this.props.curDs,newDs:this.props.newDs,onMappingFinished:this.onFieldMappingFinished,defaultMappedSchema:this.getDefaultMappedFieldSchema(),isExternalDsShown:this.props.isExternalDsShown,hideMapping:this.props.hideMapping,isLast:l.getIsLastFieldMapping(this.props.curDs,this.props.curDs.parentDataSource,this.props.mappingHistory),toggleExternalDs:this.props.toggleExternalDs,isMappingReady:this.props.isMappingReady,mappingHistory:this.props.mappingHistory.concat(this.props.curDs),isWarning:this.props.isWarning,backToPreviouseMapping:this.props.reverseTraverseParentDsMapping,intl:this.props.intl,widgets:this.props.widgets})))):o.React.createElement("div",{className:"m-2"},this.props.intl.formatMessage({id:"noSupportedDataSource",defaultMessage:d.default.noSupportedDataSource}))},t}(o.React.PureComponent);t.default=u},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),r=n(5),i=n(103),c=n(104),p=function(e){function t(t){var n=e.call(this,t)||this;return n.__unmount=!1,n.toggleDropdown=function(){n.setState({isNewDsDropdownOpen:!n.state.isNewDsDropdownOpen})},n.setNewChildDss=function(e){e&&n.setState({newDss:e.getChildDataSources()})},n.getSelectedDsLabel=function(e){return e&&(e.label||e.id)},n.onSelectedNewDsChange=function(e){n.props.updateMappedSchema(n.props.curDs,e)},n.DsInfo=function(e){var t=e.curDs,s=(e.selectedNewDs,r.getDsUsedWidgets(t.id,n.props.widgets));return a.React.createElement("div",null,a.React.createElement("div",{className:"d-flex align-items-center m-2"},a.React.createElement("div",{className:"d-flex align-items-center justify-content-center mr-1 flex-shrink-0 border-gray-300 ds-thumbnail"},a.React.createElement(o.Icon,{icon:r.getDsIcon(t),className:"text-dark",size:"22"})),a.React.createElement("div",{className:"flex-grow-1 text-truncate p-1",title:t.label||t.id},t.label||t.id),n.props.isDone?null:a.React.createElement("div",{className:"d-flex align-items-center justify-content-center mb-3"},a.React.createElement(o.Icon,{icon:i,className:"text-red",size:"12"}))),a.React.createElement("div",{className:"d-flex m-2"},a.React.createElement("div",{className:"w-100 d-flex"},a.React.createElement("div",{className:"d-flex bg-gray-300 ds-type h6 pl-1 pr-1"},a.React.createElement("div",{className:"flex-shrink-0 text-gray-700 mr-1 text-truncate ds-type-name"},r.getDsTypeString(t.type,n.props.intl)))),a.React.createElement("div",{className:"flex-shrink-0 d-flex flex-row ds-related-widgets"},a.React.createElement(o.Icon,{icon:c,className:"mr-1 text-dark"}),a.React.createElement("span",{className:"align-middle"},s&&s.length))))},n.state={isNewDsDropdownOpen:!1,newDss:null},n}return s(t,e),t.prototype.componentDidMount=function(){this.__unmount=!1,this.setNewChildDss(this.props.newParentDs)},t.prototype.componentDidUpdate=function(e){e.newParentDs!==this.props.newParentDs&&this.setNewChildDss(this.props.newParentDs)},t.prototype.componentWillMount=function(){this.__unmount=!0},t.prototype.render=function(){var e=this;if(!this.props.curDs)return null;var t=this.props.selectedNewDs,n=this.DsInfo;return a.React.createElement("div",{className:"border-gray-300 bg-white m-2 list-item ds-mapping-ds-item"},a.React.createElement(n,{curDs:this.props.curDs,selectedNewDs:t}),a.React.createElement("div",{className:"align-items-center"},a.React.createElement("div",{className:"ds-mapping-drop-down p-2"},a.React.createElement(o.ButtonDropdown,{isOpen:this.state.isNewDsDropdownOpen,className:"w-100 drop-down",toggle:this.toggleDropdown},a.React.createElement(o.DropdownToggle,{caret:!0,outline:!0,className:"w-100 text-truncate",disabled:!this.state.newDss},this.getSelectedDsLabel(t)||""),this.state.newDss?a.React.createElement(o.DropdownMenu,{className:"w-100 text-truncate"},r.getSortedArrayByLabel(this.state.newDss).map(function(t,n){return t&&t.id?a.React.createElement(o.DropdownItem,{key:n,onClick:function(){e.onSelectedNewDsChange(t)},title:t.label||t.id},a.React.createElement("div",{className:"text-truncate"},t.label||t.id)):null})):null))))},t}(a.React.PureComponent);t.default=p},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M16.492 0c-8.837 0-16 7.163-16 16s7.163 16 16 16 16-7.163 16-16-7.163-16-16-16zm0 21.333a2 2 0 1 1 .001 3.999 2 2 0 0 1-.001-3.999zm0-2.666a2 2 0 0 1-2-2v-8a2 2 0 1 1 4 0v8a2 2 0 0 1-2 2z"});function r(e){return a.createElement("svg",s({width:35,height:32,viewBox:"0 0 35 32"},e),o)}e.exports=r,r.default=r},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M11.742 1.623a3.228 3.228 0 0 0 1.204 4.384A3.21 3.21 0 0 0 16.15.443a3.204 3.204 0 0 0-4.408 1.18zm16.86 22.929a3.204 3.204 0 0 0-4.32-4.435 3.204 3.204 0 0 0-1.532 3.591 3.179 3.179 0 0 0 1.493 1.951 3.204 3.204 0 0 0 4.36-1.108zm-3.95-7.081a5.47 5.47 0 0 1 2.409 0V9.065l-7.226-4.143a5.366 5.366 0 0 1-1.204 2.095l6.021 3.444v7.009zM.446 21.301a3.204 3.204 0 0 0 1.181 4.384 3.204 3.204 0 0 0 4.384-1.181 3.204 3.204 0 0 0-2.77-4.818A3.227 3.227 0 0 0 .447 21.3zm4.07-3.806v-7.033l5.901-3.468a5.594 5.594 0 0 1-1.204-2.071L2.108 9.066v8.43a5.5 5.5 0 0 1 2.409 0zm15.945 7.033l-5.925 3.42-5.925-3.42c-.119.428-.289.84-.506 1.228a5.69 5.69 0 0 1-.626.891l7.081 4.095 7.105-4.095a5.604 5.604 0 0 1-1.204-2.12z"});function r(e){return a.createElement("svg",s({width:29,height:32,viewBox:"0 0 29 32"},e),o)}e.exports=r,r.default=r},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2),r=n(5),i=function(e){function t(t){var n=e.call(this,t)||this;return n.toggleDropdown=function(){n.setState({isDropdownOpen:!n.state.isDropdownOpen})},n.onDropDownItemClicked=function(e){n.props.updateMappedSchema(n.props.curField,e)},n.state={isDropdownOpen:!1},n}return s(t,e),t.prototype.render=function(){var e=this;if(!this.props.curField||!this.props.newSchema)return null;var t=this.props.newSchema,n=this.props.selectedNewField;return a.React.createElement("div",{className:"m-2 filed-mapping-item"},a.React.createElement("div",null,this.props.curField.alias||this.props.curField.name),a.React.createElement("div",{className:"ds-mapping-drop-down p-2"},a.React.createElement(o.ButtonDropdown,{isOpen:this.state.isDropdownOpen,className:"w-100 drop-down",toggle:this.toggleDropdown},a.React.createElement(o.DropdownToggle,{caret:!0,outline:!0,className:"w-100 text-truncate",disabled:!t||!t.fields},n&&(n.alias||n.name)||""),t&&t.fields?a.React.createElement(o.DropdownMenu,{className:"w-100 text-truncate"},r.getSortedKeys(t.fields).map(function(n,s){return t.fields[n]&&t.fields[n].esriType===e.props.curField.esriType?a.React.createElement(o.DropdownItem,{key:s,onClick:function(){return e.onDropDownItemClicked(t.fields[n])}},a.React.createElement("div",{className:"text-truncate"},t.fields[n].alias||t.fields[n].name)):null})):null)))},t}(a.React.PureComponent);t.default=i},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M38.784 9.778v2.962H3.236V9.778h.074L13.086.002l2.111 2.111-7.702 7.665h31.29zM3.236 21.628h31.327l-7.702 7.702 2.111 2.111 9.776-9.813h.037v-2.962H3.237v2.962z"});function r(e){return a.createElement("svg",s({width:39,height:32,viewBox:"0 0 39 32"},e),o)}e.exports=r,r.default=r},function(e,t,n){"use strict";var s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function s(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(s.prototype=n.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(2);o.ReactModal.setAppElement(document&&document.getElementsByTagName("body")[0]);var r=function(e){function t(t){var n=e.call(this,t)||this;return n.contentStyle={position:"fixed",bottom:"50px",top:"auto",left:"0",right:"auto",width:"280px",height:"90px",backgroundColor:n.props.theme.colors.grays.gray200,borderColor:n.props.theme.colors.danger,borderWidth:"1px",borderStyle:"solid",zIndex:5},n}return s(t,e),t.prototype.render=function(){return this.props.warning?a.jsx(o.ReactModal,{isOpen:!0,style:{content:this.contentStyle,overlay:this.contentStyle}},this.props.warning):null},t}(a.React.PureComponent),i=a.themeUtils.withTheme(r);t.default=i},function(e,t,n){"use strict";var s=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};Object.defineProperty(t,"__esModule",{value:!0});var a,o=n(0);t.getStyle=function(e){return o.css(a||(a=s(["\n    .widget-ds-setting{\n      width: 100%;\n      min-height: 100%;\n      position: absolute;\n      overflow: auto;\n\n      .in-use-related-widgets{\n        font-size: 14px;\n        color: ",";\n        margin-top: 16px !important;\n        margin-bottom: 16px !important;\n        font-weight: bold;\n      }\n\n      .widget-icon{\n        >img{\n          vertical-align: text-top;\n          width: ",";\n          height: ",";\n        }\n      }\n\n      .drop-down{\n        button{\n          background-color: ",";\n        }\n      }\n\n      .setting-header{\n        border-bottom: 1px;\n      }\n\n      .ds-back{\n        width: 40%;\n        cursor: pointer;\n        height: 20px;\n        text-transform: initial;\n        margin-left: -5px;\n      }\n\n      .add-data{\n        height: ",";\n        line-height: ",";\n        width: 228px;\n        padding: 0;\n        border-radius: 2px;\n        cursor: pointer;\n      }\n      button.add-data:hover{\n        color: "," !important;\n      }\n\n      .ds-label-input{\n        width: 90%;\n      }\n\n      .two-line-truncate{\n        overflow: hidden;\n        text-overflow: ellipsis;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        word-break: break-all;\n        word-wrap: break-word;\n      }\n\n      .ds-thumbnail-type{\n        padding: "," "," 0  ",";\n      }\n\n      .ds-more{\n        margin-left:  ",";\n        cursor: pointer;\n      }\n\n      .ds-origin-label{\n        .ds-origin-label-link, .ds-origin-label-link:hover, .ds-origin-label-link:focus, .ds-origin-label-link:active{\n          color: ",";\n          outline: none;\n          box-shadow: 0 0 0 !important;\n          border: 0 !important;\n        }\n        .ds-origin-label-link-text{\n          display: inline-block;\n          font-size: ",";\n          max-width: 200px;\n        }\n      }\n\n      .mapping-info{\n        .ds-label{\n          cursor: default;\n        }\n      }\n\n      .ds-mapping-icon{\n        cursor: pointer;\n      }\n\n      .ds-mapping-collapse{\n        padding: "," "," 0  ",";\n        .ds-origin-label{\n          max-width: 170px;\n          height:  ",";\n          line-height:  ",";\n          border-radius: 2px;\n        }\n      }\n\n      .ds-widgets-more{\n        padding:  ",";\n      }\n\n      .list-item{\n        cursor: pointer;\n        background-color: ",";\n        font-size: ",";\n        .ds-label{\n          font-size: ",";\n        }\n        .ds-related-widgets{\n          color: ",";\n        }\n      }\n\n      .list-item.list-error-item{\n        cursor: default;\n        user-select: none;\n        background-color: ",";\n        color: ",";\n        .ds-thumbnail{\n          background-color: ",";\n        }\n        .jimu-icon{\n          color: ",";\n        }\n        .ds-related-widgets{\n          color: ",";\n        }\n      }\n\n      .ds-thumbnail{\n        width:  ",";\n        height:  ",";\n        background-color: ",";\n        border-radius: 2px;\n      }\n\n      .mapping-info{\n        .ds-mapping-collapse{\n          border: 0;\n        }\n      }\n\n      .field-list, .ds-list{\n        .ds-info{\n          width: 100%;\n          .ds-label{\n            cursor: pointer;\n            font-size: ",";\n          }\n        }\n        .tab-pane{\n          width: 100%;\n        }\n      }\n\n      .field-item{\n        .field-label{\n          height:  ",";\n          line-height:  ",";\n        }\n      }\n\n      .ds-more-options{\n        position: fixed;\n        background-color: ",";\n        color: ",";\n        z-index: 3;\n        user-select: none;\n        font-size: 13px;\n        width: ",";\n        .ds-more-option{\n          height: ",";\n          line-height: ",";\n          border-bottom: 1px;\n          cursor: pointer;\n          padding-left: 10px;\n          padding-right: 10px;\n        }\n        .ds-more-option:hover{\n          background-color: ",";\n        }\n        .ds-more-option:active.ds-more-option:hover{\n          background-color: ",";\n        }\n      }\n\n      .ds-mapping{\n        .ds-mapping-header{\n          height:  ",";\n          line-height:  ",";\n          border-bottom: 1px solid;\n          .ds-mapping-header-back{\n            cursor: pointer;\n          }\n        }\n\n        .ds-mapping-cur-info{\n          border-bottom: 1px solid;\n        }\n\n        .ds-mapping-external-data{\n          position: fixed;\n          z-index: 4;\n        }\n\n        .ds-mapping-set-item{\n          .ds-mapping-drop-down{\n            .btn-group{\n              width: 100%;\n              button{\n                width: 100%;\n              }\n            }\n          }\n        }\n\n        .ds-mapping-buttons{\n          left:  ",";\n          bottom:  ",";\n        }\n\n        .ds-mapping-source{\n          width:  ",";\n          height:  ",";\n          border-radius:  ",";\n          line-height:  ",";\n          text-align: center;\n          cursor: pointer;\n        }\n\n        .ds-mapping-ds{\n          .ds-origin-label{\n            max-width: 190px;\n          }\n        }\n\n      }\n    }\n\n    .widget-ds-setting-add-data-popup{\n      .modal-content{\n        height: 100%;\n      }\n    }\n\n  "],["\n    .widget-ds-setting{\n      width: 100%;\n      min-height: 100%;\n      position: absolute;\n      overflow: auto;\n\n      .in-use-related-widgets{\n        font-size: 14px;\n        color: ",";\n        margin-top: 16px !important;\n        margin-bottom: 16px !important;\n        font-weight: bold;\n      }\n\n      .widget-icon{\n        >img{\n          vertical-align: text-top;\n          width: ",";\n          height: ",";\n        }\n      }\n\n      .drop-down{\n        button{\n          background-color: ",";\n        }\n      }\n\n      .setting-header{\n        border-bottom: 1px;\n      }\n\n      .ds-back{\n        width: 40%;\n        cursor: pointer;\n        height: 20px;\n        text-transform: initial;\n        margin-left: -5px;\n      }\n\n      .add-data{\n        height: ",";\n        line-height: ",";\n        width: 228px;\n        padding: 0;\n        border-radius: 2px;\n        cursor: pointer;\n      }\n      button.add-data:hover{\n        color: "," !important;\n      }\n\n      .ds-label-input{\n        width: 90%;\n      }\n\n      .two-line-truncate{\n        overflow: hidden;\n        text-overflow: ellipsis;\n        display: -webkit-box;\n        -webkit-line-clamp: 2;\n        -webkit-box-orient: vertical;\n        word-break: break-all;\n        word-wrap: break-word;\n      }\n\n      .ds-thumbnail-type{\n        padding: "," "," 0  ",";\n      }\n\n      .ds-more{\n        margin-left:  ",";\n        cursor: pointer;\n      }\n\n      .ds-origin-label{\n        .ds-origin-label-link, .ds-origin-label-link:hover, .ds-origin-label-link:focus, .ds-origin-label-link:active{\n          color: ",";\n          outline: none;\n          box-shadow: 0 0 0 !important;\n          border: 0 !important;\n        }\n        .ds-origin-label-link-text{\n          display: inline-block;\n          font-size: ",";\n          max-width: 200px;\n        }\n      }\n\n      .mapping-info{\n        .ds-label{\n          cursor: default;\n        }\n      }\n\n      .ds-mapping-icon{\n        cursor: pointer;\n      }\n\n      .ds-mapping-collapse{\n        padding: "," "," 0  ",";\n        .ds-origin-label{\n          max-width: 170px;\n          height:  ",";\n          line-height:  ",";\n          border-radius: 2px;\n        }\n      }\n\n      .ds-widgets-more{\n        padding:  ",";\n      }\n\n      .list-item{\n        cursor: pointer;\n        background-color: ",";\n        font-size: ",";\n        .ds-label{\n          font-size: ",";\n        }\n        .ds-related-widgets{\n          color: ",";\n        }\n      }\n\n      .list-item.list-error-item{\n        cursor: default;\n        user-select: none;\n        background-color: ",";\n        color: ",";\n        .ds-thumbnail{\n          background-color: ",";\n        }\n        .jimu-icon{\n          color: ",";\n        }\n        .ds-related-widgets{\n          color: ",";\n        }\n      }\n\n      .ds-thumbnail{\n        width:  ",";\n        height:  ",";\n        background-color: ",";\n        border-radius: 2px;\n      }\n\n      .mapping-info{\n        .ds-mapping-collapse{\n          border: 0;\n        }\n      }\n\n      .field-list, .ds-list{\n        .ds-info{\n          width: 100%;\n          .ds-label{\n            cursor: pointer;\n            font-size: ",";\n          }\n        }\n        .tab-pane{\n          width: 100%;\n        }\n      }\n\n      .field-item{\n        .field-label{\n          height:  ",";\n          line-height:  ",";\n        }\n      }\n\n      .ds-more-options{\n        position: fixed;\n        background-color: ",";\n        color: ",";\n        z-index: 3;\n        user-select: none;\n        font-size: 13px;\n        width: ",";\n        .ds-more-option{\n          height: ",";\n          line-height: ",";\n          border-bottom: 1px;\n          cursor: pointer;\n          padding-left: 10px;\n          padding-right: 10px;\n        }\n        .ds-more-option:hover{\n          background-color: ",";\n        }\n        .ds-more-option:active.ds-more-option:hover{\n          background-color: ",";\n        }\n      }\n\n      .ds-mapping{\n        .ds-mapping-header{\n          height:  ",";\n          line-height:  ",";\n          border-bottom: 1px solid;\n          .ds-mapping-header-back{\n            cursor: pointer;\n          }\n        }\n\n        .ds-mapping-cur-info{\n          border-bottom: 1px solid;\n        }\n\n        .ds-mapping-external-data{\n          position: fixed;\n          z-index: 4;\n        }\n\n        .ds-mapping-set-item{\n          .ds-mapping-drop-down{\n            .btn-group{\n              width: 100%;\n              button{\n                width: 100%;\n              }\n            }\n          }\n        }\n\n        .ds-mapping-buttons{\n          left:  ",";\n          bottom:  ",";\n        }\n\n        .ds-mapping-source{\n          width:  ",";\n          height:  ",";\n          border-radius:  ",";\n          line-height:  ",";\n          text-align: center;\n          cursor: pointer;\n        }\n\n        .ds-mapping-ds{\n          .ds-origin-label{\n            max-width: 190px;\n          }\n        }\n\n      }\n    }\n\n    .widget-ds-setting-add-data-popup{\n      .modal-content{\n        height: 100%;\n      }\n    }\n\n  "])),e.colors.grays.gray600,o.polished.rem(14),o.polished.rem(14),e.colors.white,o.polished.rem(30),o.polished.rem(30),e.colors.black,o.polished.rem(10),o.polished.rem(10),o.polished.rem(10),o.polished.rem(5),e.colors.grays.gray600,o.polished.rem(12),o.polished.rem(10),o.polished.rem(10),o.polished.rem(10),o.polished.rem(25),o.polished.rem(25),o.polished.rem(10),e.colors.secondary,o.polished.rem(12),o.polished.rem(13),e.colors.cyans.cyan400,o.polished.rgba(e.colors.secondary,.4),e.colors.grays.gray600,e.colors.grays.gray300,e.colors.grays.gray600,e.colors.grays.gray600,o.polished.rem(36),o.polished.rem(36),e.colors.blues.blue200,o.polished.rem(13),o.polished.rem(35),o.polished.rem(35),e.colors.grays.gray100,e.colors.dark,o.polished.rem(70),o.polished.rem(38),o.polished.rem(38),e.colors.primary,e.colors.grays.gray100,o.polished.rem(42),o.polished.rem(42),o.polished.rem(65),o.polished.rem(10),o.polished.rem(20),o.polished.rem(20),o.polished.rem(10),o.polished.rem(20))}},function(e,t,n){function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var a=n(1),o=a.createElement("path",{d:"M5.5 5.5v-5a.5.5 0 0 1 1 0v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5z",fill:"currentColor",fillRule:"nonzero"});function r(e){return a.createElement("svg",s({width:12,height:12,viewBox:"0 0 12 12"},e),o)}e.exports=r,r.default=r}])});
//# sourceMappingURL=widget.js.map