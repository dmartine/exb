define(["jimu-core","builder/common"],function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=73)}({0:function(t,r){t.exports=e},10:function(e,r){e.exports=t},73:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(10),i=r(74),a=function(){function e(){this.id="app-config-processor-extension-builder-entry"}return e.prototype.process=function(e){var t=i.parseAppPath(),r=n.getAppStore().getState().queryObject;return r.id||r.app_config?Promise.resolve(e):r.title?o.appServices.createApp({template:"default",name:r.title,description:r.summary,tags:r.tags?r.tags.split(","):[],webmap:r.webmap,webscene:r.webscene,folder:r.folder,shareWithWebmap:!!r.sharewithwebmap,shareWithWebscene:!!r.sharewithwebscene}).then(function(t){var o={id:t.id,apiurl:r.apiurl,locale:r.locale};return n.jimuHistory.changeQueryObject(o),e},function(t){return e}):t.pageId?Promise.resolve(e):(n.jimuHistory.browserHistory.push(i.getPageLinkUrl("template",r)),Promise.resolve(e))},e}();t.default=a},74:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(75),o=r(79);function i(e){var t=e||"/",r="",n="",o=t.indexOf("#");-1!==o&&(n=t.substr(o),t=t.substr(0,o));var i=t.indexOf("?");return-1!==i&&(r=t.substr(i),t=t.substr(0,i)),{pathname:t,search:"?"===r?"":r,hash:"#"===n?"":n}}function a(e){return/(^http:)|(^https:)|(^\/\/)/.test(e)}function u(e){if(e||(e=window.location),window.jimuConfig.useStructuralUrl)return c(e.pathname);var t=n.parse(e.search);return{appId:t.id,pageId:t.page}}function c(e){void 0===e&&(e=window.location.pathname);var t=e.substr(window.jimuConfig.rootPath.length),r={pageId:null,appId:null},n=t.split("/").filter(function(e){return e});return""===t?r:1===n.length?t.indexOf(".")>-1||"page"===n[0]?r:(r.appId=n[0],r):2===n.length?/^page\/page\//.test(t)?(r.pageId="page",r):/^page/.test(t)?(r.pageId=n[1],r):(r.appId=n[0],r):n.length>=3?(r.appId=n[0],r.pageId=n[2],r):(console.log("URL pattern is not correct.",e),r)}function s(e){if(window.jimuConfig.useStructuralUrl){var t=c();return{path:t.appId?""+window.jimuConfig.rootPath+t.appId+"/page/"+e+"/":window.jimuConfig.rootPath+"page/"+e+"/",qo:null}}return{path:window.jimuConfig.rootPath,qo:{page:e}}}function p(e,t){var r,o=s(e);return(r=t&&o.qo?Object.assign({},t,o.qo):t||o.qo)?o.path+"?"+n.stringify(r):o.path}function l(){return window.jimuConfig.packagesInAppFolder?window.jimuConfig.rootPath:window.jimuConfig.rootPath+"../"}function f(e,t){var r=i(t);return"/"===r.pathname.charAt(0)?r:""===r.pathname?(r.pathname=e.pathname,r):"."===r.pathname.charAt(0)?(r.pathname=e.pathname+"/"+r.pathname.substr(2),r):(r.pathname=e.pathname+"/"+r.pathname,r)}function d(e){var t=e.pathname,r=e.search,n=e.hash,o=t||"/";return r&&"?"!==r&&(o+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(o+="#"===n.charAt(0)?n:"#"+n),o}t.parsePath=i,t.isAbsoluteUrl=a,t.getDataSourceInfosFromQueryObject=function(e){var t={};e.data_index?e.data_index.split(",").forEach(function(r){var n=r.split(":"),o=n[0],i=n[1],a={selectionType:"index",selection:[]};i?(i.split("+").forEach(function(t){var r=t.split("-");if(1===r.length)a.selection.push(parseInt(r[0]));else if(2===r.length)for(var n=parseInt(r[0]),o=parseInt(r[1]),i=n;i<=o;i++)a.selection.push(i);else console.error("Bad URL format:",e.data_index)}),t[o]=a):t[o]=a}):e.data_id&&e.data_id.split(",").forEach(function(e){var r=e.split(":"),n=r[0],o=r[1],i={selectionType:"id",selection:[]};o?(o.split("+").forEach(function(e){i.selection.push(e)}),t[n]=i):t[n]=i});return t},t.getAppIdPageIdFromUrl=u,t.parseAppPath=c,t.getPageLink=s,t.getPageLinkUrl=p,t.getFolder=function(e){if(/\/$/.test(e))return e;if(!([".js",".css",".scss",".html"].filter(function(t){return new RegExp(t+"$").test(e)}).length>0))return e;var t=e.split("/");return t.pop(),t.join("/")},t.getFixedRootPath=l,t.getAbsoluteRootUrl=function(){return window.location.protocol+"//"+window.location.host+l()},t.createLocation=f,t.createHref=d,t.getHrefFromLinkTo=function(e,t,r){if(void 0===r&&(r=window.location),"string"==typeof e)return a(e)?e:/^www./.test(e)?"//"+e:d(f(r,e));if(!e.linkType)return d(e);var i=e.linkType,u=e,c=t,s=void 0;switch(i){case o.LinkType.Page:return p(u.value,t);case o.LinkType.Dialog:c=c?c.set("dlg",u.value):{dlg:u.value},s=f(r,"?"+n.stringify(c));break;case o.LinkType.View:var l=u.value.split(",")[0],g=u.value.split(",").slice(1).join(",");return p(l,c=c?c.set("views",g):{views:g});case o.LinkType.WebAddress:var h=u.value;if(a(h))return h;if(/^www./.test(h))return"//"+h;case o.LinkType.None:return null;default:console.error("Unknown type:",i)}return s?d(s):void 0},t.getLinkResultFromHref=function(e){if(!e)return{linkType:o.LinkType.None};if(/^http/.test(e))return{linkType:o.LinkType.WebAddress,value:e};var t=i(e),r=u(t).pageId,a=n.parse(t.search);return a.views?{linkType:o.LinkType.View,value:r+","+a.views}:a.dlg?{linkType:o.LinkType.Dialog,value:a.dlg}:{linkType:o.LinkType.Page,value:r}}},75:function(e,t,r){"use strict";const n=r(76),o=r(77),i=r(78);function a(e,t){return t.encode?t.strict?n(e):encodeURIComponent(e):e}function u(e,t){return t.decode?o(e):e}function c(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function s(e){const t=(e=c(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function p(e,t){const r=function(e){let t;switch(e.arrayFormat){case"index":return(e,r,n)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),n[e][t[1]]=r):n[e]=r};case"bracket":return(e,r,n)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==n[e]?n[e]=[].concat(n[e],r):n[e]=[r]:n[e]=r};case"comma":return(e,t,r)=>{const n="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;r[e]=n};default:return(e,t,r)=>{void 0!==r[e]?r[e]=[].concat(r[e],t):r[e]=t}}}(t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",parseNumbers:!1},t)),n=Object.create(null);if("string"!=typeof e)return n;if(!(e=e.trim().replace(/^[?#&]/,"")))return n;for(const o of e.split("&")){let[e,a]=i(o.replace(/\+/g," "),"=");a=void 0===a?null:u(a,t),t.parseNumbers&&!Number.isNaN(Number(a))&&(a=Number(a)),r(u(e,t),a,n)}return!1===t.sort?n:(!0===t.sort?Object.keys(n).sort():Object.keys(n).sort(t.sort)).reduce((e,t)=>{const r=n[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(r):e[t]=r,e},Object.create(null))}t.extract=s,t.parse=p,t.stringify=((e,t)=>{if(!e)return"";const r=function(e){switch(e.arrayFormat){case"index":return t=>(r,n)=>{const o=r.length;return void 0===n?r:null===n?[...r,[a(t,e),"[",o,"]"].join("")]:[...r,[a(t,e),"[",a(o,e),"]=",a(n,e)].join("")]};case"bracket":return t=>(r,n)=>void 0===n?r:null===n?[...r,[a(t,e),"[]"].join("")]:[...r,[a(t,e),"[]=",a(n,e)].join("")];case"comma":return t=>(r,n,o)=>null===n||void 0===n||0===n.length?r:0===o?[[a(t,e),"=",a(n,e)].join("")]:[[r,a(n,e)].join(",")];default:return t=>(r,n)=>void 0===n?r:null===n?[...r,a(t,e)]:[...r,[a(t,e),"=",a(n,e)].join("")]}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),n=Object.keys(e);return!1!==t.sort&&n.sort(t.sort),n.map(n=>{const o=e[n];return void 0===o?"":null===o?a(n,t):Array.isArray(o)?o.reduce(r(n),[]).join("&"):a(n,t)+"="+a(o,t)}).filter(e=>e.length>0).join("&")}),t.parseUrl=((e,t)=>({url:c(e).split("?")[0]||"",query:p(s(e),t)}))},76:function(e,t,r){"use strict";e.exports=(e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},77:function(e,t,r){"use strict";var n=new RegExp("%[a-f0-9]{2}","gi"),o=new RegExp("(%[a-f0-9]{2})+","gi");function i(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),n=e.slice(t);return Array.prototype.concat.call([],i(r),i(n))}function a(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(n),r=1;r<t.length;r++)t=(e=i(t,r).join("")).match(n);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=o.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=a(r[0]);n!==r[0]&&(t[r[0]]=n)}r=o.exec(e)}t["%C2"]="�";for(var i=Object.keys(t),u=0;u<i.length;u++){var c=i[u];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},78:function(e,t,r){"use strict";e.exports=((e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const r=e.indexOf(t);return-1===r?[e]:[e.slice(0,r),e.slice(r+t.length)]})},79:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(t.BrowserSizeMode||(t.BrowserSizeMode={})),function(e){e.String="STRING",e.Number="NUMBER",e.Date="DATE"}(t.JimuFieldType||(t.JimuFieldType={})),function(e){e.Fetching="FETCHING",e.Success="SUCCESS",e.Error="ERROR"}(t.AjaxState||(t.AjaxState={})),function(e){e.Design="DESIGN",e.Run="RUN"}(t.AppMode||(t.AppMode={})),function(e){e.Opened="OPENED",e.Active="ACTIVE",e.Closed="CLOSED"}(t.WidgetState||(t.WidgetState={})),function(e){e.None="NONE",e.Page="PAGE",e.Dialog="DIALOG",e.View="VIEW",e.WebAddress="WEB_ADDRESS"}(t.LinkType||(t.LinkType={})),function(e){e.Normal="NORMAL",e.Layout="LAYOUT",e.Controller="CONTROLLER"}(t.WidgetType||(t.WidgetType={})),function(e){e.Header="HEADER",e.Footer="FOOTER",e.Body="BODY"}(t.PagePart||(t.PagePart={}))}})});
//# sourceMappingURL=builder-entry.js.map